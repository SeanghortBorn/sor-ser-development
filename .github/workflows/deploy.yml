name: Deploy to Hostinger

on:
  push:
    branches:
      - staging      # Triggers deployment to dev.sor-ser.com
      - production   # Triggers deployment to sor-ser.com

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: üöö Checkout code
        uses: actions/checkout@v3
      
      # ============================================
      # STAGING DEPLOYMENT (dev.sor-ser.com)
      # ============================================
      - name: üß™ Deploy to Staging (dev.sor-ser.com)
        if: github.ref == 'refs/heads/staging'
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          server-dir: /domains/sor-ser.com/public_html/dev/
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/vendor/**
            **/storage/logs/**
            **/storage/framework/cache/**
            **/storage/framework/sessions/**
            **/storage/framework/views/**
            **/bootstrap/cache/**
            .env
            .env.staging
            .env.production
            .env.*
            tests/**
            .editorconfig
            .phpunit.result.cache
            phpunit.xml
            README.md
            .github/**
            package-lock.json
            
      # Run composer install on staging server
      - name: üì¶ Install Composer Dependencies (Staging)
        if: github.ref == 'refs/heads/staging'
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          server-dir: /domains/sor-ser.com/public_html/dev/
          local-dir: ./
          dangerous-clean-slate: false
          
      # ============================================
      # PRODUCTION DEPLOYMENT (sor-ser.com)
      # ============================================
      - name: üöÄ Deploy to Production (sor-ser.com)
        if: github.ref == 'refs/heads/production'
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          server-dir: /domains/sor-ser.com/public_html/
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/vendor/**
            **/storage/logs/**
            **/storage/framework/cache/**
            **/storage/framework/sessions/**
            **/storage/framework/views/**
            **/bootstrap/cache/**
            .env
            .env.staging
            .env.production
            .env.*
            tests/**
            .editorconfig
            .phpunit.result.cache
            phpunit.xml
            README.md
            .github/**
            package-lock.json
      
      - name: ‚úÖ Deployment Complete
        run: |
          if [ "${{ github.ref }}" == "refs/heads/staging" ]; then
            echo "üéâ Staging deployment successful!"
            echo "üìù Next: SSH into server and run 'composer install' in dev folder"
            echo "üîó Check: https://dev.sor-ser.com"
          else
            echo "üéâ Production deployment successful!"
            echo "üìù Next: SSH into server and run 'composer install' in production folder"
            echo "üîó Check: https://sor-ser.com"
          fi