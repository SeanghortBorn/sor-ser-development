import{r as s,G as L,j as e,a as Y,X as $,A as T}from"./app-AW0S6vsN.js";import{I as D}from"./InputError-Dqj5f3rK.js";import{I as K}from"./InputLabel-EtBTU3Tq.js";import{T as M}from"./TextInput-DpLKr3Lw.js";import{M as O}from"./Modal-D-rGaXEL.js";import"./transition-Dcc46JoO.js";import"./with-selector-8qhvvLDn.js";function _({onConfirmed:E,children:i}){const[l,d]=s.useState(!1),t=s.useRef(),[u,y]=s.useState(localStorage.getItem("lang")||"en"),[w,m]=s.useState({}),[p,f]=s.useState(!1);s.useEffect(()=>{const a=()=>{y(localStorage.getItem("lang")||"en")};return window.addEventListener("lang-changed",a),window.addEventListener("storage",a),()=>{window.removeEventListener("lang-changed",a),window.removeEventListener("storage",a)}},[]);const{data:n,setData:c,post:F,processing:R,reset:h,errors:j}=L({password:""}),v=()=>{d(!0),setTimeout(()=>t.current?.focus(),250)},x=()=>{d(!1),h(),m({})},N=a=>{a.preventDefault(),f(!0),Y.post(route("password.confirm"),{password:n.password}).then(r=>{x(),h(),m({}),setTimeout(()=>{E()},100)}).catch(r=>{if(r.response&&r.response.data&&r.response.data.errors){const C={};Object.keys(r.response.data.errors).forEach(g=>{C[g]=r.response.data.errors[g][0]}),m(C),c("password","")}t.current?.focus()}).finally(()=>f(!1))};return e.jsxs("span",{children:[e.jsx("span",{onClick:v,children:i}),e.jsx(O,{show:l,onClose:x,maxWidth:"lg",children:e.jsxs("form",{className:"p-6",onSubmit:N,children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Security Confirmation"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"For your security, please confirm your password to continue."}),e.jsxs("div",{className:"mt-6",children:[e.jsx(K,{htmlFor:"password",value:"Enter Password"}),e.jsx(M,{id:"password",ref:t,type:"password",name:"password",value:n.password,onChange:a=>c("password",a.target.value),className:"mt-1 block w-full rounded-xl border border-gray-300 shadow-sm",placeholder:"Enter your Password"}),e.jsx(D,{message:w.password,className:"mt-2"})]}),e.jsxs("div",{className:"mt-6 flex justify-between items-center",children:[e.jsx("button",{type:"button",onClick:x,className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold disabled:opacity-60",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p,className:"rounded-[10px] px-9 py-1 bg-blue-600 text-white font-semibold hover:bg-blue-700 transition disabled:opacity-60",children:p?"Confirming...":"Confirm"})]})]})})]})}const U=({className:E=""})=>{const{auth:i}=$().props,[l,d]=s.useState(!1),[t,u]=s.useState(!1),[y,w]=s.useState(!1),[m,p]=s.useState(null),[f,n]=s.useState(null),[c,F]=s.useState([]),[R,h]=s.useState(""),[j,v]=s.useState(!1),[x,N]=s.useState(!1),a=L({code:""}),r=i.user?.two_factor_enabled,C=r&&!i.user?.two_factor_confirmed_at;s.useEffect(()=>{C?(u(!0),g()):r&&i.user?.two_factor_confirmed_at&&(u(!1),S(),p(null),n(null))},[r,i.user?.two_factor_confirmed_at]);const g=async()=>{try{const o=await fetch(route("two-factor.qr-code"));if(o.ok){const k=await o.json();p(k.svg);const I=await fetch(route("two-factor.secret-key"));if(I.ok){const b=await I.json();if(b.secret)n(b.secret);else{const A=b.secretKey||b.key||Object.values(b)[0];A&&typeof A=="string"&&n(A)}}}}catch(o){console.error("Error fetching 2FA data:",o)}},S=async()=>{try{const o=await fetch(route("two-factor.recovery-codes"));if(o.ok){const k=await o.json();F(k)}}catch(o){console.error("Error fetching recovery codes:",o)}},P=()=>{d(!0),T.post(route("two-factor.enable"),{},{preserveScroll:!0,onSuccess:()=>{u(!0),g()},onError:()=>d(!1),onFinish:()=>d(!1)})};s.useEffect(()=>{t||(a.reset(),h(""))},[t,r]);const Q=()=>{v(!0),a.post(route("two-factor.confirm"),{preserveScroll:!0,onSuccess:()=>{u(!1),a.reset(),h(""),S()},onError:o=>{h(o.code||a.errors.code||"Invalid authentication code.")},onFinish:()=>v(!1)})},q=()=>{N(!0),T.post(route("two-factor.regenerate-recovery-codes"),{},{preserveScroll:!0,onSuccess:async()=>{await S()},onFinish:()=>N(!1)})},G=()=>{w(!0),T.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{p(null),n(null),F([]),u(!1)},onFinish:()=>w(!1)})};return e.jsxs("section",{className:`space-y-6 ${E}`,children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Two-Factor Authentication"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Add additional security to your account using two factor authentication."})]}),e.jsxs("div",{className:"max-w-xl",children:[r&&!t?e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"You have enabled Two-Factor Authentication."}):r&&t?e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Finish enabling Two-Factor Authentication."}):e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"You have not enabled Two-Factor Authentication."}),e.jsx("div",{className:"mt-3 text-sm text-gray-600",children:e.jsx("p",{children:"When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application."})}),r&&e.jsxs("div",{className:"mt-4",children:[t&&m&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"font-semibold mb-2 text-sm text-gray-600",children:t?"To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application.":"Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application."}),e.jsx("div",{dangerouslySetInnerHTML:{__html:m},className:"p-2 inline-block bg-white border border-gray-200 rounded"})]}),t&&f&&e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[e.jsxs("p",{className:"font-semibold",children:["Setup Key:"," ",e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:f})]}),e.jsx("p",{className:"mt-1",children:"If you can't scan the QR code, you can manually enter this setup key into your Authenticator App."})]}),t&&e.jsxs("div",{className:"mt-2",children:[e.jsx(K,{htmlFor:"code",value:"Authentication Code"}),e.jsx(M,{id:"code",value:a.data.code,onChange:o=>a.setData("code",o.target.value),type:"text",placeholder:"Enter Code 6 Digits",maxLength:6,inputMode:"numeric",className:"block mt-1 w-1/2 rounded-xl border border-gray-300 shadow-sm",autoFocus:!0,autoComplete:"one-time-code"}),e.jsx(D,{message:R,className:"mt-2"})]}),c.length>0&&!t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:e.jsx("p",{className:"font-semibold",children:"Store these recovery codes safely (like in a password manager). You can use them to access your account if you lose your two-factor authentication device. Each code can be used only once after a new login."})}),e.jsx("div",{className:"grid gap-1 mt-4 px-4 py-4 font-mono text-sm bg-gray-100 rounded-lg",children:c.map(o=>e.jsx("div",{children:o},o))})]})]}),e.jsx("div",{className:"mt-5",children:r?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_,{onConfirmed:G,children:e.jsx("button",{type:"button",disabled:y,className:`flex items-center space-x-2 px-4 py-2 rounded-[10px] border-2 border-gray-300 text-gray-700 hover:bg-gray-100 transition font-semibold disabled:opacity-60
                                        ${y?"opacity-50 cursor-not-allowed":"hover:bg-gray-100"} 
                                        border-gray-300`,children:e.jsx("span",{className:"text-sm text-gray-700",children:t?"Cancel":"Disable"})})}),t&&e.jsx("button",{type:"button",disabled:l||j,onClick:Q,className:`flex items-center space-x-2 px-4 py-2 rounded-[10px] bg-blue-600 text-blue-700 transition font-semibold disabled:opacity-60
                                        ${l||j?"opacity-50 cursor-not-allowed":"hover:bg-blue-500"}`,children:e.jsx("span",{className:"text-sm text-white",children:j?"Confirming...":"Confirm"})}),c.length>0&&!t&&e.jsx("button",{type:"button",onClick:q,disabled:x,className:"flex items-center space-x-2 px-4 py-2 rounded-[10px] bg-blue-600 text-blue-700 hover:bg-blue-500 transition font-semibold disabled:opacity-60",children:e.jsx("span",{className:"text-sm text-white",children:x?"Generating...":"Generate New"})}),c.length===0&&!t&&e.jsx(_,{onConfirmed:S,children:e.jsx("button",{className:"flex items-center space-x-2 px-4 py-2 rounded-[10px] bg-blue-600 hover:bg-blue-500 text-blue-700 transition font-semibold disabled:opacity-60",children:e.jsx("span",{className:"text-sm text-white",children:"Show Recovery Codes"})})})]}):e.jsx(_,{onConfirmed:P,children:e.jsxs("button",{type:"button",disabled:l,className:`flex items-center space-x-2 px-4 py-2 rounded-[10px] border-2 border-blue-500 text-blue-700 hover:bg-blue-100 transition font-semibold disabled:opacity-60
                                    ${l?"opacity-50 cursor-not-allowed":"hover:bg-blue-100"} 
                                    border-blue-500`,children:[e.jsxs("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"}),e.jsx("path",{d:"m9 12 2 2 4-4"})]}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:"Enable"})]})})})]})]})};export{U as default};
