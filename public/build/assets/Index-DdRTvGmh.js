import{X as z,r as a,j as e,S as G,x as W,A as $}from"./app-BjqCgIyx.js";import{A as J}from"./AdminLayout-B7XET_EX.js";import{B as K}from"./Breadcrumb-CypNNXXb.js";import{P as O}from"./Pagination-C62AK7uk.js";import{M as _}from"./Modal-UDtqqqRR.js";import{S as Q}from"./search-_AXU55GT.js";import{C as Y}from"./clipboard-plus-CJwjPIPq.js";import"./transition-02Kcjz_l.js";import"./createLucideIcon-CMyWvhk4.js";function oe({articles:i,search:M=""}){var A,C;const{auth:p}=z().props,n=(p==null?void 0:p.can)??{},N=(i==null?void 0:i.data)||[],[E,c]=a.useState(!1),[o,d]=a.useState(null),[u,x]=a.useState(!1),[T,f]=a.useState(!1),[s,v]=a.useState(null),[U,h]=a.useState(""),[k,w]=a.useState(!1),[m,V]=a.useState(M),B=t=>{d(t),c(!0)},I=t=>{var l;(l=t==null?void 0:t.preventDefault)==null||l.call(t),o&&(x(!0),$.delete(route("articles.destroy",o.id),{preserveScroll:!0,onFinish:()=>{x(!1),c(!1),d(null)}}))},R=t=>{const l=t.target.value;V(l),$.get(route("articles.index"),{search:l},{preserveState:!0,replace:!0})},g=(t,l)=>{if(!t)return null;if(typeof t=="string")return t.startsWith("http")||t.startsWith("/")?t:`/storage/uploads/${l}/${t}`;if(t.url)return t.url;if(t.path){const r=t.path.replace(/^public\//,"");return t.path.startsWith("http")||t.path.startsWith("/")?t.path:`/storage/${r}`}if(t.file_path){const r=String(t.file_path);return r.startsWith("http")||r.startsWith("/")?r:r.startsWith("public/")?`/storage/${r.replace(/^public\//,"")}`:`/storage/${r}`}return t.filename?`/storage/uploads/${l}/${t.filename}`:t.name?`/storage/uploads/${l}/${t.name}`:null},S=t=>t?t.split(".").pop().toLowerCase():"",H=async t=>{var F,L,P;v(t),h(""),f(!0),w(!0);const l=((F=t.file)==null?void 0:F.title)||((L=t.file)==null?void 0:L.filename)||"",r=S(l);let j="";if((P=t.file)!=null&&P.file_path){const y=t.file.file_path.split("/");j=y[y.length-1]}const D=r==="txt"&&j?`/storage/uploads/files/${j}`:g(t.file,"files");if(D&&r==="txt")try{const q=await(await fetch(D)).text();h(q)}catch{h("Failed to load file content.")}w(!1)},b="Articles List",X=[{title:"Home",url:"/"},{title:b,url:""}];return e.jsxs(J,{breadcrumb:e.jsx(K,{header:b,links:X}),children:[e.jsx(G,{title:b}),e.jsx("section",{className:"content",children:e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"bg-white shadow-md rounded-xl overflow-hidden border border-gray-200 mb-12",children:[e.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Articles"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 rounded-xl border hover:shadow-lg transition text-sm bg-white",children:[e.jsx(Q,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",className:"px-2 w-[250px] py-2 rounded-[10px] border-none border-gray-300 text-sm  focus:outline-none focus:ring-0",placeholder:"Search Title or File",value:m,onChange:R})]}),n["article-create"]&&n["article-list"]&&e.jsxs(W,{href:route("articles.create"),className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl font-semibold text-sm text-white bg-green-600 hover:bg-green-500 transition",children:[e.jsx(Y,{className:"w-4 h-4"}),"Add Article"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{className:"bg-blue-600 text-white text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"ID"}),e.jsx("th",{className:"px-4 py-3",children:"Title"}),e.jsx("th",{className:"px-4 py-3",children:"File"}),e.jsx("th",{className:"px-4 py-3",children:"Audio"}),e.jsx("th",{className:"px-4 py-3",children:"Created At"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-gray-200",children:N.length>0?N.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-4 py-3",children:t.id}),e.jsx("td",{className:"px-4 py-3",children:t.title}),e.jsx("td",{className:"px-4 py-3",children:t.file?t.file.title:e.jsx("span",{className:"text-gray-400",children:"NULL"})}),e.jsx("td",{className:"px-4 py-3",children:t.audio?t.audio.title:e.jsx("span",{className:"text-gray-400",children:"NULL"})}),e.jsx("td",{className:"px-4 py-3",children:t.created_at?t.created_at.slice(0,10):""}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[n["article-list"]&&e.jsx("button",{type:"button",onClick:()=>H(t),className:"px-3 py-1 rounded bg-gray-500 text-white text-xs hover:bg-gray-600",children:"View"}),n["article-edit"]&&n["article-list"]&&e.jsx(W,{href:route("articles.edit",t.id),className:"px-3 py-1 rounded bg-blue-500 text-white text-xs hover:bg-blue-600",children:"Edit"}),n["article-delete"]&&n["article-list"]&&e.jsx("button",{type:"button",onClick:()=>B(t),className:"px-3 py-1 rounded bg-red-500 text-white text-xs hover:bg-red-600",children:"Delete"})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-6 text-gray-500",children:"No articles found."})})})]})}),e.jsx(_,{show:E,onClose:()=>{c(!1),d(null),x(!1)},maxWidth:"lg",children:e.jsxs("form",{onSubmit:I,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Delete Article"}),e.jsxs("p",{className:"text-gray-700 mb-4",children:['Are you sure you want to delete "',o==null?void 0:o.title,'"?']}),e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),d(null),x(!1)},className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-[10px] px-9 py-1 text-white font-semibold transition bg-red-600 hover:bg-red-700",disabled:u,children:u?"Deleting...":"Delete"})]})]})}),e.jsx(_,{show:T,onClose:()=>{f(!1),v(null),h("")},maxWidth:"2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:["Article Name:",e.jsx("span",{className:"ml-1 text-blue-600",children:(s==null?void 0:s.title)??""})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"font-bold text-gray-700 mb-1",children:["File Name:"," ",e.jsx("span",{className:"text-gray-600",children:s.file.title||s.file.filename||"File"})]}),s.file?(()=>{const t=g(s.file,"files"),l=s.file.title||s.file.filename||"File";return S(l)==="txt"?e.jsx("div",{className:"border rounded-lg bg-gray-50 p-3 max-h-64 overflow-auto text-sm",children:k?"Loading...":U||"No content."}):e.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:["Download ",l]})})():e.jsx("span",{className:"text-gray-400",children:"No file"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"font-bold text-gray-700 mb-1",children:["Audio Name:"," ",e.jsx("span",{className:"text-gray-600",children:((A=s.audio)==null?void 0:A.title)||((C=s.audio)==null?void 0:C.filename)||"Audio"})]}),s.audio?(()=>{const t=g(s.audio,"audios");return e.jsx("audio",{src:t,controls:!0,className:"w-full rounded-lg"})})():e.jsx("span",{className:"text-gray-400",children:"No audio"})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:()=>f(!1),className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",children:"Close"})})]})}),i.total>10&&e.jsx("div",{className:"px-6 py-3 border-t flex justify-center",children:e.jsx(O,{links:i.links.map(t=>({...t,url:t.url?t.url+(m?(t.url.includes("?")?"&":"?")+"search="+encodeURIComponent(m):""):null})),currentPage:i.current_page,perPage:i.per_page})})]})})})]})}export{oe as default};
