import{X as oe,r as n,j as e,S as ie,x as de,A as f}from"./app-BjqCgIyx.js";import{B as ce}from"./Breadcrumb-CypNNXXb.js";import{M as $}from"./Modal-UDtqqqRR.js";import{P as xe}from"./Pagination-C62AK7uk.js";import{A as me}from"./AdminLayout-B7XET_EX.js";import{h as he}from"./moment-C5S46NFB.js";import{c as d}from"./createLucideIcon-CMyWvhk4.js";import{S as ue}from"./search-_AXU55GT.js";import{P as pe}from"./pencil-BDUr1BN6.js";import{C as be}from"./circle-check-big-qP6-IAya.js";import"./transition-02Kcjz_l.js";/**
 * @license lucide-react v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ye=d("ban",ge);/**
 * @license lucide-react v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],je=d("graduation-cap",fe);/**
 * @license lucide-react v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],ve=d("rotate-ccw",Ne);/**
 * @license lucide-react v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ke=d("shield-check",we);/**
 * @license lucide-react v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Ce=d("user-check",Se);/**
 * @license lucide-react v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Me=d("user-plus",Pe);/**
 * @license lucide-react v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],_e=d("user",Re);/**
 * @license lucide-react v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],Be=d("users-round",Ae);function We({users:i,permissions:H=[],search:R="",userStats:j={}}){var q,G,L,I,z,F;const{auth:_}=oe().props,a=(_==null?void 0:_.can)??{},[W,c]=n.useState(!1),[l,h]=n.useState(null),[Y,u]=n.useState([]),[N,x]=n.useState(!1),[O,v]=n.useState(!1),[r,w]=n.useState(null),[k,S]=n.useState(!1),[V,C]=n.useState(!1),[p,P]=n.useState(null),[A,b]=n.useState(""),[M,g]=n.useState(!1),[E,m]=n.useState(""),[X,D]=n.useState(R||""),J=[{id:"total",label:"Total Users",icon:"UsersRound",color:"text-blue-500",borderColor:"border-blue-100",bgColor:"bg-blue-50",value:0,description:"All users registered in the system"},{id:"employees",label:"Employees",icon:"UserCheck",color:"text-green-500",borderColor:"border-green-100",bgColor:"bg-green-50",value:0,description:"All verified staff or employee accounts"},{id:"students",label:"Experiment Group",icon:"GraduationCap",color:"text-orange-500",borderColor:"border-orange-100",bgColor:"bg-orange-50",value:0,description:"All student accounts currently active"},{id:"normal",label:"Control Group",icon:"User",color:"text-purple-500",borderColor:"border-purple-100",bgColor:"bg-purple-50",value:0,description:"All users without special roles"}],K=()=>{const s=i.data||[];return{total:s.length,employees:s.filter(t=>{var o;return((o=t.roles)==null?void 0:o.length)>0}).length,students:s.filter(t=>{var o;return((o=t.permissions)==null?void 0:o.length)>0&&(!t.roles||t.roles.length===0)}).length,normal:s.filter(t=>(!t.permissions||t.permissions.length===0)&&(!t.roles||t.roles.length===0)).length}},Q=n.useMemo(()=>{const s=j&&Object.keys(j).length>0?j:K();return J.map(t=>({...t,value:s[t.id]??0}))},[j,i.data]);n.useEffect(()=>{D(R||"")},[R]);const Z=s=>{var y;h(s);const t=s.permissions?s.permissions.map(U=>U.id):[],o=(y=H.find(U=>U.name==="student"))==null?void 0:y.id;u(t.length>0?t:o?[o]:[]),c(!0)},T=s=>{s.preventDefault(),l&&(x(!0),window.axios.patch(route("users.update-permissions",l.id),{permissions:Y}).then(()=>{x(!1),c(!1),f.reload({only:["users","userStats"]})}).catch(()=>x(!1)))},ee=s=>{s.preventDefault(),l&&(x(!0),window.axios.patch(route("users.update-permissions",l.id),{permissions:[]}).then(()=>{x(!1),c(!1),f.reload({only:["users","userStats"]})}).catch(()=>x(!1)))},se=s=>{w(s),v(!0)},te=()=>{if(!r)return;S(!0);const s=r.blocked?route("users.unblock",r.id):route("users.block",r.id);window.axios.post(s).then(()=>{f.reload({only:["users","userStats"]})}).finally(()=>{S(!1),v(!1),w(null)})},le=s=>{P(s),b(""),m(""),C(!0)},re=s=>{if(s.preventDefault(),!p||!A.trim()){m("Password is required.");return}g(!0),m(""),window.axios.post(route("users.reset-password",p.id),{password:A}).then(()=>{C(!1),P(null),b(""),g(!1),f.reload({only:["users"]})}).catch(t=>{var o,y;g(!1),m(((y=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:y.message)||"Failed to reset password.")})},ae=s=>{const t=s.target.value||"";D(t),f.get(route("users.index"),{search:t},{preserveState:!0,replace:!0})},B="User List",ne=[{title:"Home",url:"/"},{title:B,url:""}];return e.jsxs(me,{breadcrumb:e.jsx(ce,{header:B,links:ne}),children:[e.jsx(ie,{title:B}),e.jsx("section",{className:"content",children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:Q.map(s=>e.jsxs("div",{className:`bg-white px-3 pb-2 pt-3 border-l-4 ${s.borderColor} shadow-sm rounded-xl flex flex-col hover:shadow-md transition-all duration-200`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-gray-800 text-base font-semibold",children:s.label}),e.jsxs("div",{className:`${s.color}`,children:[s.icon==="UsersRound"&&e.jsx(Be,{className:"w-7 h-7"}),s.icon==="UserCheck"&&e.jsx(Ce,{className:"w-7 h-7"}),s.icon==="GraduationCap"&&e.jsx(je,{className:"w-7 h-7"}),s.icon==="User"&&e.jsx(_e,{className:"w-7 h-7"})]})]}),e.jsxs("div",{className:"",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:s.value}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.description})]})]},s.id))}),e.jsxs("div",{className:"bg-white shadow-md rounded-xl overflow-hidden border border-gray-200 mb-12",children:[e.jsxs("div",{className:"px-6 py-4 border-b flex flex-col md:flex-row justify-between items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"User Management"}),e.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[e.jsx("form",{className:"inline-block",onSubmit:s=>s.preventDefault(),children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 rounded-xl border hover:shadow-lg transition text-sm bg-white",children:[e.jsx(ue,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search by name or email",className:"px-2 outline-none border-none bg-transparent text-sm placeholder-gray-400 w-full min-w-[150px] focus:outline-none focus:ring-0",value:X??"",onChange:ae})]})}),a["user-create"]&&a["user-list"]&&e.jsxs("a",{href:route("users.create"),className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl font-semibold text-sm text-white bg-green-600 hover:bg-green-500 transition",children:[e.jsx(Me,{className:"w-4 h-4"}),"Add User"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-4",children:"#ID"}),e.jsx("th",{className:"py-3 px-4",children:"Name"}),e.jsx("th",{className:"py-3 px-4",children:"Email"}),e.jsx("th",{className:"py-3 px-4",children:"Role"}),e.jsx("th",{className:"py-3 px-4",children:"Blocked"}),e.jsx("th",{className:"py-3 px-4",children:"Created At"}),(a["user-edit"]||a["user-delete"])&&e.jsx("th",{className:"py-3 px-4 text-center",children:"Action"})]})}),e.jsx("tbody",{className:"text-sm text-gray-700",children:i.data.length>0?i.data.map(s=>{var t,o;return e.jsxs("tr",{className:"border-t hover:bg-gray-50 transition",children:[e.jsx("td",{className:"py-3 px-4 font-semibold",children:s.id}),e.jsx("td",{className:"py-3 px-4",children:s.name}),e.jsx("td",{className:"py-3 px-4",children:s.email}),e.jsx("td",{className:"py-3 px-4",children:((t=s.roles)==null?void 0:t.length)>0?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-600 text-white",children:s.roles[0].name}):((o=s.permissions)==null?void 0:o.length)>0?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-600 text-white",children:"Student"}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-400 text-white",children:"No Access"})}),e.jsx("td",{className:"py-3 px-4",children:s.blocked?e.jsx("span",{className:"badge bg-red-600 text-white text-xs",children:"Blocked"}):e.jsx("span",{className:"badge bg-green-600 text-white text-xs",children:"Active"})}),e.jsx("td",{className:"py-3 px-4",children:he(s.created_at).format("DD/MM/YYYY")}),(a["user-edit"]||a["user-block"])&&e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2 items-center",children:[a["user-edit"]&&a["user-create"]&&e.jsxs("div",{className:"relative group",children:[e.jsx(de,{href:route("users.edit",s.id),className:"inline-flex items-center gap-1.5 px-2 py-2 text-sm font-medium rounded-xl bg-blue-500 text-white hover:bg-blue-600 transition",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-white text-gray-800 text-xs px-3 py-1 rounded-lg shadow-md border",children:"Edit User"})]}),a["user-edit"]&&a["user-create"]&&e.jsxs("div",{className:"relative group",children:[e.jsx("button",{type:"button",className:"inline-flex items-center gap-1.5 px-2 py-2 text-sm font-medium rounded-xl bg-indigo-600 text-white hover:bg-indigo-500 transition",onClick:()=>Z(s),children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-white text-gray-800 text-xs px-3 py-1 rounded-lg shadow-md border",children:"Assign Student Role"})]}),a["user-edit"]&&a["user-create"]&&e.jsxs("div",{className:"relative group",children:[e.jsx("button",{type:"button",className:"inline-flex items-center gap-1.5 px-2 py-2 text-sm font-medium rounded-xl bg-amber-500 text-white hover:bg-amber-600 transition",onClick:()=>le(s),children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-white text-gray-800 text-xs px-3 py-1 rounded-lg shadow-md border",children:"Reset Password"})]}),a["user-block"]&&e.jsxs("div",{className:"relative group",children:[e.jsx("button",{type:"button",className:`inline-flex items-center gap-1.5 px-2 py-2 text-sm font-medium rounded-xl ${s.blocked?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-400"} text-white transition`,onClick:()=>se(s),children:s.blocked?e.jsx(e.Fragment,{children:e.jsx(be,{className:"w-4 h-4"})}):e.jsx(e.Fragment,{children:e.jsx(ye,{className:"w-4 h-4"})})}),e.jsx("div",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-white text-gray-800 text-xs px-2 py-1 rounded-lg shadow-md border",children:s.blocked?"Unblock":"Block"})]})]})})]},s.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:a["user-edit"]||a["user-block"]?7:6,className:"py-8 text-center text-gray-500",children:"No users found"})})})]})}),e.jsx($,{show:O,onClose:()=>{v(!1),w(null),S(!1)},maxWidth:"lg",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),k||te()},className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:r!=null&&r.blocked?"Unblock User":"Block User"}),e.jsx("p",{className:"text-gray-700 mb-4",children:r!=null&&r.blocked?`Are you sure you want to unblock "${r==null?void 0:r.name}"?`:`Are you sure you want to block "${r==null?void 0:r.name}"? The user will not be able to log in.`}),e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{v(!1),w(null),S(!1)},className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",disabled:k,children:"Cancel"}),e.jsx("button",{type:"submit",className:`rounded-[10px] px-9 py-1 text-white font-semibold transition ${r!=null&&r.blocked?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,disabled:k,children:k?"Saving...":r!=null&&r.blocked?"Unblock":"Block"})]})]})}),e.jsx($,{show:W,onClose:()=>{c(!1),u([]),h(null)},maxWidth:"xl",children:l&&((q=l.permissions)==null?void 0:q.length)===0&&((G=l.roles)==null?void 0:G.length)===0?e.jsxs("form",{onSubmit:T,className:"p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Assign Student Permission"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:l==null?void 0:l.name})," ","has no role yet. Click"," ",e.jsx("strong",{children:"Save"})," to give them the default ",e.jsx("strong",{children:"Student"})," role."]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"inline-block px-2 py-0.5 text-xs font-medium text-green-800 bg-green-100 rounded",children:"Default: Student"})}),e.jsxs("div",{className:"flex justify-between gap-3 mt-3",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),u([]),h(null)},className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold disabled:opacity-60",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:N,className:"rounded-[10px] px-9 py-1 bg-blue-600 text-white font-semibold hover:bg-blue-700 transition disabled:opacity-60",children:N?"Saving…":"Save"})]})]}):((L=l==null?void 0:l.roles)==null?void 0:L.length)>0?e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"User Role Information"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:l==null?void 0:l.name})," ","is assigned the following role:"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"inline-block px-3 py-1 text-sm font-medium text-green-900 bg-green-100 rounded-full",children:(z=(I=l==null?void 0:l.roles)==null?void 0:I[0])==null?void 0:z.name})}),e.jsx("p",{className:"text-sm text-gray-500 italic",children:"This user has been assigned a role and cannot be modified through this interface."}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx("button",{type:"button",onClick:()=>{c(!1),u([]),h(null)},className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",children:"Close"})})]}):((F=l==null?void 0:l.permissions)==null?void 0:F.length)>0?e.jsxs("form",{onSubmit:ee,className:"p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Remove Student Permission"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:l==null?void 0:l.name})," ","currently has the following permission:"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"inline-block px-3 py-1 text-sm font-medium text-blue-900 bg-blue-100 rounded-full",children:"Student"})}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Click ",e.jsx("strong",{children:"Remove"})," to revoke this permission."]}),e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),u([]),h(null)},className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold disabled:opacity-60",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:N,className:"rounded-[10px] px-9 py-1 bg-red-600 text-white font-semibold hover:bg-red-700 transition disabled:opacity-60",children:N?"Removing…":"Remove"})]})]}):null}),e.jsx($,{show:V,onClose:()=>{C(!1),P(null),b(""),g(!1),m("")},maxWidth:"lg",children:e.jsxs("form",{onSubmit:re,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Reset Password"}),e.jsxs("p",{className:"text-gray-700 mb-4",children:["Enter a new password for"," ",e.jsx("span",{className:"font-semibold",children:p==null?void 0:p.name}),"."]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"New Password"}),e.jsx("input",{type:"password",placeholder:"Enter new password",className:"w-full px-3 py-2 border border-gray-300 rounded-xl transition-colors text-gray-600 focus:ring-3 focus:ring-gray-100 focus:outline-none text-[18px] font-medium",value:A||"",onChange:s=>b(s.target.value),disabled:M}),E&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:E})]}),e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{C(!1),P(null),b(""),g(!1),m("")},className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",disabled:M,children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-[10px] px-9 py-1 bg-blue-600 text-white font-semibold hover:bg-blue-700 transition",disabled:M,children:M?"Saving...":"Save"})]})]})}),i.total>10&&e.jsx("div",{className:"px-6 py-3 border-t flex justify-center",children:e.jsx(xe,{links:i.links,currentPage:i.current_page,perPage:i.per_page})})]})]})})]})}export{We as default};
