const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/components/components-homophone.WOzUQXtP.js","assets/vendor/vendor-common.uohrjYuu.js","assets/css/vendor-common.DYI9Lmvo.css","assets/components/components-common.Bgrb9ok9.js","assets/vendor/vendor-utils.BE4hxS_f.js","assets/css/vendor-utils.qpx8Q8Bj.css"])))=>i.map(i=>d[i]);
import{j as e,r as s,a as U,u as Le,a8 as He,L as De}from"../vendor/vendor-common.uohrjYuu.js";import{i as V,E as F,H as ct,P as lt,B as dt,M as ut,F as ht}from"../components/components-common.Bgrb9ok9.js";import{H as mt,a as ft,b as pt,c as Pe,d as xt}from"../components/components-homophone.WOzUQXtP.js";import{u as yt,a as $e,b as Fe}from"../app/app-stores.BwBB_TAu.js";import{h as te}from"../app/app-services.CyPEn6Of.js";const gt="modulepreload",wt=function(l){return"/build/"+l},Ie={},X=function(R,g,v){let n=Promise.resolve();if(g&&g.length>0){let N=function(p){return Promise.all(p.map(x=>Promise.resolve(x).then(C=>({status:"fulfilled",value:C}),C=>({status:"rejected",reason:C}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),o=h?.nonce||h?.getAttribute("nonce");n=N(g.map(p=>{if(p=wt(p),p in Ie)return;Ie[p]=!0;const x=p.endsWith(".css"),C=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${C}`))return;const S=document.createElement("link");if(S.rel=x?"stylesheet":gt,x||(S.as="script"),S.crossOrigin="",S.href=p,o&&S.setAttribute("nonce",o),document.head.appendChild(S),x)return new Promise((T,$)=>{S.addEventListener("load",T),S.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${p}`)))})}))}function b(h){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=h,window.dispatchEvent(o),!o.defaultPrevented)throw h}return n.then(h=>{for(const o of h||[])o.status==="rejected"&&b(o.reason);return R().catch(b)})},G=(l,R={})=>{const{fallback:g=e.jsx(V,{}),errorFallback:v=null,retryDelay:n=1e3,maxRetries:b=3}=R,h=(N,p=b,x=n)=>new Promise((C,S)=>{N().then(C).catch(T=>{setTimeout(()=>{if(p===0){S(T);return}console.log(`Retrying import... (${b-p+1}/${b})`),h(N,p-1,x).then(C,S)},x)})}),o=s.lazy(()=>h(l));return N=>e.jsx(F,{fallback:v,children:e.jsx(s.Suspense,{fallback:g,children:e.jsx(o,{...N})})})};function Re(){const[l,R]=s.useState(null),[g,v]=s.useState(!1),[n,b]=s.useState(null),[h,o]=s.useState(!1),[N,p]=s.useState([]),[x,C]=s.useState(!1),[S,T]=s.useState([]),[$,L]=s.useState(!1),y=async(d,i,D,M={})=>{D(!0);try{for(const c of d)try{const j=await U.get(c,{params:M,headers:{Accept:"application/json"},validateStatus:A=>A<500});if(j.status===200){const A=j.data?.data??j.data??null;if(A){i(Array.isArray(A)&&A[0]||A);return}}}catch{continue}i(null)}catch(c){console.error("Error fetching data:",c),i(null)}finally{D(!1)}},H=async d=>{if(!d)return;await y(["/api/user-activities/stats","/api/user-activity-stats","/api/stats/user-activities"],R,v,{grammar_checker_id:d})},r=async d=>{if(!d)return;const i=[`/api/user-homophone-accuracies?grammar_checker_id=${d}`,`/api/homophone-accuracies?grammar_checker_id=${d}`,`/api/accuracies?grammar_checker_id=${d}`];await y(i,b,o)},W=async d=>{if(d){C(!0);try{const i=await U.get("/api/user-comparison-activities",{params:{grammar_checker_id:d,limit:50},headers:{Accept:"application/json"}}),D=Array.isArray(i.data)?i.data:i.data?.data??[];p(D)}catch(i){console.error("Error fetching comparison activities:",i),p([])}finally{C(!1)}}},I=async d=>{if(!d)return;const i=["/api/user-audio-activities","/api/audio-activities"];L(!0);try{for(const D of i)try{const M=await U.get(D,{params:{grammar_checker_id:d},headers:{Accept:"application/json"},validateStatus:c=>c<500});if(M.status===200){const c=Array.isArray(M.data)?M.data:M.data?.data??[];T(c);return}}catch{continue}T([])}catch(D){console.error("Error fetching audio activities:",D),T([])}finally{L(!1)}};return{activityStats:l,loadingActivityStats:g,accuracyStats:n,loadingAccuracyStats:h,comparisonActivities:N,loadingComparisonActivities:x,audioActivities:S,loadingAudioActivities:$,fetchActivityStats:H,fetchAccuracyStats:r,fetchComparisonActivities:W,fetchAudioActivities:I,fetchAllStats:async d=>{await Promise.all([H(d),r(d),W(d),I(d)])},resetStats:()=>{R(null),b(null),p([]),T([])}}}function vt(l,R,g,v){const n=s.useRef(null),[b,h]=s.useState(null),[o,N]=s.useState(!1),[p,x]=s.useState(null),[C,S]=s.useState(0),[T,$]=s.useState(0),[L,y]=s.useState(null),H=async(c,j={})=>{if(!(!l||!R?.audios_id))try{await U.post("/api/track/audio-activity",{audio_id:R.audios_id,article_id:R.id,grammar_checker_id:g??null,activity_type:c,playback_position:n.current?.currentTime||0,session_id:v,...j})}catch(A){console.error(`Track audio ${c} error:`,A)}};return{audioRef:n,audioUrl:b,isPlaying:o,audioError:p,currentTime:C,duration:T,togglePlay:async()=>{if(!b||!n.current){x("No audio available to play.");return}if(o){const c=Date.now();y(c),n.current.pause(),N(!1),await H("audio_pause",{pause_duration:0})}else{let c=0;L&&(c=(Date.now()-L)/1e3,y(null));try{await n.current.play(),N(!0),await H("audio_play",{pause_duration:c})}catch(j){console.error("Playback failed:",j),x("Failed to play audio. Please try again."),N(!1)}}},skipForward:async()=>{n.current&&(n.current.currentTime=Math.min(n.current.currentTime+10,n.current.duration),await H("audio_forward"))},skipBackward:async()=>{n.current&&(n.current.currentTime=Math.max(n.current.currentTime-10,0),await H("audio_rewind"))},handleSeek:c=>{if(n.current){const j=c.currentTarget.getBoundingClientRect(),A=(c.clientX-j.left)/j.width;n.current.currentTime=A*n.current.duration}},handleTimeUpdate:()=>{n.current&&S(n.current.currentTime)},handleLoadedMetadata:()=>{n.current&&$(n.current.duration)},handleAudioEnded:()=>{N(!1),n.current&&(n.current.currentTime=0)},loadAudio:async c=>{if(!c){h(null);return}try{const A=(await U.get(`/api/audios/${c}`)).data?.data;A&&A.file_path?(h(A.file_path),x(null)):(h(null),x("Audio file not found"))}catch(j){console.error("Failed to fetch audio:",j),x("Unable to load audio for this article."),h(null)}},resetAudio:()=>{n.current&&(n.current.pause(),n.current.currentTime=0),N(!1)},setAudioError:x}}const bt=G(()=>X(()=>import("../components/components-homophone.WOzUQXtP.js").then(l=>l.D),__vite__mapDeps([0,1,2,3,4,5])),{fallback:e.jsx(V,{type:"spinner"})}),St=G(()=>X(()=>import("../components/components-homophone.WOzUQXtP.js").then(l=>l.e),__vite__mapDeps([0,1,2,3,4,5])),{fallback:e.jsx(V,{type:"spinner"})}),jt=G(()=>X(()=>import("../components/components-homophone.WOzUQXtP.js").then(l=>l.f),__vite__mapDeps([0,1,2,3,4,5])),{fallback:e.jsx(V,{type:"spinner"})}),At=G(()=>X(()=>import("../components/components-homophone.WOzUQXtP.js").then(l=>l.C),__vite__mapDeps([0,1,2,3,4,5])),{fallback:e.jsx(V,{type:"spinner"})});function _t({articles:l=[],userRole:R}){const{auth:g}=Le().props,v=g?.user?.id,{setUser:n,can:b}=yt(),{success:h,error:o}=$e(),{articleId:N,userText:p,comparisonResults:x,metrics:C,setUserText:S,initializeSession:T,setComparisonResults:$,calculateAccuracy:L,resetSession:y}=Fe();s.useEffect(()=>{g?.user&&n(g.user)},[g?.user,n]);const[H]=s.useState(l),[r,W]=s.useState(null),[I,K]=s.useState(""),[m,d]=s.useState(""),[i,D]=s.useState(null),[M,c]=s.useState(!1),[j,A]=s.useState(!1),[ne,se]=s.useState(null),[_,z]=s.useState(null),[k,Y]=s.useState(!1),[ie,Ue]=s.useState(null),[We,ae]=s.useState({currentAccuracy:0,minRequired:70,bestAccuracy:0,comparisonAccuracy:0,currentTypingSpeed:0}),[B,pe]=s.useState(null),[Mt,ze]=s.useState(0),[Be,xe]=s.useState(0),[Oe,ye]=s.useState([]),[ge,Ve]=s.useState(!1),[qe,re]=s.useState(!1),[Ze,ce]=s.useState(!1),[Xe,le]=s.useState(!1),[Ge,we]=s.useState(!1),[Je,ve]=s.useState(!1),[Ke,Qe]=s.useState(null),[Ye,et]=s.useState([]),[tt,be]=s.useState(!1),[st,Se]=s.useState(null),[J,je]=s.useState(()=>g?.can?.student===!0?!0:g?.can?.student===!1?!1:typeof window<"u"&&window.__canAccessLibrary!==void 0?window.__canAccessLibrary:null),[ee,de]=s.useState(!1),ue=s.useRef(null),he=s.useRef(!1),oe=s.useRef(),Ae=s.useRef(""),O=Re(),q=Re(),u=vt(v,r,i,ie),at=()=>{if(!_?.stats||!_?.article_words)return 0;const t=_.stats.same||0,a=_.article_words.length||0;return a>0?t/a*100:0};s.useEffect(()=>{const t=`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;Ue(t);try{sessionStorage.setItem("sessionId",t)}catch{}},[]),s.useEffect(()=>{if(J!==null||!g?.user)return;let t=!1;return(async()=>{try{const w=(await fetch(route("api.user.can-access-library"),{headers:{"X-Requested-With":"XMLHttpRequest"}})).ok;t||(je(w),typeof window<"u"&&(window.__canAccessLibrary=w))}catch{t||je(!1)}})(),()=>t=!0},[g?.user,J]),s.useEffect(()=>{Ve(!g.user)},[g.user]),s.useEffect(()=>{if(!ee)return;const t=a=>{ue.current&&!ue.current.contains(a.target)&&de(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[ee]),s.useEffect(()=>{pe(null),ze(0),xe(0),ye([])},[r?.id]),s.useEffect(()=>{r?T(r.id,r.content):y()},[r,T,y]);const _e=t=>{if(isNaN(t))return"0:00";const a=Math.floor(t/60),w=Math.floor(t%60);return`${a}:${w.toString().padStart(2,"0")}`};s.useEffect(()=>{(!m.trim()||!r)&&(z(null),ae({currentAccuracy:0,minRequired:70,bestAccuracy:0,comparisonAccuracy:0,currentTypingSpeed:0}))},[m,r]),s.useEffect(()=>{if(!r){ae({currentAccuracy:0,minRequired:70,bestAccuracy:0,comparisonAccuracy:0,currentTypingSpeed:0});return}(async()=>{let a=0,w=0;_?.user_words&&_?.article_words?(a=_.user_words.length,w=_.article_words.length):a=await Pe(m);const E=w>0?Math.min(100,a/w*100):0,f=r.min_typed_words_percentage||70,P=r.best_accuracy||0,Q=_?.accuracy||0;let Z=0;if(B&&m.trim()){const Me=(Date.now()-B)/(1e3*60),it=m.trim().split(/\s+/).length;Z=Me>0?Math.round(it/Me):0}ae({currentAccuracy:E,minRequired:f,bestAccuracy:P,comparisonAccuracy:Q,currentTypingSpeed:Z})})()},[m,r,_]);const rt=async()=>{if(!v)return[];try{const t=await U.get("/grammar-checkers",{headers:{Accept:"application/json"}});return Array.isArray(t.data)?t.data:t.data.data||[]}catch(t){return t.response?.status!==401&&(console.error("Error fetching history:",t),o("Failed to fetch history")),[]}},ke=async()=>{be(!0);const t=await rt();et(t),be(!1)},Ne=async()=>{if(!(!r||!m.trim())){Y(!0);try{const t=await te.checkText({originalText:r.content,userText:m,articleId:r.id,userId:v,sessionId:ie});t&&Array.isArray(t.comparison)?(z(t),$(t),L(),h("Text comparison complete!")):(console.error("Invalid comparison result format:",t),z(null),o("Invalid comparison result"))}catch(t){console.error("Error in comparison:",t),z(null),o("Failed to compare text. Please try again.")}finally{Y(!1)}}},me=async(t,a)=>{if(!v)return;c(!0);const w=await Pe(a),E={user_id:v,title:t??"",paragraph:a??"",word_count:w,incorrect_word_count:0,reading_time:xt(w),article_id:r?r.id:null};if(i)try{const f=await U.patch(`/grammar-checkers/${i}`,E,{headers:{Accept:"application/json"}}),P=f.data?.id??f.data?.data?.id??i;D(P),se(Date.now()),r&&a.trim()&&Ne()}catch(f){console.error("Save update error:",f.response?.data??f),o("Failed to update document")}finally{c(!1)}else{if(he.current){c(!1);return}he.current=!0;try{const f=await U.post("/grammar-checkers",E,{headers:{Accept:"application/json"}}),P=f.data?.id??f.data?.data?.id??null;P&&(D(P),h("Document created and saved")),se(Date.now()),r&&a.trim()&&Ne()}catch(f){console.error("Save Document error:",f.response?.data??f),o("Failed to save document")}finally{he.current=!1,c(!1)}}};s.useEffect(()=>{if(!(!v||!I.trim()&&!m.trim()))return oe.current&&clearTimeout(oe.current),oe.current=setTimeout(()=>{me(I,m)},700),()=>clearTimeout(oe.current)},[I,m]);const Ce=t=>{const a=t.target.value;if(!B&&a.length>0&&pe(Date.now()),S(a),!v||!i)return;const w=Ae.current,E=w.length,f=a.length;if(f>E){const P=a.slice(E);setTimeout(()=>{P.split("").forEach(Q=>{U.post("/api/track/typing",{grammar_checker_id:Number(i),user_id:Number(v),character:Q,status:1}).catch(()=>{})})},80)}else if(f<E){const P=E-f,Q=w.slice(-P);xe(Z=>Z+P),ye(Z=>[...Z,{timestamp:Date.now(),characters:Q,count:P,position:f}]),setTimeout(()=>{Q.split("").forEach(Z=>{U.post("/api/track/typing",{grammar_checker_id:Number(i),user_id:Number(v),character:Z,status:0}).catch(()=>{})})},80)}Ae.current=a},Te=async t=>{if(W(t),de(!1),K(t?t.title:""),!t){u.resetAudio(),u.setAudioError(null);return}const a=t.audios_id;a?await u.loadAudio(a):u.resetAudio(),i&&me(I,m)},ot=async()=>{if(J===null){o("Permission check still in progress, please try again");return}if(i){if(_?.stats&&r){const t=_.stats,a=_.article_words?.length||0,w=t.same||0,E=a>0?w/a*100:0;await Ee(E)}J===!0?(ce(!0),await O.fetchAllStats(i)):(le(!0),await ke())}else{c(!0);try{if(await me(I,m),_?.stats&&r){const t=_.stats,a=_.article_words?.length||0,w=t.same||0,E=a>0?w/a*100:0;await Ee(E)}J===!0?(ce(!0),setTimeout(()=>{i&&O.fetchAllStats(i)},0)):(le(!0),await ke())}catch(t){console.error("Error during save:",t),o("Failed to save"),c(!1)}}},Ee=async t=>{if(!r?.id){console.warn("No article selected for completion");return}try{let a=null;if(B&&m.trim()){const f=(Date.now()-B)/(1e3*60),P=m.trim().split(/\s+/).length;a=f>0?Math.round(P/f):0}const w=await te.acceptComparison({userId:v,articleId:r.id,sessionId:ie,accuracy:t,typingSpeed:a,timeSpent:B?Math.round((Date.now()-B)/1e3):0,grammarCheckerId:i,metadata:{...C,accuracy:t}});if(w.success){const E={...w.completion,totalTimeSpent:B?Math.round((Date.now()-B)/1e3):0,deletedCharsCount:Be,deletedCharsDetail:Oe};Qe(E),ve(!0),h("Completion saved successfully!"),ae(f=>({...f,bestAccuracy:w.completion.best_accuracy||f.bestAccuracy}))}else o("Failed to save completion")}catch(a){console.error("Save completion error:",a),o("Failed to save completion. Please try again.")}},nt=async t=>{Se(t),we(!0),await q.fetchAllStats(t.id)},fe=t=>{t.preventDefault(),re(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(He,{title:"Homophone Check"}),e.jsx(ct,{}),e.jsxs("div",{className:"bg-gradient-to-b from-gray-50 to-white min-h-screen",children:[e.jsx(mt,{}),e.jsx("section",{className:"relative pb-8",children:e.jsx(lt,{children:e.jsxs("div",{className:`flex flex-row gap-4 transition-all duration-300 ${ge?"blur-sm":""}`,children:[e.jsx(F,{fallback:e.jsx("div",{className:"flex-1 bg-white rounded-2xl border border-red-200 p-4 h-[75vh] flex items-center justify-center shadow-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-semibold text-red-600 mb-2",children:"Editor Error"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load editor. Please refresh the page."})]})}),children:e.jsxs("div",{className:"flex-1 bg-white rounded-2xl border border-gray-200 p-4 h-[75vh] transition-shadow duration-200 hover:shadow-md shadow-sm flex flex-col",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center mb-3 gap-3",children:[r?.audios_id||u.audioUrl?e.jsxs("div",{className:"flex-1 mr-4",children:[e.jsx("audio",{ref:u.audioRef,src:u.audioUrl,onTimeUpdate:u.handleTimeUpdate,onLoadedMetadata:u.handleLoadedMetadata,onEnded:u.handleAudioEnded,className:"hidden"}),e.jsx("div",{className:"bg-white border border-gray-300 rounded-2xl px-3 py-1 transition-all duration-200 ease-in-out hover:shadow-md hover:border-gray-400 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:u.togglePlay,disabled:!u.audioUrl,className:`w-6 h-6 flex items-center justify-center text-white rounded-full transition ${u.audioUrl?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"}`,children:u.isPlaying?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M8 5v14l11-7z"})})}),e.jsxs("div",{className:"flex space-x-0",children:[e.jsx("button",{onClick:u.skipBackward,disabled:!u.audioUrl,className:`w-8 h-8 flex items-center justify-center rounded-full transition ${u.audioUrl?"hover:bg-gray-100":"opacity-50 cursor-not-allowed"}`,title:"Back 10s",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-700",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),e.jsx("path",{d:"M3 3v5h5"}),e.jsx("text",{x:"12",y:"16",fontSize:"8",fill:"currentColor",textAnchor:"middle",fontWeight:"bold",children:"10"})]})}),e.jsx("button",{onClick:u.skipForward,disabled:!u.audioUrl,className:`w-8 h-8 flex items-center justify-center rounded-full transition ${u.audioUrl?"hover:bg-gray-100":"opacity-50 cursor-not-allowed"}`,title:"Forward 10s",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-700",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"}),e.jsx("path",{d:"M21 3v5h-5"}),e.jsx("text",{x:"12",y:"16",fontSize:"8",fill:"currentColor",textAnchor:"middle",fontWeight:"bold",children:"10"})]})})]}),e.jsx("div",{className:"flex-1 flex items-center gap-2",children:u.audioUrl?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs text-gray-600 font-medium min-w-[35px]",children:_e(u.currentTime)}),e.jsx("div",{className:"flex-1 h-1.5 bg-gray-200 rounded-full cursor-pointer relative",onClick:u.handleSeek,children:e.jsx("div",{className:"h-full bg-blue-600 rounded-full transition-all",style:{width:`${u.currentTime/u.duration*100||0}%`}})}),e.jsx("span",{className:"text-xs text-gray-600 font-medium min-w-[35px]",children:_e(u.duration)})]}):e.jsx("span",{className:"text-xs text-gray-500 italic",children:"Loading audio..."})})]})})]}):e.jsx("div",{}),e.jsxs("div",{className:"relative w-64 flex-shrink-0",ref:ue,children:[e.jsxs("button",{type:"button",className:"w-full px-3 py-2.5 text-sm bg-white border border-gray-300 rounded-xl text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 ease-in-out hover:shadow-sm hover:border-gray-400",onClick:()=>de(!ee),children:[r?r.title:"Select an Article",e.jsx("svg",{className:`w-4 h-4 ml-2 transition-transform ${ee?"rotate-180":"rotate-0"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),e.jsx("div",{className:`absolute right-0 top-full mt-2 w-full bg-white border border-gray-200 rounded-xl shadow-sm z-50 max-h-60 overflow-y-auto hide-scrollbar transition-all duration-200 ease-in-out origin-top ${ee?"opacity-100 scale-100 translate-y-0 pointer-events-auto":"opacity-0 scale-95 -translate-y-2 pointer-events-none"}`,children:e.jsxs("div",{className:"px-2 py-2 space-y-1",children:[e.jsx("button",{type:"button",className:`w-full text-left px-4 py-2 text-sm rounded-xl transition-all duration-200 ease-in-out hover:scale-105 ${r?"hover:bg-gray-100 text-gray-700":"bg-blue-100 text-blue-700 font-medium"}`,onClick:()=>Te(null),children:"Select an Article"}),H.map((t,a)=>e.jsx("button",{type:"button",disabled:!t.can_access,className:`w-full text-left px-4 py-2 text-sm rounded-xl transition-all duration-200 ease-in-out hover:scale-105 ${r&&r.id===t.id?"bg-blue-100 text-blue-700 font-medium":t.can_access?"hover:bg-gray-100 text-gray-700":"opacity-40 cursor-not-allowed text-gray-400"}`,onClick:()=>t.can_access&&Te(t),title:t.can_access?"":t.lock_message,children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[!t.can_access&&e.jsx("span",{className:"text-sm",children:"ðŸ”’"}),e.jsx("span",{className:"font-mono text-gray-500",children:a+1}),". ",e.jsx("span",{children:t.title})]}),t.is_completed&&e.jsxs("div",{className:"ml-8 flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-0.5 text-xs font-semibold rounded-full bg-green-100 text-green-800 border border-green-300",children:"Completed"}),t.best_accuracy&&e.jsxs("span",{className:"text-xs text-gray-600",children:["Best: ",t.best_accuracy,"%",t.typing_speed&&` â€¢ ${t.typing_speed} WPM`]})]})]})},t.id))]})})]})]}),e.jsx("div",{className:"relative flex-1 mt-4",children:e.jsx("textarea",{className:`w-full h-full text-md bg-white border border-gray-200 rounded-xl py-3 px-3 focus:outline-none focus:ring-1 focus:ring-blue-500 placeholder-gray-500 resize-none overflow-y-auto hide-scrollbar ${j?"min-h-[50vh]":""}`,placeholder:"Type your text here...",value:m,onChange:t=>{d(t.target.value),Ce(t)},onInput:Ce,onDoubleClick:()=>A(!j),disabled:!r,onCopy:fe,onPaste:fe,onCut:fe})}),e.jsx("div",{className:"flex justify-end items-center mt-2 flex-shrink-0",children:e.jsx("button",{type:"button",onClick:ot,disabled:M||k||!m.trim()||J===null,className:`px-6 py-1 rounded-xl font-medium transition-all duration-200 ease-in-out ${M||k||!m.trim()||J===null?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 hover:scale-105 hover:shadow-sm active:scale-95"}`,children:M||k?"Checking...":"Save"})})]})}),e.jsx(F,{fallback:e.jsx("div",{className:"w-80 bg-white rounded-2xl border border-red-200 shadow-sm p-6 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-red-600",children:"Sidebar unavailable"})}),children:e.jsx(ft,{text:m,onReplace:d,checkerId:i,comparisonResult:_,setComparisonResult:z,articleId:r?.id,isChecking:k,liveProgress:We,selectedArticle:r,currentAccuracy:at()})})]})})})]}),e.jsx(F,{fallback:null,children:e.jsx(bt,{show:Ze,onClose:()=>ce(!1),docTitle:I,paragraph:m,lastSavedAt:ne,statsData:{comparisonActivities:O.comparisonActivities,accuracyStats:O.accuracyStats,activityStats:O.activityStats,audioActivities:O.audioActivities,loadingAccuracyStats:O.loadingAccuracyStats,loadingActivityStats:O.loadingActivityStats,loadingAudioActivities:O.loadingAudioActivities}})}),e.jsx(F,{fallback:null,children:e.jsx(St,{show:Xe,onClose:()=>le(!1),historyItems:Ye,loading:tt,onViewItem:nt})}),e.jsx(F,{fallback:null,children:e.jsx(jt,{show:Ge,onClose:()=>{we(!1),Se(null)},historyItem:st,statsData:{comparisonActivities:q.comparisonActivities,accuracyStats:q.accuracyStats,activityStats:q.activityStats,audioActivities:q.audioActivities,loadingAccuracyStats:q.loadingAccuracyStats,loadingActivityStats:q.loadingActivityStats,loadingAudioActivities:q.loadingAudioActivities}})}),e.jsx(F,{fallback:null,children:e.jsx(At,{show:Je,completionData:Ke,onClose:()=>{ve(!1)}})}),ge&&e.jsx("div",{className:"absolute inset-0 bg-opacity-20 flex items-center justify-center z-10",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-8 w-full max-w-xl mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-[24px] font-semibold text-gray-900 mb-2",children:"Create an account to get started"}),e.jsxs("p",{className:"text-gray-600 text-md leading-relaxed font-sans",children:["Create a free ",dt.NAME.SHORT," account to start Grammar Checker with AI"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("a",{href:route("auth.google"),className:"w-full flex items-center justify-center gap-3 px-3 py-3 border-[3px] border-gray-200 rounded-xl hover:bg-gray-50 transition-all duration-200 ease-in-out",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285f4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34a853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#fbbc05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#ea4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),e.jsx("span",{className:"text-gray-700 font-medium",children:"Sign Up with Google"})]}),e.jsxs(De,{href:route("register"),className:"w-full flex items-center justify-center gap-3 px-3 py-3 border-[3px] border-gray-200 rounded-xl hover:bg-gray-50 transition-all duration-200 ease-in-out",children:[e.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:e.jsxs("svg",{className:"w-12 h-12 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"}),e.jsx("path",{d:"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"})]})}),e.jsx("span",{className:"font-medium text-gray-500",children:"Sign Up by Email"})]})]}),e.jsxs("div",{className:"mt-6 text-md",children:[e.jsx("span",{className:"text-gray-500",children:"Or "}),e.jsx(De,{href:route("login"),children:e.jsx("span",{className:"text-blue-500 font-medium",children:"Sign In"})})," ","to an existing account"]})]})})}),e.jsx(ut,{show:qe,onClose:()=>re(!1),maxWidth:"xl",children:e.jsxs("form",{onSubmit:t=>{t.preventDefault(),re(!1)},className:"p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Action Not Allowed"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Copy, paste, and cut actions are disabled while typing in this field."}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"inline-block px-2 py-0.5 text-xs font-medium text-red-800 bg-red-100 rounded-full",children:"Please type manually."})}),e.jsx("div",{className:"flex justify-end gap-3 mt-3",children:e.jsx("button",{type:"button",onClick:()=>re(!1),className:"rounded-xl border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition-all duration-200 ease-in-out hover:scale-105 hover:shadow-sm active:scale-95 font-semibold",children:"Close"})})]})}),e.jsx(pt,{}),e.jsx(ht,{})]})}const $t=Object.freeze(Object.defineProperty({__proto__:null,default:_t},Symbol.toStringTag,{value:"Module"})),kt=G(()=>X(()=>import("../components/components-homophone.WOzUQXtP.js").then(l=>l.A),__vite__mapDeps([0,1,2,3,4,5])),{fallback:e.jsx(V,{type:"list",minHeight:"400px"})}),Nt=G(()=>X(()=>import("../components/components-homophone.WOzUQXtP.js").then(l=>l.E),__vite__mapDeps([0,1,2,3,4,5])),{fallback:e.jsx(V,{type:"text",minHeight:"500px"})}),Ct=G(()=>X(()=>import("../components/components-homophone.WOzUQXtP.js").then(l=>l.g),__vite__mapDeps([0,1,2,3,4,5])),{fallback:e.jsx(V,{type:"spinner",minHeight:"300px"})}),Tt=G(()=>X(()=>import("../components/components-homophone.WOzUQXtP.js").then(l=>l.S),__vite__mapDeps([0,1,2,3,4,5])),{fallback:e.jsx(V,{type:"card",minHeight:"300px"})});function Et({articles:l=[],userRole:R}){const{auth:g}=Le().props,v=g?.user?.id,{articleId:n,userText:b,comparisonResults:h,metrics:o,setUserText:N,initializeSession:p,setComparisonResults:x,calculateAccuracy:C,resetSession:S}=Fe(),{success:T,error:$}=$e(),[L]=s.useState(l),[y,H]=s.useState(null),[r,W]=s.useState(""),[I,K]=s.useState(!1),[m,d]=s.useState(!1),[i,D]=s.useState(null),[M,c]=s.useState(!1);s.useEffect(()=>{y?(p(y.id,y.content),W(y.title)):(S(),W(""))},[y]);const j=k=>{b&&!confirm("Switching articles will lose unsaved work. Continue?")||H(k)},A=k=>{N(k)},ne=async k=>{if(y){d(!0);try{await te.updateChecker(y.id,{paragraph:k,docTitle:r}),D(new Date),T("Progress saved automatically")}catch{$("Failed to save progress")}finally{d(!1)}}},se=async()=>{if(!(!y||!b)){K(!0);try{const k=await te.checkText({originalText:y.content,userText:b,articleId:y.id,userId:v,sessionId:Date.now().toString()});x(k),C(),T("Text comparison complete!")}catch(k){$("Failed to check text. Please try again."),console.error("Check text error:",k)}finally{K(!1)}}},_=async()=>{try{await te.acceptComparison({userId:v,articleId:y.id,sessionId:Date.now().toString(),accuracy:o.accuracy,metadata:o}),T("Result accepted! Moving to next article..."),x(null);const k=L.findIndex(Y=>Y.id===y.id);k<L.length-1&&H(L[k+1])}catch{$("Failed to save result")}},z=()=>{x(null)};return e.jsxs(e.Fragment,{children:[e.jsx(He,{title:"Homophone Check"}),e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx(F,{fallback:e.jsx("div",{className:"w-80 bg-white border-r border-gray-200 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load sidebar"})}),children:e.jsx("div",{className:"w-80 flex-shrink-0",children:e.jsx(kt,{articles:L,selectedArticle:y,onSelectArticle:j,completedArticleIds:[],lockedArticleIds:[]})})}),e.jsx(F,{fallback:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Editor Error"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Failed to load editor. Please refresh the page."})]})}),children:e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsx(Nt,{article:y,title:r,userText:b,onTitleChange:W,onTextChange:A,onSave:ne,isSaving:m,lastSavedAt:i,isZoomed:M,onToggleZoom:()=>c(!M),onCheckText:se,isChecking:I,canCheck:!!b&&!I,showProgress:!0,progress:o,autoSave:!0})})}),e.jsx(F,{fallback:e.jsx("div",{className:"w-80 bg-white border-l border-gray-200 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Stats unavailable"})}),children:e.jsx("div",{className:"w-80 flex-shrink-0 bg-white border-l border-gray-200 p-4 overflow-y-auto",children:e.jsx(Tt,{currentAccuracy:o.accuracy,bestAccuracy:o.accuracy,totalWords:o.totalWords,correctWords:o.correctWords,incorrectWords:o.incorrectWords,timeSpent:o.timeSpent,minRequired:70,showTarget:!0})})})]}),h&&e.jsx(F,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Comparison Error"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Failed to display comparison results."}),e.jsx("button",{onClick:z,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-xl hover:bg-blue-700",children:"Close"})]})}),children:e.jsx(Ct,{comparisonData:h,onAccept:_,onDismiss:z,onClose:z,isProcessing:!1})})]})}const Ft=Object.freeze(Object.defineProperty({__proto__:null,default:Et},Symbol.toStringTag,{value:"Module"}));export{$t as I,X as _,Ft as a};
