import{r as e,j as s}from"../vendor/vendor-react.CSh4geB6.js";import{u as t,H as l}from"../vendor/vendor-inertia.HwN2lMYo.js";import{a}from"./page-articles.BtzFlrUy.js";import{M as n,B as r}from"../components/components-common.mFbUzjoH.js";import{S as c,a4 as i,a5 as o,a6 as d}from"../vendor/vendor-ui.wXUDVBjR.js";import"../vendor/vendor-common.B_9lrMAm.js";import"../vendor/vendor-charts.30OvePoC.js";import"../vendor/vendor-utils.BR2dU08x.js";import"../components/components-homophone.BmTr8BPi.js";import"../vendor/vendor-animation.B6GxcyWq.js";function x(){const{analytics:x=[]}=t().props,p=[{value:"",label:"All Experience"},{value:"None",label:"None"},{value:"Beginner",label:"Beginner"},{value:"Intermediate",label:"Intermediate"},{value:"Advanced",label:"Advanced"},{value:"Expert",label:"Expert"}],m=[{value:"",label:"All Education"},{value:"Primary",label:"Primary"},{value:"Secondary",label:"Secondary"},{value:"High School",label:"High School"},{value:"Bachelor",label:"Bachelor"},{value:"Master",label:"Master"},{value:"Doctorate",label:"Doctorate"},{value:"Other",label:"Other"}],[h,u]=e.useState(""),[g,j]=e.useState(""),[b,y]=e.useState(""),[N,v]=e.useState(!1),[f,w]=e.useState(!1),[_,S]=e.useState(!1),[k,$]=e.useState(""),[C,A]=e.useState("json"),[E,L]=e.useState(!1),[q,z]=e.useState([]),[M,O]=e.useState("filtered"),T=e.useRef(null),B=e.useRef(null);e.useEffect(()=>{const e=e=>{T.current&&!T.current.contains(e.target)&&v(!1),B.current&&!B.current.contains(e.target)&&w(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);const F=e.useMemo(()=>x.filter(e=>{const s=h.trim().toLowerCase();if(s){const t=String(e.name||"").toLowerCase().includes(s),l=String(e.email||"").toLowerCase().includes(s);if(!t&&!l)return!1}return(!g||String(e.experience||"")===g)&&(!b||String(e.education||"")===b)}),[x,h,g,b]),[R,D]=e.useState(1);e.useEffect(()=>D(1),[h,g,b]);const I=Math.max(1,Math.ceil(F.length/15)),U=F.slice(15*(R-1),15*R);e.useEffect(()=>{z(e=>e.filter(e=>F.some(s=>s.id===e)))},[F]);const P=(e,s,t)=>{const l=new Blob([e],{type:t}),a=URL.createObjectURL(l),n=document.createElement("a");n.href=a,n.download=s,n.click(),URL.revokeObjectURL(a)},H=e=>String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),J=e=>`<?xml version="1.0" encoding="UTF-8"?>\n<Students>\n${e.map(e=>`   \n            <Student>\n                <id>${H(e.id)}</id>\n                <name>${H(e.name)}</name>\n                <email>${H(e.email)}</email>\n                <role>${H(e.role)}</role>\n                <age>${H(e.age)}</age>\n                <education>${H(e.education)}</education>\n                <experience>${H(e.experience)}</experience>\n                <total_articles>${H(e.total_articles)}</total_articles>\n                <total_quizzes>${H(e.total_quizzes)}</total_quizzes>\n                <total_questions>${H(e.total_questions)}</total_questions>\n                <incorrect_questions>${H(e.incorrect_questions)}</incorrect_questions>\n                <accepts>${H(e.accepts)}</accepts>\n                <dismiss>${H(e.dismiss)}</dismiss>\n                <total_typings>${H(e.total_typings)}</total_typings>\n                <incorrect_typings>${H(e.incorrect_typings)}</incorrect_typings>\n                <homo_avg>${H(e.homo_avg)}</homo_avg>\n                <avg_score>${H(e.avg_score||"N/A")}</avg_score>\n                <avg_pause>${H(e.avg_pause)}</avg_pause>\n            </Student>`).join("\n")}\n</Students>`,Q=e=>{const s=`${(e.name||`student_${e.id}`).replace(/[^\w\-_. ]/g,"_")}_${e.id}.${"json"===C?"json":"xml"}`,t="json"===C?JSON.stringify(e,null,2):J([e]);P(t,s,"json"===C?"application/json":"application/xml")},W=U.length>0&&U.every(e=>q.includes(e.id)),X="Student Analytics",G=[{title:"Home",url:"/"},{title:X,url:""}];return s.jsxs(a,{breadcrumb:s.jsx(r,{header:X,links:G}),children:[s.jsx(l,{title:X}),s.jsx("section",{className:"content",children:s.jsx("div",{className:"container-fluid",children:s.jsxs("div",{className:"bg-white shadow-md rounded-xl overflow-hidden border border-gray-200 mb-12",children:[s.jsxs("div",{className:"px-6 py-4 border-b flex flex-col md:flex-row justify-between items-center gap-3",children:[s.jsx("h3",{className:"text-xl font-semibold",children:X}),s.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[s.jsxs("div",{className:"relative",ref:T,children:[s.jsxs("button",{type:"button",className:"w-[180px] px-3 py-2 text-sm rounded-xl border bg-white shadow-sm flex justify-between items-center focus:outline-none",onClick:()=>v(!N),children:[p.find(e=>e.value===g)?.label||"Select Experience Level",s.jsx("svg",{className:"w-4 h-4 ml-2 transition-transform "+(N?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),N&&s.jsx("div",{className:"absolute left-0 top-full mt-2 w-[180px] bg-white border border-gray-200 rounded-xl shadow-lg z-50 max-h-44 overflow-y-auto",children:s.jsx("div",{className:"px-2 py-2 space-y-1",children:p.map(e=>s.jsx("button",{type:"button",className:"w-full text-left px-4 py-2 text-[14px] rounded-lg transition "+(g===e.value?"bg-blue-100 text-blue-700 font-bold":"hover:bg-gray-100 text-gray-700"),onClick:()=>{j(e.value),v(!1)},children:e.label},e.value))})})]}),s.jsxs("div",{className:"relative",ref:B,children:[s.jsxs("button",{type:"button",className:"w-[180px] px-3 py-2 text-sm rounded-xl border bg-white shadow-sm flex justify-between items-center focus:outline-none",onClick:()=>w(!f),children:[m.find(e=>e.value===b)?.label||"Select Education Level",s.jsx("svg",{className:"w-4 h-4 ml-2 transition-transform "+(f?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),f&&s.jsx("div",{className:"absolute left-0 top-full mt-2 w-[180px] bg-white border border-gray-200 rounded-xl shadow-lg z-50 max-h-44 overflow-y-auto",children:s.jsx("div",{className:"px-2 py-2 space-y-1",children:m.map(e=>s.jsx("button",{type:"button",className:"w-full text-left px-4 py-2 text-[14px] rounded-lg transition "+(b===e.value?"bg-blue-100 text-blue-700 font-bold":"hover:bg-gray-100 text-gray-700"),onClick:()=>{y(e.value),w(!1)},children:e.label},e.value))})})]}),s.jsxs("div",{className:"inline-flex items-center gap-2 px-3 rounded-xl border hover:shadow-lg transition text-sm bg-white",children:[s.jsx(c,{className:"w-4 h-4 text-gray-500"}),s.jsx("input",{value:h,onChange:e=>u(e.target.value),type:"text",placeholder:"Search by name or email",className:"px-2 outline-none border-none bg-transparent text-sm placeholder-gray-400 w-full min-w-[150px]"})]}),s.jsx("button",{onClick:()=>L(!E),className:"w-28 px-3 py-2 text-sm font-medium rounded-xl bg-blue-600 text-white hover:bg-blue-500 transition flex items-center justify-center gap-2",children:E?s.jsxs(s.Fragment,{children:[s.jsx(i,{className:"w-4 h-4"}),"Unselect"]}):s.jsxs(s.Fragment,{children:[s.jsx(o,{className:"w-4 h-4"}),"Select"]})}),s.jsxs("button",{onClick:()=>{O(q.length>0?"selected":"filtered"),S(!0)},className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl font-semibold text-sm text-white bg-green-600 hover:bg-green-500 transition",children:[s.jsx(d,{className:"w-4 h-4"})," Export",q.length>0&&` (${q.length})`]})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-max text-left border-collapse",children:[s.jsx("thead",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white",children:s.jsxs("tr",{children:[E&&s.jsx("th",{className:"py-3 px-6",children:s.jsx("input",{type:"checkbox",checked:W,onChange:()=>{const e=U.map(e=>e.id),s=e.every(e=>q.includes(e));z(s?s=>s.filter(s=>!e.includes(s)):s=>[...new Set([...s,...e])])},className:"w-4 h-4 rounded border-gray-300"})}),s.jsx("th",{className:"py-3 px-8",children:"#ID"}),s.jsx("th",{className:"py-3 px-8",children:"Name"}),s.jsx("th",{className:"py-3 px-8",children:"Email"}),s.jsx("th",{className:"py-3 px-8",children:"Role"}),s.jsx("th",{className:"py-3 px-8",children:"Age"}),s.jsx("th",{className:"py-3 px-8",children:"Education"}),s.jsx("th",{className:"py-3 px-8",children:"Experience"}),s.jsx("th",{className:"py-3 px-8",children:"Total Articles"}),s.jsx("th",{className:"py-3 px-8",children:"Total Quizzes"}),s.jsx("th",{className:"py-3 px-8",children:"Total Questions"}),s.jsx("th",{className:"py-3 px-8",children:"Incorrect Questions"}),s.jsx("th",{className:"py-3 px-8",children:"Accepts"}),s.jsx("th",{className:"py-3 px-8",children:"Dismiss"}),s.jsx("th",{className:"py-3 px-8",children:"Total Typings"}),s.jsx("th",{className:"py-3 px-8",children:"Incorrect Typings"}),s.jsx("th",{className:"py-3 px-8",children:"Avg Accuracy (%)"}),s.jsx("th",{className:"py-3 px-8",children:"Avg Score (%)"}),s.jsx("th",{className:"py-3 px-8",children:"Avg Pause (s)"}),s.jsx("th",{className:"py-3 px-8",children:"Actions"})]})}),s.jsx("tbody",{className:"text-gray-700",children:0===U.length?s.jsx("tr",{children:s.jsx("td",{colSpan:E?20:19,className:"py-12 text-center text-gray-500",children:"No analytics data available."})}):U.map(e=>s.jsxs("tr",{className:"border-t hover:bg-gray-50 transition",children:[E&&s.jsx("td",{className:"py-3 px-6",children:s.jsx("input",{type:"checkbox",checked:q.includes(e.id),onChange:()=>{return s=e.id,void z(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s},className:"w-4 h-4 rounded border-gray-300"})}),s.jsx("td",{className:"py-3 px-8",children:e.id}),s.jsx("td",{className:"py-3 px-8",children:e.name}),s.jsx("td",{className:"py-3 px-8",children:e.email}),s.jsx("td",{className:"py-3 px-8",children:e.role}),s.jsx("td",{className:"py-3 px-8",children:e.age||"N/A"}),s.jsx("td",{className:"py-3 px-8",children:e.education||"N/A"}),s.jsx("td",{className:"py-3 px-8",children:e.experience||"N/A"}),s.jsx("td",{className:"py-3 px-8",children:e.total_articles}),s.jsx("td",{className:"py-3 px-8",children:e.total_quizzes??"N/A"}),s.jsx("td",{className:"py-3 px-8",children:e.total_questions??"N/A"}),s.jsx("td",{className:"py-3 px-8",children:e.incorrect_questions??"N/A"}),s.jsx("td",{className:"py-3 px-8",children:e.accepts}),s.jsx("td",{className:"py-3 px-8",children:e.dismiss}),s.jsx("td",{className:"py-3 px-8",children:e.total_typings}),s.jsx("td",{className:"py-3 px-8",children:e.incorrect_typings}),s.jsx("td",{className:"py-3 px-8",children:e.homo_avg||"N/A"}),s.jsx("td",{className:"py-3 px-8",children:e.avg_score}),s.jsx("td",{className:"py-3 px-8",children:e.avg_pause||"N/A"}),s.jsx("td",{className:"py-3 px-8",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>Q(e),className:"px-2 py-1 rounded-md text-sm border bg-green-500 hover:bg-green-600 transition-colors text-gray-50",children:"JSON"}),s.jsx("button",{onClick:()=>{A("xml"),Q(e)},className:"px-2 py-1 rounded-md text-sm border bg-green-500 hover:bg-green-600 transition-colors text-gray-50",children:"XML"})]})})]},e.id))})]})}),s.jsx("div",{className:"mt-4 px-6 py-3 border-t border-gray-100",children:I>1&&s.jsxs("div",{className:"flex justify-center gap-2",children:[s.jsx("button",{onClick:()=>D(e=>Math.max(1,e-1)),disabled:1===R,className:"px-3 py-1 border rounded disabled:opacity-50",children:"Previous"}),s.jsxs("span",{className:"px-3 py-1",children:["Page ",R," of ",I]}),s.jsx("button",{onClick:()=>D(e=>Math.min(I,e+1)),disabled:R===I,className:"px-3 py-1 border rounded disabled:opacity-50",children:"Next"})]})})]})})}),s.jsx(n,{show:_,onClose:()=>S(!1),children:s.jsxs("div",{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Export Student Analytics Data"}),s.jsxs("div",{className:"mb-3 text-sm text-gray-600",children:["Selected: ",s.jsx("strong",{children:q.length})," â€” Filtered: ",s.jsx("strong",{children:F.length})]}),s.jsxs("div",{className:"flex gap-4 mb-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"File Name"}),s.jsx("input",{type:"text",value:k,onChange:e=>$(e.target.value),placeholder:"Enter file name",className:"w-full px-3 py-2 border rounded-md focus:ring-1 focus:ring-blue-500"})]}),s.jsxs("div",{className:"w-40",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"File Type"}),s.jsxs("select",{value:C,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border rounded-md",children:[s.jsx("option",{value:"json",children:"JSON"}),s.jsx("option",{value:"xml",children:"XML"})]})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("p",{className:"text-sm font-medium mb-3",children:"Export scope:"}),s.jsxs("div",{className:"space-x-6",children:[s.jsxs("label",{className:"inline-flex items-center",children:[s.jsx("input",{type:"radio",name:"scope",checked:"selected"===M,onChange:()=>O("selected"),disabled:0===q.length,className:"mr-2"}),s.jsxs("span",{children:["Selected (",q.length,")"]})]}),s.jsxs("label",{className:"inline-flex items-center",children:[s.jsx("input",{type:"radio",name:"scope",checked:"filtered"===M,onChange:()=>O("filtered"),className:"mr-2"}),s.jsxs("span",{children:["All Filtered (",F.length,")"]})]})]})]}),s.jsxs("div",{className:"flex justify-between gap-3",children:[s.jsx("button",{onClick:()=>S(!1),className:"px-4 py-1 border-2 border-gray-300 rounded-[10px] text-gray-700 hover:bg-gray-100 font-semibold",children:"Cancel"}),s.jsxs("button",{onClick:()=>{let e=[];if(e="selected"===M&&q.length>0?x.filter(e=>q.includes(e.id)):F,0===e.length)return void alert("No data to export!");const s=(new Date).toISOString().slice(0,19).replace("T","_").replace(/:/g,"-"),t="selected"===M?`selected_${e.length}_students_${s}`:`all_filtered_${e.length}_students_${s}`,l=`${k.trim()||t}.${"json"===C?"json":"xml"}`,a="json"===C?JSON.stringify(e,null,2):J(e);P(a,l,"json"===C?"application/json;charset=utf-8":"application/xml;charset=utf-8"),S(!1),$("")},className:"px-4 py-1 bg-green-600 text-white rounded-[10px] font-semibold hover:bg-green-700",children:["Export ","selected"===M?"Selected":"All"]})]})]})})]})}export{x as default};
