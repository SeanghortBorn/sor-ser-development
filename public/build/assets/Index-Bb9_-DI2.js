import{X as ee,r as l,j as e,S as se,x as te,A as b}from"./app-eDJyDaFf.js";import{B as re}from"./Breadcrumb-DGuLlkMK.js";import{M as A}from"./Modal-DU0HCvmy.js";import{P as le}from"./Pagination-swS4GL2L.js";import{A as ae}from"./AdminLayout-3-Aho6EH.js";import{h as ne}from"./moment-DgIkdrus.js";import{c as d}from"./createLucideIcon-gPHM0LOm.js";import{S as oe}from"./search-CV6ytSjn.js";import{P as ie}from"./pencil-Dcn1sXD5.js";import{R as de}from"./rotate-ccw-D8zubDX1.js";import{C as ce}from"./circle-check-big-CRhEhuTE.js";import"./transition-TsTO4E-m.js";import"./with-selector-FpA6BdYL.js";const xe=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],me=d("ban",xe);const he=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],ue=d("graduation-cap",he);const pe=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],be=d("shield-check",pe);const ge=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],fe=d("user-check",ge);const ye=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],je=d("user-plus",ye);const Ne=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ve=d("user",Ne);const we=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],ke=d("users-round",we);function ze({users:o,permissions:E=[],search:C="",userStats:g={}}){const{auth:T}=ee().props,r=T?.can??{},[D,i]=l.useState(!1),[a,m]=l.useState(null),[z,h]=l.useState([]),[f,c]=l.useState(!1),[G,y]=l.useState(!1),[n,j]=l.useState(null),[N,v]=l.useState(!1),[q,w]=l.useState(!1),[P,k]=l.useState(null),[U,u]=l.useState(""),[S,p]=l.useState(!1),[_,x]=l.useState(""),[I,B]=l.useState(C||""),L=[{id:"total",label:"Total Users",icon:"UsersRound",color:"text-blue-500",borderColor:"border-blue-100",bgColor:"bg-blue-50",value:0,description:"All users registered in the system"},{id:"employees",label:"Employees",icon:"UserCheck",color:"text-green-500",borderColor:"border-green-100",bgColor:"bg-green-50",value:0,description:"All verified staff or employee accounts"},{id:"students",label:"Experiment Group",icon:"GraduationCap",color:"text-orange-500",borderColor:"border-orange-100",bgColor:"bg-orange-50",value:0,description:"All student accounts currently active"},{id:"normal",label:"Control Group",icon:"User",color:"text-purple-500",borderColor:"border-purple-100",bgColor:"bg-purple-50",value:0,description:"All users without special roles"}],F=()=>{const s=o.data||[];return{total:s.length,employees:s.filter(t=>t.roles?.length>0).length,students:s.filter(t=>t.permissions?.length>0&&(!t.roles||t.roles.length===0)).length,normal:s.filter(t=>(!t.permissions||t.permissions.length===0)&&(!t.roles||t.roles.length===0)).length}},H=l.useMemo(()=>{const s=g&&Object.keys(g).length>0?g:F();return L.map(t=>({...t,value:s[t.id]??0}))},[g,o.data]);l.useEffect(()=>{B(C||"")},[C]);const W=s=>{m(s);const t=s.permissions?s.permissions.map(R=>R.id):[],$=E.find(R=>R.name==="student")?.id;h(t.length>0?t:$?[$]:[]),i(!0)},Y=s=>{s.preventDefault(),a&&(c(!0),window.axios.patch(route("users.update-permissions",a.id),{permissions:z}).then(()=>{c(!1),i(!1),b.reload({only:["users","userStats"]})}).catch(()=>c(!1)))},O=s=>{s.preventDefault(),a&&(c(!0),window.axios.patch(route("users.update-permissions",a.id),{permissions:[]}).then(()=>{c(!1),i(!1),b.reload({only:["users","userStats"]})}).catch(()=>c(!1)))},V=s=>{j(s),y(!0)},X=()=>{if(!n)return;v(!0);const s=n.blocked?route("users.unblock",n.id):route("users.block",n.id);window.axios.post(s).then(()=>{b.reload({only:["users","userStats"]})}).finally(()=>{v(!1),y(!1),j(null)})},J=s=>{k(s),u(""),x(""),w(!0)},K=s=>{if(s.preventDefault(),!P||!U.trim()){x("Password is required.");return}p(!0),x(""),window.axios.post(route("users.reset-password",P.id),{password:U}).then(()=>{w(!1),k(null),u(""),p(!1),b.reload({only:["users"]})}).catch(t=>{p(!1),x(t?.response?.data?.message||"Failed to reset password.")})},Q=s=>{const t=s.target.value||"";B(t),b.get(route("users.index"),{search:t},{preserveState:!0,replace:!0})},M="User List",Z=[{title:"Home",url:"/"},{title:M,url:""}];return e.jsxs(ae,{breadcrumb:e.jsx(re,{header:M,links:Z}),children:[e.jsx(se,{title:M}),e.jsx("section",{className:"content",children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:H.map(s=>e.jsxs("div",{className:`bg-white px-3 pb-2 pt-3 border-l-4 ${s.borderColor} shadow-sm rounded-xl flex flex-col hover:shadow-md transition-all duration-200`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-gray-800 text-base font-semibold",children:s.label}),e.jsxs("div",{className:`${s.color}`,children:[s.icon==="UsersRound"&&e.jsx(ke,{className:"w-7 h-7"}),s.icon==="UserCheck"&&e.jsx(fe,{className:"w-7 h-7"}),s.icon==="GraduationCap"&&e.jsx(ue,{className:"w-7 h-7"}),s.icon==="User"&&e.jsx(ve,{className:"w-7 h-7"})]})]}),e.jsxs("div",{className:"",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:s.value}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.description})]})]},s.id))}),e.jsxs("div",{className:"bg-white shadow-md rounded-xl overflow-hidden border border-gray-200 mb-12",children:[e.jsxs("div",{className:"px-6 py-4 border-b flex flex-col md:flex-row justify-between items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"User Management"}),e.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[e.jsx("form",{className:"inline-block",onSubmit:s=>s.preventDefault(),children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 rounded-xl border hover:shadow-lg transition text-sm bg-white",children:[e.jsx(oe,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search by name or email",className:"px-2 outline-none border-none bg-transparent text-sm placeholder-gray-400 w-full min-w-[150px] focus:outline-none focus:ring-0",value:I??"",onChange:Q})]})}),r["user-create"]&&r["user-list"]&&e.jsxs("a",{href:route("users.create"),className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl font-semibold text-sm text-white bg-green-600 hover:bg-green-500 transition",children:[e.jsx(je,{className:"w-4 h-4"}),"Add User"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-4",children:"#ID"}),e.jsx("th",{className:"py-3 px-4",children:"Name"}),e.jsx("th",{className:"py-3 px-4",children:"Email"}),e.jsx("th",{className:"py-3 px-4",children:"Role"}),e.jsx("th",{className:"py-3 px-4",children:"Blocked"}),e.jsx("th",{className:"py-3 px-4",children:"Created At"}),(r["user-edit"]||r["user-delete"]||r["user-list"])&&e.jsx("th",{className:"py-3 px-4 text-center",children:"Action"})]})}),e.jsx("tbody",{className:"text-sm text-gray-700",children:o.data.length>0?o.data.map(s=>e.jsxs("tr",{className:"border-t hover:bg-gray-50 transition",children:[e.jsx("td",{className:"py-3 px-4 font-semibold",children:s.id}),e.jsx("td",{className:"py-3 px-4",children:s.name}),e.jsx("td",{className:"py-3 px-4",children:s.email}),e.jsx("td",{className:"py-3 px-4",children:s.roles?.length>0?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-600 text-white",children:s.roles[0].name}):s.permissions?.length>0?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-600 text-white",children:"Student"}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-400 text-white",children:"No Access"})}),e.jsx("td",{className:"py-3 px-4",children:s.blocked?e.jsx("span",{className:"badge bg-red-600 text-white text-xs",children:"Blocked"}):e.jsx("span",{className:"badge bg-green-600 text-white text-xs",children:"Active"})}),e.jsx("td",{className:"py-3 px-4",children:ne(s.created_at).format("DD/MM/YYYY")}),(r["user-edit"]||r["user-block"]||r["user-list"])&&e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2 items-center",children:[r["user-edit"]&&r["user-create"]&&e.jsxs("div",{className:"relative group",children:[e.jsx(te,{href:route("users.edit",s.id),className:"inline-flex items-center gap-1.5 px-2 py-2 text-sm font-medium rounded-xl bg-blue-500 text-white hover:bg-blue-600 transition",children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-white text-gray-800 text-xs px-3 py-1 rounded-lg shadow-md border whitespace-nowrap z-10",children:"Edit User"})]}),r["user-edit"]&&r["user-create"]&&e.jsxs("div",{className:"relative group",children:[e.jsx("button",{type:"button",className:"inline-flex items-center gap-1.5 px-2 py-2 text-sm font-medium rounded-xl bg-indigo-600 text-white hover:bg-indigo-500 transition",onClick:()=>W(s),children:e.jsx(be,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-white text-gray-800 text-xs px-3 py-1 rounded-lg shadow-md border whitespace-nowrap z-10",children:"Assign Student Role"})]}),r["user-edit"]&&r["user-create"]&&e.jsxs("div",{className:"relative group",children:[e.jsx("button",{type:"button",className:"inline-flex items-center gap-1.5 px-2 py-2 text-sm font-medium rounded-xl bg-amber-500 text-white hover:bg-amber-600 transition",onClick:()=>J(s),children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-white text-gray-800 text-xs px-3 py-1 rounded-lg shadow-md border whitespace-nowrap z-10",children:"Reset Password"})]}),r["user-block"]&&e.jsxs("div",{className:"relative group",children:[e.jsx("button",{type:"button",className:`inline-flex items-center gap-1.5 px-2 py-2 text-sm font-medium rounded-xl ${s.blocked?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-400"} text-white transition`,onClick:()=>V(s),children:s.blocked?e.jsx(e.Fragment,{children:e.jsx(ce,{className:"w-4 h-4"})}):e.jsx(e.Fragment,{children:e.jsx(me,{className:"w-4 h-4"})})}),e.jsx("div",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-white text-gray-800 text-xs px-2 py-1 rounded-lg shadow-md border whitespace-nowrap z-10",children:s.blocked?"Unblock":"Block"})]})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:r["user-edit"]||r["user-block"]||r["user-list"]?7:6,className:"py-8 text-center text-gray-500",children:"No users found"})})})]})}),e.jsx(A,{show:G,onClose:()=>{y(!1),j(null),v(!1)},maxWidth:"lg",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),N||X()},className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:n?.blocked?"Unblock User":"Block User"}),e.jsx("p",{className:"text-gray-700 mb-4",children:n?.blocked?`Are you sure you want to unblock "${n?.name}"?`:`Are you sure you want to block "${n?.name}"? The user will not be able to log in.`}),e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{y(!1),j(null),v(!1)},className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",disabled:N,children:"Cancel"}),e.jsx("button",{type:"submit",className:`rounded-[10px] px-9 py-1 text-white font-semibold transition ${n?.blocked?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,disabled:N,children:N?"Saving...":n?.blocked?"Unblock":"Block"})]})]})}),e.jsx(A,{show:D,onClose:()=>{i(!1),h([]),m(null)},maxWidth:"xl",children:a&&a.permissions?.length===0&&a.roles?.length===0?e.jsxs("form",{onSubmit:Y,className:"p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Assign Student Permission"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:a?.name})," ","has no role yet. Click"," ",e.jsx("strong",{children:"Save"})," to give them the default ",e.jsx("strong",{children:"Student"})," role."]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"inline-block px-2 py-0.5 text-xs font-medium text-green-800 bg-green-100 rounded",children:"Default: Student"})}),e.jsxs("div",{className:"flex justify-between gap-3 mt-3",children:[e.jsx("button",{type:"button",onClick:()=>{i(!1),h([]),m(null)},className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold disabled:opacity-60",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:f,className:"rounded-[10px] px-9 py-1 bg-blue-600 text-white font-semibold hover:bg-blue-700 transition disabled:opacity-60",children:f?"Saving…":"Save"})]})]}):a?.roles?.length>0?e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"User Role Information"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:a?.name})," ","is assigned the following role:"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"inline-block px-3 py-1 text-sm font-medium text-green-900 bg-green-100 rounded-full",children:a?.roles?.[0]?.name})}),e.jsx("p",{className:"text-sm text-gray-500 italic",children:"This user has been assigned a role and cannot be modified through this interface."}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx("button",{type:"button",onClick:()=>{i(!1),h([]),m(null)},className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",children:"Close"})})]}):a?.permissions?.length>0?e.jsxs("form",{onSubmit:O,className:"p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Remove Student Permission"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:a?.name})," ","currently has the following permission:"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"inline-block px-3 py-1 text-sm font-medium text-blue-900 bg-blue-100 rounded-full",children:"Student"})}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Click ",e.jsx("strong",{children:"Remove"})," to revoke this permission."]}),e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{i(!1),h([]),m(null)},className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold disabled:opacity-60",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:f,className:"rounded-[10px] px-9 py-1 bg-red-600 text-white font-semibold hover:bg-red-700 transition disabled:opacity-60",children:f?"Removing…":"Remove"})]})]}):null}),e.jsx(A,{show:q,onClose:()=>{w(!1),k(null),u(""),p(!1),x("")},maxWidth:"lg",children:e.jsxs("form",{onSubmit:K,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Reset Password"}),e.jsxs("p",{className:"text-gray-700 mb-4",children:["Enter a new password for"," ",e.jsx("span",{className:"font-semibold",children:P?.name}),"."]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"New Password"}),e.jsx("input",{type:"password",placeholder:"Enter new password",className:"w-full px-3 py-2 border border-gray-300 rounded-xl transition-colors text-gray-600 focus:ring-3 focus:ring-gray-100 focus:outline-none text-[18px] font-medium",value:U||"",onChange:s=>u(s.target.value),disabled:S}),_&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:_})]}),e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{w(!1),k(null),u(""),p(!1),x("")},className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",disabled:S,children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-[10px] px-9 py-1 bg-blue-600 text-white font-semibold hover:bg-blue-700 transition",disabled:S,children:S?"Saving...":"Save"})]})]})}),o.total>10&&e.jsx("div",{className:"px-6 py-3 border-t flex justify-center",children:e.jsx(le,{links:o.links,currentPage:o.current_page,perPage:o.per_page})})]})]})})]})}export{ze as default};
