import{X as Y,r as n,j as e,S as ee}from"./app-B-_bgX9Y.js";import{A as se}from"./AdminLayout-CxgWV4ky.js";import{B as te}from"./Breadcrumb-EptjLIPs.js";import{M as le}from"./Modal-Syq7hL7D.js";import{S as ae}from"./search-DjOLbmHz.js";import{c as M}from"./createLucideIcon-tYSMIKgJ.js";import"./transition-DRnZbhWK.js";import"./with-selector-CYQwbavJ.js";const ne=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]],ce=M("file-up",ne);const re=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],oe=M("square-check-big",re);const ie=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],de=M("square",ie);function je(){const{analytics:w=[]}=Y().props,O=[{value:"",label:"All Experience"},{value:"None",label:"None"},{value:"Beginner",label:"Beginner"},{value:"Intermediate",label:"Intermediate"},{value:"Advanced",label:"Advanced"},{value:"Expert",label:"Expert"}],z=[{value:"",label:"All Education"},{value:"Primary",label:"Primary"},{value:"Secondary",label:"Secondary"},{value:"High School",label:"High School"},{value:"Bachelor",label:"Bachelor"},{value:"Master",label:"Master"},{value:"Doctorate",label:"Doctorate"},{value:"Other",label:"Other"}],[b,D]=n.useState(""),[d,U]=n.useState(""),[x,H]=n.useState(""),[S,_]=n.useState(!1),[k,$]=n.useState(!1),[V,y]=n.useState(!1),[T,I]=n.useState(""),[o,B]=n.useState("json"),[p,X]=n.useState(!1),[c,j]=n.useState([]),[m,A]=n.useState("filtered"),C=n.useRef(null),E=n.useRef(null);n.useEffect(()=>{const s=l=>{C.current&&!C.current.contains(l.target)&&_(!1),E.current&&!E.current.contains(l.target)&&$(!1)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]);const i=n.useMemo(()=>w.filter(s=>{const l=b.trim().toLowerCase();if(l){const t=String(s.name||"").toLowerCase().includes(l),r=String(s.email||"").toLowerCase().includes(l);if(!t&&!r)return!1}return!(d&&String(s.experience||"")!==d||x&&String(s.education||"")!==x)}),[w,b,d,x]),q=15,[h,L]=n.useState(1);n.useEffect(()=>L(1),[b,d,x]);const f=Math.max(1,Math.ceil(i.length/q)),u=i.slice((h-1)*q,h*q);n.useEffect(()=>{j(s=>s.filter(l=>i.some(t=>t.id===l)))},[i]);const F=(s,l,t)=>{const r=new Blob([s],{type:t}),v=URL.createObjectURL(r),g=document.createElement("a");g.href=v,g.download=l,g.click(),URL.revokeObjectURL(v)},a=s=>String(s??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),R=s=>`<?xml version="1.0" encoding="UTF-8"?>
<Students>
${s.map(t=>`   
            <Student>
                <id>${a(t.id)}</id>
                <name>${a(t.name)}</name>
                <email>${a(t.email)}</email>
                <role>${a(t.role)}</role>
                <age>${a(t.age)}</age>
                <education>${a(t.education)}</education>
                <experience>${a(t.experience)}</experience>
                <total_articles>${a(t.total_articles)}</total_articles>
                <total_quizzes>${a(t.total_quizzes)}</total_quizzes>
                <total_questions>${a(t.total_questions)}</total_questions>
                <incorrect_questions>${a(t.incorrect_questions)}</incorrect_questions>
                <accepts>${a(t.accepts)}</accepts>
                <dismiss>${a(t.dismiss)}</dismiss>
                <total_typings>${a(t.total_typings)}</total_typings>
                <incorrect_typings>${a(t.incorrect_typings)}</incorrect_typings>
                <homo_avg>${a(t.homo_avg)}</homo_avg>
                <avg_score>${a(t.avg_score||"N/A")}</avg_score>
                <avg_pause>${a(t.avg_pause)}</avg_pause>
            </Student>`).join(`
`)}
</Students>`,J=()=>{let s=[];if(m==="selected"&&c.length>0?s=w.filter(G=>c.includes(G.id)):s=i,s.length===0){alert("No data to export!");return}const l=new Date().toISOString().slice(0,19).replace("T","_").replace(/:/g,"-"),t=m==="selected"?`selected_${s.length}_students_${l}`:`all_filtered_${s.length}_students_${l}`,v=`${T.trim()||t}.${o==="json"?"json":"xml"}`,g=o==="json"?JSON.stringify(s,null,2):R(s);F(g,v,o==="json"?"application/json;charset=utf-8":"application/xml;charset=utf-8"),y(!1),I("")},P=s=>{const t=`${(s.name||`student_${s.id}`).replace(/[^\w\-_. ]/g,"_")}_${s.id}.${o==="json"?"json":"xml"}`,r=o==="json"?JSON.stringify(s,null,2):R([s]);F(r,t,o==="json"?"application/json":"application/xml")},K=s=>{j(l=>l.includes(s)?l.filter(t=>t!==s):[...l,s])},Q=()=>{const s=u.map(t=>t.id),l=s.every(t=>c.includes(t));j(l?t=>t.filter(r=>!s.includes(r)):t=>[...new Set([...t,...s])])},W=u.length>0&&u.every(s=>c.includes(s.id)),N="Student Analytics",Z=[{title:"Home",url:"/"},{title:N,url:""}];return e.jsxs(se,{breadcrumb:e.jsx(te,{header:N,links:Z}),children:[e.jsx(ee,{title:N}),e.jsx("section",{className:"content",children:e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"bg-white shadow-md rounded-xl overflow-hidden border border-gray-200 mb-12",children:[e.jsxs("div",{className:"px-6 py-4 border-b flex flex-col md:flex-row justify-between items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-semibold",children:N}),e.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[e.jsxs("div",{className:"relative",ref:C,children:[e.jsxs("button",{type:"button",className:"w-[180px] px-3 py-2 text-sm rounded-xl border bg-white shadow-sm flex justify-between items-center focus:outline-none",onClick:()=>_(!S),children:[O.find(s=>s.value===d)?.label||"Select Experience Level",e.jsx("svg",{className:`w-4 h-4 ml-2 transition-transform ${S?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),S&&e.jsx("div",{className:"absolute left-0 top-full mt-2 w-[180px] bg-white border border-gray-200 rounded-xl shadow-lg z-50 max-h-44 overflow-y-auto",children:e.jsx("div",{className:"px-2 py-2 space-y-1",children:O.map(s=>e.jsx("button",{type:"button",className:`w-full text-left px-4 py-2 text-[14px] rounded-lg transition ${d===s.value?"bg-blue-100 text-blue-700 font-bold":"hover:bg-gray-100 text-gray-700"}`,onClick:()=>{U(s.value),_(!1)},children:s.label},s.value))})})]}),e.jsxs("div",{className:"relative",ref:E,children:[e.jsxs("button",{type:"button",className:"w-[180px] px-3 py-2 text-sm rounded-xl border bg-white shadow-sm flex justify-between items-center focus:outline-none",onClick:()=>$(!k),children:[z.find(s=>s.value===x)?.label||"Select Education Level",e.jsx("svg",{className:`w-4 h-4 ml-2 transition-transform ${k?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),k&&e.jsx("div",{className:"absolute left-0 top-full mt-2 w-[180px] bg-white border border-gray-200 rounded-xl shadow-lg z-50 max-h-44 overflow-y-auto",children:e.jsx("div",{className:"px-2 py-2 space-y-1",children:z.map(s=>e.jsx("button",{type:"button",className:`w-full text-left px-4 py-2 text-[14px] rounded-lg transition ${x===s.value?"bg-blue-100 text-blue-700 font-bold":"hover:bg-gray-100 text-gray-700"}`,onClick:()=>{H(s.value),$(!1)},children:s.label},s.value))})})]}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 rounded-xl border hover:shadow-lg transition text-sm bg-white",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{value:b,onChange:s=>D(s.target.value),type:"text",placeholder:"Search by name or email",className:"px-2 outline-none border-none bg-transparent text-sm placeholder-gray-400 w-full min-w-[150px]"})]}),e.jsx("button",{onClick:()=>X(!p),className:"w-28 px-3 py-2 text-sm font-medium rounded-xl bg-blue-600 text-white hover:bg-blue-500 transition flex items-center justify-center gap-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4"}),"Unselect"]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4"}),"Select"]})}),e.jsxs("button",{onClick:()=>{A(c.length>0?"selected":"filtered"),y(!0)},className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl font-semibold text-sm text-white bg-green-600 hover:bg-green-500 transition",children:[e.jsx(ce,{className:"w-4 h-4"})," Export",c.length>0&&` (${c.length})`]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-max text-left border-collapse",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white",children:e.jsxs("tr",{children:[p&&e.jsx("th",{className:"py-3 px-6",children:e.jsx("input",{type:"checkbox",checked:W,onChange:Q,className:"w-4 h-4 rounded border-gray-300"})}),e.jsx("th",{className:"py-3 px-8",children:"#ID"}),e.jsx("th",{className:"py-3 px-8",children:"Name"}),e.jsx("th",{className:"py-3 px-8",children:"Email"}),e.jsx("th",{className:"py-3 px-8",children:"Role"}),e.jsx("th",{className:"py-3 px-8",children:"Age"}),e.jsx("th",{className:"py-3 px-8",children:"Education"}),e.jsx("th",{className:"py-3 px-8",children:"Experience"}),e.jsx("th",{className:"py-3 px-8",children:"Total Articles"}),e.jsx("th",{className:"py-3 px-8",children:"Total Quizzes"}),e.jsx("th",{className:"py-3 px-8",children:"Total Questions"}),e.jsx("th",{className:"py-3 px-8",children:"Incorrect Questions"}),e.jsx("th",{className:"py-3 px-8",children:"Accepts"}),e.jsx("th",{className:"py-3 px-8",children:"Dismiss"}),e.jsx("th",{className:"py-3 px-8",children:"Total Typings"}),e.jsx("th",{className:"py-3 px-8",children:"Incorrect Typings"}),e.jsx("th",{className:"py-3 px-8",children:"Avg Accuracy (%)"}),e.jsx("th",{className:"py-3 px-8",children:"Avg Score (%)"}),e.jsx("th",{className:"py-3 px-8",children:"Avg Pause (s)"}),e.jsx("th",{className:"py-3 px-8",children:"Actions"})]})}),e.jsx("tbody",{className:"text-gray-700",children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:p?20:19,className:"py-12 text-center text-gray-500",children:"No analytics data available."})}):u.map(s=>e.jsxs("tr",{className:"border-t hover:bg-gray-50 transition",children:[p&&e.jsx("td",{className:"py-3 px-6",children:e.jsx("input",{type:"checkbox",checked:c.includes(s.id),onChange:()=>K(s.id),className:"w-4 h-4 rounded border-gray-300"})}),e.jsx("td",{className:"py-3 px-8",children:s.id}),e.jsx("td",{className:"py-3 px-8",children:s.name}),e.jsx("td",{className:"py-3 px-8",children:s.email}),e.jsx("td",{className:"py-3 px-8",children:s.role}),e.jsx("td",{className:"py-3 px-8",children:s.age||"N/A"}),e.jsx("td",{className:"py-3 px-8",children:s.education||"N/A"}),e.jsx("td",{className:"py-3 px-8",children:s.experience||"N/A"}),e.jsx("td",{className:"py-3 px-8",children:s.total_articles}),e.jsx("td",{className:"py-3 px-8",children:s.total_quizzes??"N/A"}),e.jsx("td",{className:"py-3 px-8",children:s.total_questions??"N/A"}),e.jsx("td",{className:"py-3 px-8",children:s.incorrect_questions??"N/A"}),e.jsx("td",{className:"py-3 px-8",children:s.accepts}),e.jsx("td",{className:"py-3 px-8",children:s.dismiss}),e.jsx("td",{className:"py-3 px-8",children:s.total_typings}),e.jsx("td",{className:"py-3 px-8",children:s.incorrect_typings}),e.jsx("td",{className:"py-3 px-8",children:s.homo_avg||"N/A"}),e.jsx("td",{className:"py-3 px-8",children:s.avg_score}),e.jsx("td",{className:"py-3 px-8",children:s.avg_pause||"N/A"}),e.jsx("td",{className:"py-3 px-8",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>P(s),className:"px-2 py-1 rounded-md text-sm border bg-green-500 hover:bg-green-600 transition-colors text-gray-50",children:"JSON"}),e.jsx("button",{onClick:()=>{B("xml"),P(s)},className:"px-2 py-1 rounded-md text-sm border bg-green-500 hover:bg-green-600 transition-colors text-gray-50",children:"XML"})]})})]},s.id))})]})}),e.jsx("div",{className:"mt-4 px-6 py-3 border-t border-gray-100",children:f>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>L(s=>Math.max(1,s-1)),disabled:h===1,className:"px-3 py-1 border rounded disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"px-3 py-1",children:["Page ",h," of ",f]}),e.jsx("button",{onClick:()=>L(s=>Math.min(f,s+1)),disabled:h===f,className:"px-3 py-1 border rounded disabled:opacity-50",children:"Next"})]})})]})})}),e.jsx(le,{show:V,onClose:()=>y(!1),children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Export Student Analytics Data"}),e.jsxs("div",{className:"mb-3 text-sm text-gray-600",children:["Selected: ",e.jsx("strong",{children:c.length})," â€” Filtered: ",e.jsx("strong",{children:i.length})]}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"File Name"}),e.jsx("input",{type:"text",value:T,onChange:s=>I(s.target.value),placeholder:"Enter file name",className:"w-full px-3 py-2 border rounded-md focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"w-40",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"File Type"}),e.jsxs("select",{value:o,onChange:s=>B(s.target.value),className:"w-full px-3 py-2 border rounded-md",children:[e.jsx("option",{value:"json",children:"JSON"}),e.jsx("option",{value:"xml",children:"XML"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm font-medium mb-3",children:"Export scope:"}),e.jsxs("div",{className:"space-x-6",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"scope",checked:m==="selected",onChange:()=>A("selected"),disabled:c.length===0,className:"mr-2"}),e.jsxs("span",{children:["Selected (",c.length,")"]})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"scope",checked:m==="filtered",onChange:()=>A("filtered"),className:"mr-2"}),e.jsxs("span",{children:["All Filtered (",i.length,")"]})]})]})]}),e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx("button",{onClick:()=>y(!1),className:"px-4 py-1 border-2 border-gray-300 rounded-[10px] text-gray-700 hover:bg-gray-100 font-semibold",children:"Cancel"}),e.jsxs("button",{onClick:J,className:"px-4 py-1 bg-green-600 text-white rounded-[10px] font-semibold hover:bg-green-700",children:["Export ",m==="selected"?"Selected":"All"]})]})]})})]})}export{je as default};
