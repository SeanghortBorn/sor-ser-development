import{X as R,r as a,j as e,S as B,x as S,A}from"./app-oy554yv7.js";import{A as I}from"./AdminLayout-4I0T3Gtz.js";import{B as q}from"./Breadcrumb-Bb0-_AiX.js";import{P as H}from"./Pagination-Zv-dUU15.js";import{M as C}from"./Modal-F6ysEP4o.js";import{S as X}from"./search-DSvZjoWt.js";import{C as z}from"./clipboard-plus-DI02cpL1.js";import"./transition-Bc-xVr6w.js";import"./with-selector-CO6R7ptG.js";import"./createLucideIcon-d4101D4x.js";function le({articles:o,search:W=""}){const D=t=>{const r=t.user.roles?.some(n=>["Admin","Instructor"].includes(n.name)),s=t.user.permissions?.some(n=>n.name==="articles-view");return r||s},{auth:j}=R().props,i=j?.can??{},y=o?.data||[],[L,c]=a.useState(!1),[u,d]=a.useState(null),[p,x]=a.useState(!1),[P,f]=a.useState(!1),[l,N]=a.useState(null),[$,h]=a.useState(""),[F,w]=a.useState(!1),[m,T]=a.useState(W),M=t=>{d(t),c(!0)},U=t=>{t?.preventDefault?.(),u&&(x(!0),A.delete(route("articles.destroy",u.id),{preserveScroll:!0,onFinish:()=>{x(!1),c(!1),d(null)}}))},E=t=>{const r=t.target.value;T(r),A.get(route("articles.index"),{search:r},{preserveState:!0,replace:!0})},g=(t,r)=>{if(!t)return null;if(typeof t=="string")return t.startsWith("http://")||t.startsWith("https://")||t.startsWith("/storage/")?t:`/storage/uploads/${r}/${t}`;if(t.file_path){const s=String(t.file_path);return s.startsWith("http://")||s.startsWith("https://")||s.startsWith("/storage/")?s:s.startsWith("storage/")?`/${s}`:s.startsWith("uploads/")?`/storage/${s}`:s.startsWith("public/")?`/storage/${s.replace(/^public\//,"")}`:`/storage/uploads/${r}/${s}`}if(t.url)return t.url;if(t.path){const s=t.path.replace(/^public\//,"");return t.path.startsWith("http")||t.path.startsWith("/")?t.path:`/storage/${s}`}return t.filename?`/storage/uploads/${r}/${t.filename}`:t.name?`/storage/uploads/${r}/${t.name}`:null},v=t=>t?t.split(".").pop().toLowerCase():"",V=async t=>{N(t),h(""),f(!0),w(!0);const r=t.file?.title||t.file?.filename||"",s=v(r),n=g(t.file,"files");if(n&&s==="txt")try{const k=await(await fetch(n)).text();h(k)}catch{h("Failed to load file content.")}w(!1)},b="Articles List",_=[{title:"Home",url:"/"},{title:b,url:""}];return e.jsxs(I,{breadcrumb:e.jsx(q,{header:b,links:_}),children:[e.jsx(B,{title:b}),e.jsx("section",{className:"content",children:e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"bg-white shadow-md rounded-xl overflow-hidden border border-gray-200 mb-12",children:[e.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Articles"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 rounded-xl border hover:shadow-lg transition text-sm bg-white",children:[e.jsx(X,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",className:"px-2 w-[250px] py-2 rounded-[10px] border-none border-gray-300 text-sm  focus:outline-none focus:ring-0",placeholder:"Search Title or File",value:m,onChange:E})]}),i["article-create"]&&i["article-list"]&&e.jsxs(S,{href:route("articles.create"),className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl font-semibold text-sm text-white bg-green-600 hover:bg-green-500 transition",children:[e.jsx(z,{className:"w-4 h-4"}),"Add Article"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{className:"bg-blue-600 text-white text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"ID"}),e.jsx("th",{className:"px-4 py-3",children:"Title"}),e.jsx("th",{className:"px-4 py-3",children:"File"}),e.jsx("th",{className:"px-4 py-3",children:"Audio"}),e.jsx("th",{className:"px-4 py-3",children:"Created At"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-gray-200",children:y.length>0?y.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-4 py-3",children:t.id}),e.jsx("td",{className:"px-4 py-3",children:t.title}),e.jsx("td",{className:"px-4 py-3",children:t.file?t.file.title:e.jsx("span",{className:"text-gray-400",children:"NULL"})}),e.jsx("td",{className:"px-4 py-3",children:t.audio?t.audio.title:e.jsx("span",{className:"text-gray-400",children:"NULL"})}),e.jsx("td",{className:"px-4 py-3",children:t.created_at?t.created_at.slice(0,10):""}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[i["article-list"]&&e.jsx("button",{type:"button",onClick:()=>V(t),className:"px-3 py-1 rounded bg-gray-500 text-white text-xs hover:bg-gray-600",children:"View"}),i["article-edit"]&&i["article-list"]&&e.jsx(S,{href:route("articles.edit",t.id),className:"px-3 py-1 rounded bg-blue-500 text-white text-xs hover:bg-blue-600",children:"Edit"}),i["article-delete"]&&i["article-list"]&&e.jsx("button",{type:"button",onClick:()=>M(t),className:"px-3 py-1 rounded bg-red-500 text-white text-xs hover:bg-red-600",children:"Delete"}),D(j)&&e.jsx("button",{onClick:()=>window.location.href=route("articles.show",article.id),className:"text-blue-600 hover:text-blue-800",children:"View Article"})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-6 text-gray-500",children:"No articles found."})})})]})}),e.jsx(C,{show:L,onClose:()=>{c(!1),d(null),x(!1)},maxWidth:"lg",children:e.jsxs("form",{onSubmit:U,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Delete Article"}),e.jsxs("p",{className:"text-gray-700 mb-4",children:['Are you sure you want to delete "',u?.title,'"?']}),e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),d(null),x(!1)},className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",disabled:p,children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-[10px] px-9 py-1 text-white font-semibold transition bg-red-600 hover:bg-red-700",disabled:p,children:p?"Deleting...":"Delete"})]})]})}),e.jsx(C,{show:P,onClose:()=>{f(!1),N(null),h("")},maxWidth:"2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:["Article Name:",e.jsx("span",{className:"ml-1 text-blue-600",children:l?.title??""})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"font-bold text-gray-700 mb-1",children:["File Name:"," ",e.jsx("span",{className:"text-gray-600",children:l.file?.title||l.file?.filename||"File"})]}),l.file?(()=>{const t=g(l.file,"files"),r=l.file.title||l.file.filename||"File";return v(r)==="txt"?e.jsx("div",{className:"border rounded-lg bg-gray-50 p-3 max-h-64 overflow-auto text-sm",children:F?"Loading...":$||"No content."}):e.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:["Download ",r]})})():e.jsx("span",{className:"text-gray-400",children:"No file"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"font-bold text-gray-700 mb-1",children:["Audio Name:"," ",e.jsx("span",{className:"text-gray-600",children:l.audio?.title||l.audio?.filename||"Audio"})]}),l.audio?(()=>{const t=g(l.audio,"audios");return console.log("Audio URL:",t),e.jsx("audio",{src:t,controls:!0,preload:"metadata",className:"w-full rounded-lg"},t)})():e.jsx("span",{className:"text-gray-400",children:"No audio"})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:()=>f(!1),className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",children:"Close"})})]})}),o.total>10&&e.jsx("div",{className:"px-6 py-3 border-t flex justify-center",children:e.jsx(H,{links:o.links.map(t=>({...t,url:t.url?t.url+(m?(t.url.includes("?")?"&":"?")+"search="+encodeURIComponent(m):""):null})),currentPage:o.current_page,perPage:o.per_page})})]})})})]})}export{le as default};
