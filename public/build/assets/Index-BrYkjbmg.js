import{X as O,r as c,j as e,S as R,A as x}from"./app-BlP1oyqg.js";import{A as E}from"./AuthenticatedLayout-BY_yZodb.js";import{C as f}from"./circle-check-big-Dw5ix0pp.js";import{C as j}from"./circle-alert-Bs6YweRX.js";import{c as p}from"./createLucideIcon-BHE0qHjX.js";import{C as U,a as $,S as F}from"./save-Dmxvwevx.js";import{R as G}from"./rotate-ccw-Dg2Pj2xK.js";import{C as z,L as H,a as V}from"./lock-CYwyNp07.js";import{B as X}from"./book-open-C9w519WA.js";import"./Dropdown-D94TI0p5.js";import"./transition-BJRBwuAD.js";const J=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],K=p("grip-vertical",J);const Q=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],W=p("lock-open",Q);const Y=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Z=p("settings",Y);function ge({articles:v,articleOptions:_}){const{flash:d}=O().props,[o,u]=c.useState(null),[ee,g]=c.useState(null),[n,y]=c.useState(null),[m,N]=c.useState(v),[l,h]=c.useState({display_order:0,prerequisite_article_id:null,unlock_delay_days:0,unlock_delay_hours:0,availability_mode:"sequential",typing_mode:"nlp_only",slug:"",category:"",description:"",is_active:!0,is_required:!0,max_attempts:null,min_completion_accuracy:null}),w=t=>{if(o===t)u(null),g(null);else{const r=m.find(s=>s.id===t);u(t),g(r),h({display_order:r.setting.display_order||0,prerequisite_article_id:r.setting.prerequisite_article_id||null,unlock_delay_days:r.setting.unlock_delay_days||0,unlock_delay_hours:r.setting.unlock_delay_hours||0,availability_mode:r.setting.availability_mode||"sequential",typing_mode:r.setting.typing_mode||"nlp_only",slug:r.setting.slug||"",category:r.setting.category||"",description:r.setting.description||"",is_active:r.setting.is_active??!0,is_required:r.setting.is_required??!0,max_attempts:r.setting.max_attempts||null,min_completion_accuracy:r.setting.min_completion_accuracy||null})}},a=(t,r)=>{h(s=>({...s,[t]:r}))},k=t=>{x.put(route("article-settings.update",t),l,{preserveScroll:!0,onSuccess:()=>{u(null),g(null)}})},A=()=>{confirm("Are you sure you want to reset ALL article settings to default? This cannot be undone.")&&x.post(route("article-settings.reset"),{},{preserveScroll:!0})},C=(t,r)=>{y(r),t.dataTransfer.effectAllowed="move"},q=(t,r)=>{t.preventDefault(),!n||(n.id,r.id)},S=(t,r)=>{if(t.preventDefault(),!n||n.id===r.id)return;const s=[...m],I=s.findIndex(i=>i.id===n.id),P=s.findIndex(i=>i.id===r.id),[M]=s.splice(I,1);s.splice(P,0,M);const b=s.map((i,T)=>({...i,setting:{...i.setting,display_order:T+1}}));N(b);const B=b.map(i=>({article_id:i.id,display_order:i.setting.display_order}));x.post(route("article-settings.update-order"),{order:B},{preserveScroll:!0}),y(null)},D=t=>{const r={always:{color:"bg-green-100 text-green-800",icon:W,text:"Always"},sequential:{color:"bg-blue-100 text-blue-800",icon:H,text:"Sequential"},time_gated:{color:"bg-orange-100 text-orange-800",icon:z,text:"Time-Gated"}},s=r[t]||r.sequential;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${s.color}`,children:[e.jsx(s.icon,{className:"w-3 h-3"}),s.text]})},L=t=>t==="nlp_la"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[e.jsx(V,{className:"w-3 h-3"}),"NLP + LA"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(X,{className:"w-3 h-3"}),"NLP Only"]});return e.jsxs(E,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"font-semibold text-xl text-gray-800 leading-tight flex items-center gap-2",children:[e.jsx(Z,{className:"w-6 h-6"}),"Article Progression Settings"]}),e.jsxs("button",{onClick:A,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition",children:[e.jsx(G,{className:"w-4 h-4"}),"Reset All"]})]}),children:[e.jsx(R,{title:"Article Settings"}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[d?.success&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg flex items-center gap-2 text-green-700",children:[e.jsx(f,{className:"w-5 h-5"}),d.success]}),d?.error&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(j,{className:"w-5 h-5"}),d.error]}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"How to use:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Drag & drop"})," articles to reorder them"]}),e.jsxs("li",{children:["• Click on an article row to ",e.jsx("strong",{children:"expand and edit"})," its settings"]}),e.jsxs("li",{children:["• Set ",e.jsx("strong",{children:"prerequisites"})," to require users complete other articles first"]}),e.jsxs("li",{children:["• Use ",e.jsx("strong",{children:"time-gated"})," mode to add waiting periods between articles"]}),e.jsxs("li",{children:["• Choose ",e.jsx("strong",{children:"NLP + LA"})," for full features (experimental group)"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 text-sm font-medium text-gray-500",children:[e.jsx("div",{className:"col-span-1",children:"#"}),e.jsx("div",{className:"col-span-4",children:"Article"}),e.jsx("div",{className:"col-span-2",children:"Mode"}),e.jsx("div",{className:"col-span-2",children:"Typing"}),e.jsx("div",{className:"col-span-2",children:"Prerequisite"}),e.jsx("div",{className:"col-span-1",children:"Active"})]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:m.map((t,r)=>e.jsxs("div",{children:[e.jsx("div",{className:`px-6 py-4 cursor-pointer hover:bg-gray-50 transition ${o===t.id?"bg-blue-50":""} ${n?.id===t.id?"opacity-50":""}`,draggable:!0,onDragStart:s=>C(s,t),onDragOver:s=>q(s,t),onDrop:s=>S(s,t),onClick:()=>w(t.id),children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsxs("div",{className:"col-span-1 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-gray-400 cursor-grab"}),e.jsx("span",{className:"text-gray-500",children:t.setting.display_order})]}),e.jsxs("div",{className:"col-span-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.title}),t.setting.slug&&e.jsxs("div",{className:"text-xs text-gray-500",children:["slug: ",t.setting.slug]})]}),e.jsx("div",{className:"col-span-2",children:D(t.setting.availability_mode)}),e.jsx("div",{className:"col-span-2",children:L(t.setting.typing_mode)}),e.jsxs("div",{className:"col-span-2 text-sm text-gray-600",children:[t.setting.prerequisite_title||"-",t.setting.unlock_delay_days>0&&e.jsxs("span",{className:"text-orange-600 ml-1",children:["(+",t.setting.unlock_delay_days,"d)"]})]}),e.jsxs("div",{className:"col-span-1 flex items-center justify-between",children:[t.setting.is_active?e.jsx(f,{className:"w-5 h-5 text-green-500"}):e.jsx(j,{className:"w-5 h-5 text-gray-300"}),o===t.id?e.jsx(U,{className:"w-5 h-5 text-gray-400"}):e.jsx($,{className:"w-5 h-5 text-gray-400"})]})]})}),o===t.id&&e.jsxs("div",{className:"px-6 py-6 bg-gray-50 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Availability Mode"}),e.jsxs("select",{value:l.availability_mode,onChange:s=>a("availability_mode",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"always",children:"Always Available"}),e.jsx("option",{value:"sequential",children:"Sequential (requires prerequisite)"}),e.jsx("option",{value:"time_gated",children:"Time-Gated (requires waiting period)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prerequisite Article"}),e.jsxs("select",{value:l.prerequisite_article_id||"",onChange:s=>a("prerequisite_article_id",s.target.value||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:l.availability_mode==="always",children:[e.jsx("option",{value:"",children:"None"}),_.filter(s=>s.id!==t.id).map(s=>e.jsx("option",{value:s.id,children:s.title},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Typing Mode"}),e.jsxs("select",{value:l.typing_mode,onChange:s=>a("typing_mode",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"nlp_only",children:"NLP Only (Basic features)"}),e.jsx("option",{value:"nlp_la",children:"NLP + LA (Full features with analytics)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unlock Delay (Days)"}),e.jsx("input",{type:"number",min:"0",value:l.unlock_delay_days,onChange:s=>a("unlock_delay_days",parseInt(s.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:l.availability_mode!=="time_gated"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unlock Delay (Hours)"}),e.jsx("input",{type:"number",min:"0",max:"23",value:l.unlock_delay_hours,onChange:s=>a("unlock_delay_hours",parseInt(s.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:l.availability_mode!=="time_gated"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Slug (identifier)"}),e.jsx("input",{type:"text",value:l.slug,onChange:s=>a("slug",s.target.value),placeholder:"e.g., demo, pretest, p01",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Min Accuracy to Pass (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:l.min_completion_accuracy||"",onChange:s=>a("min_completion_accuracy",s.target.value?parseFloat(s.target.value):null),placeholder:"Leave empty for no minimum",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Attempts"}),e.jsx("input",{type:"number",min:"1",value:l.max_attempts||"",onChange:s=>a("max_attempts",s.target.value?parseInt(s.target.value):null),placeholder:"Unlimited",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.is_active,onChange:s=>a("is_active",s.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Active"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.is_required,onChange:s=>a("is_required",s.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Required"})]})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (shown to users)"}),e.jsx("textarea",{value:l.description,onChange:s=>a("description",s.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Brief description of this article..."})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>u(null),className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsxs("button",{onClick:()=>k(t.id),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:[e.jsx(F,{className:"w-4 h-4"}),"Save Changes"]})]})]})]},t.id))})]})]})})]})}export{ge as default};
