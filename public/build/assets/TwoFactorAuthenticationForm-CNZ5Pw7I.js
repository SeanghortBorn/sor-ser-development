import{r as a,G as M,j as e,c as W,X as z,A as T}from"./app-BjqCgIyx.js";import{I as P}from"./InputError-FSW--TRd.js";import{I as Q}from"./InputLabel-B0CSa8b7.js";import{T as q}from"./TextInput-D932YxnI.js";import{M as B}from"./Modal-UDtqqqRR.js";import"./transition-02Kcjz_l.js";function _({onConfirmed:E,children:l}){const[d,u]=a.useState(!1),o=a.useRef(),[m,w]=a.useState(localStorage.getItem("lang")||"en"),[j,p]=a.useState({}),[h,g]=a.useState(!1);a.useEffect(()=>{const s=()=>{w(localStorage.getItem("lang")||"en")};return window.addEventListener("lang-changed",s),window.addEventListener("storage",s),()=>{window.removeEventListener("lang-changed",s),window.removeEventListener("storage",s)}},[]);const{data:n,setData:c,post:F,processing:R,reset:x,errors:v}=M({password:""}),N=()=>{u(!0),setTimeout(()=>{var s;return(s=o.current)==null?void 0:s.focus()},250)},f=()=>{u(!1),x(),p({})},C=s=>{s.preventDefault(),g(!0),W.post(route("password.confirm"),{password:n.password}).then(r=>{f(),x(),p({}),setTimeout(()=>{E()},100)}).catch(r=>{var S;if(r.response&&r.response.data&&r.response.data.errors){const b={};Object.keys(r.response.data.errors).forEach(i=>{b[i]=r.response.data.errors[i][0]}),p(b),c("password","")}(S=o.current)==null||S.focus()}).finally(()=>g(!1))};return e.jsxs("span",{children:[e.jsx("span",{onClick:N,children:l}),e.jsx(B,{show:d,onClose:f,maxWidth:"lg",children:e.jsxs("form",{className:"p-6",onSubmit:C,children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Security Confirmation"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"For your security, please confirm your password to continue."}),e.jsxs("div",{className:"mt-6",children:[e.jsx(Q,{htmlFor:"password",value:"Enter Password"}),e.jsx(q,{id:"password",ref:o,type:"password",name:"password",value:n.password,onChange:s=>c("password",s.target.value),className:"mt-1 block w-full rounded-xl border border-gray-300 shadow-sm",placeholder:"Enter your Password"}),e.jsx(P,{message:j.password,className:"mt-2"})]}),e.jsxs("div",{className:"mt-6 flex justify-between items-center",children:[e.jsx("button",{type:"button",onClick:f,className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold disabled:opacity-60",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:"rounded-[10px] px-9 py-1 bg-blue-600 text-white font-semibold hover:bg-blue-700 transition disabled:opacity-60",children:h?"Confirming...":"Confirm"})]})]})})]})}const ee=({className:E=""})=>{var I,L,D;const{auth:l}=z().props,[d,u]=a.useState(!1),[o,m]=a.useState(!1),[w,j]=a.useState(!1),[p,h]=a.useState(null),[g,n]=a.useState(null),[c,F]=a.useState([]),[R,x]=a.useState(""),[v,N]=a.useState(!1),[f,C]=a.useState(!1),s=M({code:""}),r=(I=l.user)==null?void 0:I.two_factor_enabled,S=r&&!((L=l.user)!=null&&L.two_factor_confirmed_at);a.useEffect(()=>{var t;S?(m(!0),b()):r&&((t=l.user)!=null&&t.two_factor_confirmed_at)&&(m(!1),i(),h(null),n(null))},[r,(D=l.user)==null?void 0:D.two_factor_confirmed_at]);const b=async()=>{try{const t=await fetch(route("two-factor.qr-code"));if(t.ok){const k=await t.json();h(k.svg);const K=await fetch(route("two-factor.secret-key"));if(K.ok){const y=await K.json();if(y.secret)n(y.secret);else{const A=y.secretKey||y.key||Object.values(y)[0];A&&typeof A=="string"&&n(A)}}}}catch(t){console.error("Error fetching 2FA data:",t)}},i=async()=>{try{const t=await fetch(route("two-factor.recovery-codes"));if(t.ok){const k=await t.json();F(k)}}catch(t){console.error("Error fetching recovery codes:",t)}},G=()=>{u(!0),T.post(route("two-factor.enable"),{},{preserveScroll:!0,onSuccess:()=>{m(!0),b()},onError:()=>u(!1),onFinish:()=>u(!1)})};a.useEffect(()=>{o||(s.reset(),x(""))},[o,r]);const Y=()=>{N(!0),s.post(route("two-factor.confirm"),{preserveScroll:!0,onSuccess:()=>{m(!1),s.reset(),x(""),i()},onError:t=>{x(t.code||s.errors.code||"Invalid authentication code.")},onFinish:()=>N(!1)})},$=()=>{C(!0),T.post(route("two-factor.regenerate-recovery-codes"),{},{preserveScroll:!0,onSuccess:async()=>{await i()},onFinish:()=>C(!1)})},O=()=>{j(!0),T.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{h(null),n(null),F([]),m(!1)},onFinish:()=>j(!1)})};return e.jsxs("section",{className:`space-y-6 ${E}`,children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Two-Factor Authentication"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Add additional security to your account using two factor authentication."})]}),e.jsxs("div",{className:"max-w-xl",children:[r&&!o?e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"You have enabled Two-Factor Authentication."}):r&&o?e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Finish enabling Two-Factor Authentication."}):e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"You have not enabled Two-Factor Authentication."}),e.jsx("div",{className:"mt-3 text-sm text-gray-600",children:e.jsx("p",{children:"When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application."})}),r&&e.jsxs("div",{className:"mt-4",children:[o&&p&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"font-semibold mb-2 text-sm text-gray-600",children:o?"To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application.":"Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application."}),e.jsx("div",{dangerouslySetInnerHTML:{__html:p},className:"p-2 inline-block bg-white border border-gray-200 rounded"})]}),o&&g&&e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[e.jsxs("p",{className:"font-semibold",children:["Setup Key:"," ",e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:g})]}),e.jsx("p",{className:"mt-1",children:"If you can't scan the QR code, you can manually enter this setup key into your Authenticator App."})]}),o&&e.jsxs("div",{className:"mt-2",children:[e.jsx(Q,{htmlFor:"code",value:"Authentication Code"}),e.jsx(q,{id:"code",value:s.data.code,onChange:t=>s.setData("code",t.target.value),type:"text",placeholder:"Enter Code 6 Digits",maxLength:6,inputMode:"numeric",className:"block mt-1 w-1/2 rounded-xl border border-gray-300 shadow-sm",autoFocus:!0,autoComplete:"one-time-code"}),e.jsx(P,{message:R,className:"mt-2"})]}),c.length>0&&!o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:e.jsx("p",{className:"font-semibold",children:"Store these recovery codes safely (like in a password manager). You can use them to access your account if you lose your two-factor authentication device. Each code can be used only once after a new login."})}),e.jsx("div",{className:"grid gap-1 mt-4 px-4 py-4 font-mono text-sm bg-gray-100 rounded-lg",children:c.map(t=>e.jsx("div",{children:t},t))})]})]}),e.jsx("div",{className:"mt-5",children:r?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_,{onConfirmed:O,children:e.jsx("button",{type:"button",disabled:w,className:`flex items-center space-x-2 px-4 py-2 rounded-[10px] border-2 border-gray-300 text-gray-700 hover:bg-gray-100 transition font-semibold disabled:opacity-60
                                        ${w?"opacity-50 cursor-not-allowed":"hover:bg-gray-100"} 
                                        border-gray-300`,children:e.jsx("span",{className:"text-sm text-gray-700",children:o?"Cancel":"Disable"})})}),o&&e.jsx("button",{type:"button",disabled:d||v,onClick:Y,className:`flex items-center space-x-2 px-4 py-2 rounded-[10px] bg-blue-600 text-blue-700 transition font-semibold disabled:opacity-60
                                        ${d||v?"opacity-50 cursor-not-allowed":"hover:bg-blue-500"}`,children:e.jsx("span",{className:"text-sm text-white",children:v?"Confirming...":"Confirm"})}),c.length>0&&!o&&e.jsx("button",{type:"button",onClick:$,disabled:f,className:"flex items-center space-x-2 px-4 py-2 rounded-[10px] bg-blue-600 text-blue-700 hover:bg-blue-500 transition font-semibold disabled:opacity-60",children:e.jsx("span",{className:"text-sm text-white",children:f?"Generating...":"Generate New"})}),c.length===0&&!o&&e.jsx(_,{onConfirmed:i,children:e.jsx("button",{className:"flex items-center space-x-2 px-4 py-2 rounded-[10px] bg-blue-600 hover:bg-blue-500 text-blue-700 transition font-semibold disabled:opacity-60",children:e.jsx("span",{className:"text-sm text-white",children:"Show Recovery Codes"})})})]}):e.jsx(_,{onConfirmed:G,children:e.jsxs("button",{type:"button",disabled:d,className:`flex items-center space-x-2 px-4 py-2 rounded-[10px] border-2 border-blue-500 text-blue-700 hover:bg-blue-100 transition font-semibold disabled:opacity-60
                                    ${d?"opacity-50 cursor-not-allowed":"hover:bg-blue-100"} 
                                    border-blue-500`,children:[e.jsxs("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"}),e.jsx("path",{d:"m9 12 2 2 4-4"})]}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:"Enable"})]})})})]})]})};export{ee as default};
