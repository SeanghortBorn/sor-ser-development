import{G,r as h,j as e,S as W,x as q}from"./app-Cisu2Mpw.js";import{B as H}from"./Breadcrumb-Bw2efUcI.js";import{I as P}from"./InputError-3qF0MLgq.js";import{A as Q}from"./AdminLayout-_pXQNJDa.js";import{c as _}from"./createLucideIcon-B7QK4j4T.js";import{E as J}from"./eye-C18jRpRY.js";import{P as X,T as Y}from"./trash-2-umb5pmqm.js";import{P as Z}from"./pencil-CSuT7MiC.js";import{L as K}from"./lock-C-BZMuM4.js";import{S as ee}from"./settings-CuJBFB82.js";import{U as S}from"./users-Bi4Frzww.js";import{B as A}from"./book-open-BikijmoO.js";const se=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V9",key:"uvy0l4"}],["path",{d:"M19 21V3",key:"11j9sm"}]],re=_("chart-no-axes-column-increasing",se);const te=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],b=_("shield",te);function fe({role:n,permissions:g,pages:m=[]}){const{data:o,setData:c,post:E,patch:L,errors:p,reset:N,processing:w}=G({name:n?.name||"",permissions:[],page_permissions:{}}),[f,z]=h.useState(""),[y,k]=h.useState("permissions"),[I,x]=h.useState("");h.useEffect(()=>{if(n!==void 0){const s=n.permissions.map(r=>r.id);c("permissions",s),n.page_permissions&&c("page_permissions",n.page_permissions)}},[n]);const C={"nlp-only":{label:"NLP-only (Basic)",description:"Can view article list and check homophones",permissions:["article-list","homophone-list"],pages:{dashboard:["view"],articles:["view"],"user-progress":["own"]}},"nlp-la":{label:"NLP+LA (Full Features)",description:"Everything NLP-only has + learning analytics",permissions:["article-list","homophone-list","quiz-list"],pages:{dashboard:["view"],articles:["view"],"user-progress":["view","own"]}},instructor:{label:"Instructor",description:"Can manage groups, view all progress, create articles",permissions:["article-list","article-create","article-edit","homophone-list","quiz-list","user-list","role-list"],pages:{dashboard:["view"],articles:["view","create","update"],"user-progress":["view"],users:["view","create","update"],roles:["view"]}},admin:{label:"Admin (Full Access)",description:"Complete system access",permissions:"all",pages:"all"}},R=s=>{const r=C[s];if(r){if(r.permissions==="all"){const t=g.map(l=>l.id);c("permissions",t)}else{const t=g.filter(l=>r.permissions.includes(l.name)).map(l=>l.id);c("permissions",t)}if(r.pages==="all"){const t={};(m||[]).forEach(l=>{t[l.page_name]={view:!0,create:!0,update:!0,delete:!0}}),c("page_permissions",t)}else{const t={};Object.entries(r.pages).forEach(([l,a])=>{t[l]={},a.forEach(i=>{t[l][i]=!0})}),c("page_permissions",t)}x(s)}},T=s=>{const r=parseInt(s.target.value);s.target.checked?o.permissions.includes(r)||c("permissions",[...o.permissions,r]):c("permissions",o.permissions.filter(t=>t!==r)),x("")},B=(s,r)=>{const t=r.map(a=>a.id);if(t.every(a=>o.permissions.includes(a)))c("permissions",o.permissions.filter(a=>!t.includes(a)));else{const a=[...o.permissions];t.forEach(i=>{a.includes(i)||a.push(i)}),c("permissions",a)}x("")},F=(s,r)=>{const t=o.page_permissions[s]||{},l={...o.page_permissions,[s]:{...t,[r]:!t[r]}};c("page_permissions",l),x("")},O=s=>{s.preventDefault(),n==null?E(route("roles.store"),{preserveState:!0,onFinish:()=>N()}):L(route("roles.update",n.id),{preserveState:!0,onFinish:()=>N()})},j=s=>s.split("-").map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join(" "),v=(()=>{const s={};return g.forEach(r=>{const t=r.name.split("-"),l=["list","create","edit","delete","export","import","view","manage","own"];let a,i;const d=t[t.length-1];l.includes(d)?(i=d,a=t.slice(0,-1).join("-")):(a=t[0],i=t.slice(1).join("-")),s[a]||(s[a]=[]),s[a].push({...r,action:i,displayAction:j(i)})}),Object.keys(s).forEach(r=>{s[r].sort((t,l)=>{const a=["list","view","create","edit","update","delete","own","manage"];return a.indexOf(t.action)-a.indexOf(l.action)})}),s})(),M=Object.keys(v).filter(s=>s.toLowerCase().includes(f.toLowerCase())||v[s].some(r=>r.displayAction.toLowerCase().includes(f.toLowerCase()))),U=[{key:"view",label:"View",icon:J,color:"blue"},{key:"create",label:"Create",icon:X,color:"green"},{key:"update",label:"Update",icon:Z,color:"yellow"},{key:"delete",label:"Delete",icon:Y,color:"red"},{key:"own",label:"Own Data",icon:K,color:"purple"}],$=s=>({dashboard:re,"user-progress":S,articles:A,roles:b,users:S,settings:ee})[s]||A,u=n?.id?"Edit Role":"Create Role",V=[{title:"Home",url:"/"},{title:"Roles",url:route("roles.index")},{title:u,url:""}];return e.jsxs(Q,{breadcrumb:e.jsx(H,{header:u,links:V}),children:[e.jsx(W,{title:u}),e.jsx("section",{className:"content",children:e.jsx("div",{className:"container-fluid sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-gradient-to-br from-slate-50 to-blue-50/30 mb-12",children:e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:u}),e.jsx("p",{className:"text-gray-500",children:n?.id?"Update role details, permissions, and page access":"Create a new role with permissions and page access"})]}),e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:["Role Name"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"name",name:"name",type:"text",placeholder:"Enter role name (e.g., Group A: NLP-only)",value:o.name,onChange:s=>c("name",s.target.value),className:`block mt-2 w-full px-3 py-[11px] text-sm rounded-xl border ${p.name?"border-red-300 focus:ring-red-200 focus:border-red-400":"border-gray-300 focus:ring-blue-200 focus:border-blue-400"} placeholder-gray-400 shadow-sm focus:outline-none focus:ring-2`}),p.name&&e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})})]}),e.jsx(P,{message:p.name,className:"mt-1 text-sm text-red-600"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Quick Templates"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:Object.entries(C).map(([s,r])=>e.jsxs("button",{type:"button",onClick:()=>R(s),className:`p-3 rounded-lg border-2 transition-all text-left ${I===s?"border-blue-500 bg-blue-100":"border-blue-200 bg-white hover:border-blue-400 hover:bg-blue-50"}`,children:[e.jsx("div",{className:"font-semibold text-sm text-gray-900 mb-1",children:r.label}),e.jsx("div",{className:"text-xs text-gray-600",children:r.description})]},s))}),e.jsx("p",{className:"text-xs text-blue-700 mt-3",children:"ðŸ’¡ Select a template to quickly configure permissions, or customize manually below"})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-4",children:[e.jsxs("button",{type:"button",onClick:()=>k("permissions"),className:`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${y==="permissions"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["Feature Permissions",e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full text-xs bg-gray-100",children:o.permissions.length})]}),e.jsxs("button",{type:"button",onClick:()=>k("pages"),className:`pb-3 px-1 border-b-2 font-medium text-sm transition-colors ${y==="pages"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["Page Access Control",e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full text-xs bg-gray-100",children:Object.keys(o.page_permissions).length})]})]})}),y==="permissions"?e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["Feature Permissions"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx("input",{type:"text",placeholder:"Search modules...",value:f,onChange:s=>z(s.target.value),className:"pl-10 pr-16 py-2 border border-gray-300 rounded-xl focus:ring-0 w-full"}),e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:M.map(s=>{const r=v[s],t=r.filter(i=>o.permissions.includes(i.id)).length,l=t===r.length,a=t>0&&t<r.length;return e.jsxs("div",{className:"bg-white border border-blue-100 rounded-xl shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"p-4 border-b border-blue-100 bg-gradient-to-r from-blue-50 to-blue-50 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-blue-700 capitalize flex items-center",children:j(s)}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`px-2 py-1 text-xs rounded-full ${l?"bg-blue-100 text-blue-800":a?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-600"}`,children:[t,"/",r.length]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,ref:i=>{i&&(i.indeterminate=a)},onChange:()=>B(s,r),className:"form-checkbox mt-2 h-4 w-4 text-blue-500 rounded border-gray-300 focus:ring-blue-500 focus:ring-1"}),e.jsx("span",{className:"ml-2 mt-2 text-xs text-gray-600",children:"All"})]})]})]})}),e.jsx("div",{className:"p-3",children:r.map(i=>e.jsxs("label",{className:"flex items-center space-x-4 cursor-pointer group hover:bg-blue-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",value:i.id,checked:o.permissions.includes(i.id),onChange:T,className:"form-checkbox h-4 w-4 text-blue-500 rounded border-gray-300 focus:ring-1 focus:ring-blue-500"}),e.jsx("div",{className:"flex items-center space-x-2 flex-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-700",children:i.displayAction})})]},i.id))})]},s)})}),e.jsx(P,{className:"mt-4 text-sm text-red-600",message:p.permissions})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Page Access Control"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Control which pages this role can access and what actions they can perform."}),e.jsx("div",{className:"space-y-4",children:m&&m.length>0?m.map(s=>{const r=$(s.page_name),t=o.page_permissions[s.page_name]||{},l=Object.values(t).filter(Boolean).length;return e.jsxs("div",{className:"border border-gray-200 rounded-xl p-4 hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(r,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 capitalize",children:j(s.page_name)}),e.jsx("p",{className:"text-xs text-gray-500",children:s.description||"Page access control"})]})]}),l>0&&e.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[l," enabled"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:U.map(a=>{const i=a.icon,d=t[a.key],D={blue:"bg-blue-100 text-blue-700 border-blue-300",green:"bg-green-100 text-green-700 border-green-300",yellow:"bg-yellow-100 text-yellow-700 border-yellow-300",red:"bg-red-100 text-red-700 border-red-300",purple:"bg-purple-100 text-purple-700 border-purple-300"};return e.jsxs("button",{type:"button",onClick:()=>F(s.page_name,a.key),className:`inline-flex items-center gap-2 px-3 py-2 rounded-lg border-2 text-sm font-medium transition-all ${d?D[a.color]:"bg-gray-50 text-gray-400 border-gray-200"} hover:scale-105`,children:[e.jsx(i,{className:"w-4 h-4"}),a.label,d&&e.jsx("span",{className:"ml-1",children:"âœ“"})]},a.key)})})]},s.id)}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(b,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No pages available for access control"}),e.jsx("p",{className:"text-sm",children:"Run migrations to create page permissions"})]})})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row sm:justify-end gap-3 pt-6 mt-6 border-t border-gray-200",children:[e.jsxs(q,{href:route("roles.index"),className:"inline-flex items-center justify-center px-4 py-2 text-sm font-medium rounded-xl text-gray-700 border hover:bg-gray-200 hover:border-gray-400 hover:text-gray-900 transition duration-200",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Cancel"]}),e.jsx("button",{type:"submit",disabled:w,className:"inline-flex items-center justify-center px-6 py-2 text-sm font-medium rounded-xl text-white bg-gradient-to-r from-blue-500 to-blue-500 shadow-sm transition duration-200 hover:from-blue-500 hover:to-blue-500 disabled:opacity-70 disabled:cursor-not-allowed",children:w?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n?.id?"Updating...":"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),n?.id?"Update Role":"Create Role"]})})]})]})]})})})})})]})}export{fe as default};
