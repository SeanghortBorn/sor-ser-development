import{X as Ee,j as e,r,R as Oe,a as E,S as Ge,x as Fe}from"./app-B-_bgX9Y.js";import{H as qe}from"./HeaderNavbar-RhY9PMpb.js";import{F as Xe}from"./Footer-KFhtnHRp.js";import{B as Ye,Z as Ke,R as Ze,C as We}from"./zap-Chr0-cE6.js";import{M as xe}from"./Modal-Syq7hL7D.js";import{c as we}from"./createLucideIcon-tYSMIKgJ.js";import{R as Je,C as Qe,T as et,L as tt}from"./CategoricalChart-DG_VbK_a.js";import{P as st,a as at}from"./PieChart-ZFOeS3wF.js";import"./transition-DRnZbhWK.js";import"./with-selector-CYQwbavJ.js";import"./defaultLocale-DZ0G4mR_.js";const rt=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],nt=we("arrow-right",rt);const it=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Be=we("check",it);const lt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ue=we("circle-x",lt);const ct=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ot=we("trash",ct);function dt(){const{auth:x}=Ee().props;return e.jsx("div",{className:"max-w-7xl mx-auto px-4 mt-10",children:x.user?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-center ",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-semibold text-gray-600",children:["Triple your productivity with the"," ",e.jsx("span",{className:"text-blue-500 font-semibold",children:"Homophone Checker"})]}),e.jsx("p",{className:"text-gray-600 mt-4 max-w-6xl mx-auto",children:"SorSer's Homophone Checker uses AI to instantly fix grammar, spelling, and punctuation mistakes. Start typing, and the AI will detect and correct errors in real time, making your writing clear, accurate, and polished."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-9",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-semibold text-gray-600",children:["Triple your productivity with the"," ",e.jsx("span",{className:"text-blue-500 font-semibold",children:"Homophone Checker"})]}),e.jsx("p",{className:"text-gray-600 mt-4 max-w-6xl mx-auto",children:"SorSer's Homophone Checker uses AI to instantly fix grammar, spelling, and punctuation mistakes. Start typing, and the AI will detect and correct errors in real time, making your writing clear, accurate, and polished."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-gray-100 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ye,{className:"text-pink-500",size:28}),e.jsx("h2",{className:"text-xl font-semibold text-gray-600",children:"How To Use SorSer Tool"})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"SorSer's AI helps you write better by detecting and fixing grammar, spelling, and punctuation mistakes as you type. It works in real time, so you can focus on your ideas while the AI takes care of corrections."}),e.jsxs("div",{className:"bg-white border rounded-xl p-3",children:[e.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"Sample Grammar Checker"}),e.jsxs("div",{className:"mt-1 p-3 rounded-xl border border-gray-200",children:[e.jsx("p",{className:"font-medium text-gray-800 mb-1",children:"Typing Your Sentence:"}),e.jsx("div",{className:"text-gray-600 text-sm mb-2",children:"What key difference distinguishes isotopes from one another?"}),e.jsxs("ul",{className:"mt-2 text-sm text-gray-700 space-y-2",children:[e.jsxs("li",{children:["â€¢"," ",e.jsx("span",{className:"underline decoration-red-500 decoration-2 underline-offset-4",children:"She go"})," ","to the office every morning."]}),e.jsxs("li",{children:["â€¢"," ",e.jsxs("span",{className:"underline decoration-green-500 decoration-2 underline-offset-4",children:["She ",e.jsx("strong",{children:"goes"})]})," ","to the office every morning."]})]})]})]})]}),e.jsxs("div",{className:"space-y-9",children:[e.jsxs("div",{className:"bg-gray-100 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ke,{className:"text-orange-500",size:28}),e.jsx("h2",{className:"text-xl font-semibold text-gray-600",children:"Lightning Fast"})]}),e.jsx("p",{className:"text-gray-600",children:"Boost your writing speed with AI-powered grammar checking that instantly detects and fixes errors. SorSer helps you turn rough drafts into clear, polished text in seconds â€” no extra effort required"})]}),e.jsxs("div",{className:"bg-gray-100 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ze,{className:"text-pink-500",size:28}),e.jsx("h2",{className:"text-xl font-semibold text-gray-600",children:"Features for Everyone"})]}),e.jsxs("p",{className:"text-gray-600",children:["Whether you're a student, teacher, or professional, SorSer makes writing easier and more accurate."," ",e.jsx("span",{className:"text-blue-600 cursor-pointer hover:underline",children:"Try it out"})," ","to experience real-time grammar, spelling, and punctuation checking that helps you write with confidence."]})]})]})]})]})})}function ut(){return e.jsx("div",{className:"w-full max-w-7xl mx-auto text-left py-8 pl-2",children:e.jsxs("div",{className:"flex justify-between items-center text-md",children:[e.jsxs("span",{className:"text-gray-500 text-md",children:["Try it out above by using ",e.jsx("span",{className:"font-semibold",children:"handwritten notes."})]}),e.jsxs("span",{className:"text-gray-500 text-md",children:["Don't have any content? ","",e.jsx("button",{className:"text-blue-500 text-md hover:underline",children:"Create from scratch"})]})]})})}function xt({currentAccuracy:x,minRequired:c,bestAccuracy:p,isVisible:o,selectedArticle:d,comparisonAccuracy:l=0}){if(!o)return null;const v=Math.min(100,x/c*100),y=x>=c,_=l>=c,f=y&&_;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Progress to Unlock"}),e.jsx("div",{className:`px-2 py-0.5 rounded-full text-xs font-semibold ${f?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:f?"âœ“ Ready":"In Progress"})]}),e.jsxs("div",{className:"relative w-full h-5 bg-gray-100 rounded-full overflow-hidden border border-gray-200 mb-2",children:[e.jsx("div",{className:`absolute top-0 left-0 h-full transition-all duration-300 ${y?"bg-gradient-to-r from-green-400 to-green-500":"bg-gradient-to-r from-blue-400 to-blue-500"}`,style:{width:`${v}%`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-bold text-gray-700 drop-shadow-sm",children:["Typed: ",x.toFixed(1),"%"]})})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[y?e.jsx(We,{className:"w-3.5 h-3.5 text-green-600"}):e.jsx(Ue,{className:"w-3.5 h-3.5 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:"Typing"})]}),e.jsxs("span",{className:y?"text-green-600 font-semibold":"text-gray-600",children:[x.toFixed(1),"% / ",c,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[_?e.jsx(We,{className:"w-3.5 h-3.5 text-green-600"}):e.jsx(Ue,{className:"w-3.5 h-3.5 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:"Accuracy"})]}),e.jsxs("span",{className:_?"text-green-600 font-semibold":"text-gray-600",children:[l.toFixed(1),"% / ",c,"%"]})]})]}),e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-100",children:e.jsx("p",{className:"text-xs text-center text-gray-600",children:f?e.jsx("span",{className:"text-green-600 font-medium",children:'Click "Save" to unlock next article!'}):e.jsxs("span",{children:["Complete ",c,"% typing with ",c,"% accuracy"]})})})]})}function mt({text:x="",onReplace:c,checkerId:p,comparisonResult:o,setComparisonResult:d,articleId:l,isChecking:v=!1,liveProgress:y={currentAccuracy:0,minRequired:70,bestAccuracy:0},selectedArticle:_=null,currentAccuracy:f=0}){const[L,N]=r.useState([]),[Y,H]=r.useState(!1),[P,$]=r.useState(!1),[g,k]=r.useState(null),[V,S]=r.useState(null),[I,Z]=r.useState(null),[ne,w]=r.useState(""),[C,W]=r.useState("idle"),[D,j]=r.useState(null),[T,M]=r.useState(0),[$e,De]=r.useState([]),[Ne,Le]=r.useState(""),[He,ie]=r.useState(null),[me,he]=r.useState(!1),[Q,ee]=r.useState(null),[Se,le]=r.useState(null),[Pe,te]=r.useState(!1),_e=Ee(),{auth:Ae}=_e.props||{},[z,pe]=r.useState(null),[fe,ce]=r.useState(null),ke=n=>{if(n===0||!o)return;const i=o.comparison.filter(u=>u.type==="missing"||u.type==="replaced"||u.type==="extra");if(n>=i.length)return;const a=[i[n],...i.slice(0,n),...i.slice(n+1)],s=o.comparison.filter(u=>u.type!=="missing"&&u.type!=="replaced"&&u.type!=="extra"),m=[...a,...s];d({...o,comparison:m})},oe=(n,i,t=!1)=>{if(!n||!c||!o)return;E.post("/api/track/comparison-action",{grammar_checker_id:p,article_id:l??null,action:i,comparison_type:n.type,user_word:n.user_word?.user_word||"",article_word:n.article_word?.article_word||"",word_position:n.user_word?.user_index||n.article_word?.article_index,session_id:sessionStorage.getItem("sessionId")}).catch(h=>console.error("Track comparison action error:",h));let a=[...o.comparison],s=[...o.user_words];const m=a.findIndex(h=>h===n);if(m===-1)return;if(i==="dismiss"){const h=`${n.type}-${n.user_word?.user_index||"none"}-${n.article_word?.article_index||"none"}`;N(A=>[...A,h]),a=a.filter((A,U)=>U!==m)}else if(i==="accept"){if(n.type==="missing"){const h=n.article_word.article_index;s.splice(h,0,n.actions.accept.result)}else if(n.type==="extra"){const h=n.user_word.user_index;typeof h=="number"&&s.splice(h,1)}else if(n.type==="replaced"){const h=n.user_word.user_index;typeof h=="number"&&(s[h]=n.actions.accept.result)}a=a.filter((h,A)=>A!==m)}if(a.filter(h=>h.type==="missing"||h.type==="replaced"||h.type==="extra").length===0&&!t){try{ee(G({...o,comparison:a,user_words:s}))}catch{}L.length===0&&(s=[...o.article_words]),setTimeout(()=>{d(null),N([])},500)}else d({...o,comparison:a,user_words:s});if(!t){const h=s.join("");c(h)}},R=n=>n?n.normalize("NFD").replace(/[\u17BB-\u17D2]/g,"").replace(/\s+/g,"").toLowerCase():"",ge=async()=>{if(V)return V;$(!0);const n=["/homophones.json","/storage/homophones.json","/homophones/json"];let i=[];for(const a of n)try{const s=await E.get(a,{headers:{Accept:"application/json"}});if(i=s.data?.homophones??s.data?.data??(Array.isArray(s.data)?s.data:null)??(Array.isArray(Object.values(s.data))?Object.values(s.data):[]),i.length)break}catch{}const t={};return i.forEach(a=>{const s=a.word?.trim(),m=R(s);s&&(t[s]=a),m&&(t[m]=a)}),S(t),$(!1),t},J=async(n,i=null)=>{if(!n)return;pe(i),ce(n),k(null),H(!0),$(!0);const t=n.article_word&&n.article_word.article_word||n.user_word&&n.user_word.user_word||"";if(!t){k({word:"",notFound:!0}),$(!1);return}try{const a=await ge();if(a[t]){k({...a[t],displayedWord:t}),$(!1);return}const s=R(t),m=s?a[s]:null;if(m){const h=(Array.isArray(m.homophone)?m.homophone:[]).includes(t);k(h?{...m,displayedWord:t,isHomophone:!0}:{word:t,notFound:!0})}else k({word:t,notFound:!0})}catch{k({word:t,notFound:!0})}finally{$(!1)}},O=()=>{H(!1),k(null),pe(null),ce(null)},K=()=>{fe&&z&&oe(fe,z),O()},se=(n,i)=>{Ae?.can?.student===!0?J(n,i):oe(n,i)},G=n=>{if(!n||!Array.isArray(n.comparison))return{replaced:0,extra:0,missing:0,same:0,total:0,accuracy:null,avgPause:null};const i=n.comparison,t=i.filter(F=>F.type==="replaced").length,a=i.filter(F=>F.type==="extra").length,s=i.filter(F=>F.type==="missing").length,m=i.filter(F=>F.type==="same").length,u=Array.isArray(n.article_words)?n.article_words.length:i.length,h=u>0?Math.round(m/u*1e4)/100:null;let A=n.metadata?.avg_pause_duration??n.metadata?.avgPause??null;const U=A!=null&&!Number.isNaN(Number(A))?Math.round(Number(A)*100)/100:null;return{replaced:t,extra:a,missing:s,same:m,total:u,accuracy:h,avgPause:U}};r.useEffect(()=>{o&&ee(G(o))},[o]);const[Ce,B]=r.useState(null),[q,b]=r.useState(!1);async function ye(n){if(!n||!n.trim())return null;const i=["/api/khmer-segment"];for(const t of i)try{const a=await E.post(t,{text:n},{headers:{"Content-Type":"application/json"}}),s=a.data?.tokens??a.data?.data?.tokens??(Array.isArray(a.data)?a.data:null);if(Array.isArray(s))return s}catch{}return null}const be=n=>{const i=String(n||"").trim(),t=i.length,a=i?i.split(/\s+/).filter(Boolean).length:0,s=i?i.split(/[.!?]+/).map(F=>F.trim()).filter(Boolean).length:0,m=i?i.split(/\n+/).map(F=>F.trim()).filter(Boolean).length:0,u=a>0?Math.ceil(a/200*60):0,h=Math.floor(u/60),A=u%60,U=`${h} m ${A} s`;return{characters:t,words:a,sentences:s,paragraphs:m,readingTime:U,readingSeconds:u}};async function de(n){const i=String(n||"").trim();if(!i)return be(i);try{const t=await ye(i),a=Array.isArray(t)?t.length:i.split(/\s+/).filter(Boolean).length,s=i.length,m=i?i.split(/[.!?]+/).map(Me=>Me.trim()).filter(Boolean).length:0,u=i?i.split(/\n+/).map(Me=>Me.trim()).filter(Boolean).length:0,h=a>0?Math.ceil(a/200*60):0,A=Math.floor(h/60),U=h%60,F=`${A} m ${U} s`;return{characters:s,words:a,sentences:m,paragraphs:u,readingTime:F,readingSeconds:h}}catch(t){return console.error("Khmer segmentation error:",t),be(i)}}const[je,ae]=r.useState(!1),X=Oe.useRef(null),ve=async(n={})=>{const i=Q??G(o);if(!i||i.total===0||!p&&!l)return null;const t=await de(x),a={grammar_checker_id:p??null,article_id:l??null,accuracy:i.accuracy??null,replaced_count:i.replaced??0,extra_count:i.extra??0,missing_count:i.missing??0,avg_pause_duration:Se?.avg_pause_duration??i.avgPause??null,user_word_count:t.words??null,article_total_words:i.total??null,reading_time_seconds:t.readingSeconds??null};if(a.avg_pause_duration===null)try{const s=await ue();s&&typeof s.avg_pause_duration=="number"&&(a.avg_pause_duration=Number(s.avg_pause_duration))}catch{}if(je)return null;ae(!0);try{return await E.post("/api/accuracy",a,{headers:{Accept:"application/json"},withCredentials:!0}),!0}catch(s){return console.error("Save accuracy error:",s?.response?.data??s),null}finally{ae(!1)}},Te=()=>{X.current&&clearTimeout(X.current),X.current=setTimeout(()=>{ve().catch(()=>{})},700)};r.useEffect(()=>{const n=Q??G(o);if(!(!n||n.total===0)&&!(!p&&!l))return Te(),()=>{X.current&&(clearTimeout(X.current),X.current=null)}},[Q,o,x,p,l]),r.useEffect(()=>{if(!me)return;ue(p).catch(()=>{});let n=!1;return b(!0),B(null),de(x).then(i=>{n||B(i)}).catch(()=>{}).finally(()=>{n||b(!1)}),()=>{n=!0}},[me,Q]);async function ue(n=null){te(!0),le(null);const i=["/api/user-activity-stats","/api/user-activities/stats","/api/track/stats","/user-activity-stats"],t=typeof sessionStorage<"u"?sessionStorage.getItem("sessionId"):null;for(const a of i)try{const s={};t&&(s.session_id=t),n&&(s.grammar_checker_id=n),l&&(s.article_id=l);const m=await E.get(a,{params:s,headers:{Accept:"application/json"}}),u=m.data?.data??m.data??null;if(u&&typeof u=="object")return le(u),te(!1),u}catch{}return te(!1),null}if(o){const n=o.comparison.filter(s=>s.type==="missing"||s.type==="replaced"||s.type==="extra"),i=Math.max(...o.comparison.filter(s=>s.type==="same"||s.type==="replaced"||s.type==="extra").map(s=>s.index_compared),-1),t=n.filter(s=>s.type!=="missing"||s.index_compared<=i),a=o?.stats?(o.stats.same||0)/(o.article_words?.length||1)*100:0;return e.jsxs("div",{className:"w-96 rounded-xl border border-gray-200 bg-white h-[75vh] flex flex-col overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"px-6 pt-4 pb-2 border-gray-200",children:[_&&e.jsx("div",{className:"mb-3",children:e.jsx(xt,{currentAccuracy:y.currentAccuracy,minRequired:y.minRequired,bestAccuracy:y.bestAccuracy,isVisible:!0,selectedArticle:_,comparisonAccuracy:a})}),v?e.jsxs("div",{className:"flex justify-between items-center border border-gray-200 rounded-xl px-4 py-2 bg-white shadow-sm animate-pulse mb-3",children:[e.jsx("div",{className:"h-4 w-40 bg-slate-200 rounded"}),e.jsx("div",{className:"h-6 w-20 bg-slate-300 rounded-full"})]}):e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("div",{className:"text-gray-800 text-base font-semibold",children:"Comparison Results"})}),v?e.jsxs("div",{className:"flex items-center space-x-2 animate-pulse mb-1",children:[e.jsx("div",{className:"h-8 w-20 bg-slate-200 rounded-lg"}),e.jsx("div",{className:"h-8 w-28 bg-slate-200 rounded-lg"})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{className:"text-sm text-blue-900 px-3 py-1.5 font-medium flex items-center hover:bg-gray-100 rounded-lg transition",children:["All"," ",e.jsx("span",{className:"text-xs bg-gray-200 rounded-full px-2 py-0.5 ml-2",children:t.length})]}),e.jsxs("button",{className:"text-sm text-green-600 px-3 py-1.5 font-medium flex items-center hover:bg-gray-100 rounded-lg transition",children:["Differences"," ",e.jsx("span",{className:"text-xs bg-gray-200 rounded-full px-2 py-0.5 ml-2",children:t.length})]})]}),e.jsx("div",{className:"border-b"})]}),e.jsx("div",{className:"space-y-2 px-4 py-0 mb-2 flex-1 overflow-y-auto hide-scrollbar",children:v?e.jsxs("div",{className:"space-y-4 animate-pulse",children:[e.jsxs("div",{className:"flex justify-between items-center border border-gray-200 rounded-xl px-4 py-2 bg-white shadow-sm",children:[e.jsx("div",{className:"h-4 w-40 bg-slate-200 rounded"}),e.jsx("div",{className:"h-6 w-20 bg-slate-300 rounded-full"})]}),[...Array(3)].map((s,m)=>e.jsxs("div",{className:"bg-white rounded-xl p-3 border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"h-3 w-24 bg-slate-200 rounded mb-3"}),e.jsxs("div",{className:"flex space-x-2 mb-4",children:[e.jsx("div",{className:"h-4 w-16 bg-slate-300 rounded"}),e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"h-6 w-20 bg-slate-300 rounded-full"}),e.jsx("div",{className:"h-6 w-20 bg-slate-200 rounded-full"}),e.jsx("div",{className:"h-6 w-20 bg-slate-200 rounded-full"})]})]},m))]}):e.jsxs(e.Fragment,{children:[t.length>0&&e.jsx("div",{className:"flex justify-between items-center border border-gray-200 rounded-xl px-4 py-2 bg-white shadow-sm",children:e.jsxs("span",{className:"flex items-center",children:[e.jsxs("span",{className:"text-red-500 text-sm font-semibold",children:[t.length," ","differences"]}),e.jsx("span",{className:"text-gray-600 text-sm ml-1",children:"found"})]})}),t.map((s,m)=>e.jsxs("div",{onClick:()=>ke(m),className:`bg-white rounded-xl p-3 border shadow-sm cursor-pointer transition ${m===0?"border-blue-500 border-2":"border-gray-200"}`,children:[e.jsxs("p",{className:"text-xs text-gray-500 font-medium mb-2",children:[s.type==="missing"&&"Missing Word (Expected word is missing)",s.type==="replaced"&&"Incorrect Word",s.type==="extra"&&"Extra Word (Unmatched in the article)"]}),e.jsxs("div",{className:`${s.type!=="missing"?"gap-2 ":""} mb-3 flex items-center `,children:[e.jsx("span",{className:`${s.type!=="missing"?"line-through ":""}text-base ${m===0?"text-red-500":"text-gray-500"}`,children:typeof s.user_word?.user_word=="string"&&s.user_word.user_word!==""?s.user_word.user_word:""}),e.jsx("span",{children:s.type!=="missing"&&e.jsx(nt,{className:"w-4 h-4 text-slate-500"})}),e.jsx("span",{className:`text-base font-semibold ${m===0?"text-green-600":"text-green-700"}`,children:s.article_word?.article_word||"Removed"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-full flex items-center text-xs font-medium transition",onClick:u=>{u.stopPropagation(),se(s,"accept")},children:[e.jsx(Be,{className:"w-3.5 h-3.5 mr-1"})," ","Accept"]}),e.jsxs("button",{className:"flex items-center text-gray-700 hover:text-red-600 px-3 rounded-full border-2 hover:bg-red-50 text-xs font-medium transition",onClick:u=>{u.stopPropagation(),se(s,"dismiss")},children:[e.jsx(ot,{className:"w-3.5 h-3.5 mr-1"})," ","Ignore"]})]})]},`${s.index_compared}-${s.type}`)),t.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Be,{className:"mt-20 w-12 h-12 text-green-500 mx-auto mb-3"}),e.jsx("h5",{className:"text-base font-semibold text-gray-700 mb-1",children:"Perfect Match!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Your text matches the article exactly."})]})]})}),e.jsx(xe,{show:Y,onClose:O,maxWidth:"xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:P?e.jsx("div",{className:"py-2 text-center",children:"Loadingâ€¦"}):g?g.notFound?"Are You Sure?":"Explanation":e.jsx(e.Fragment,{children:" "})}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700",onClick:O,"aria-label":"Close",children:"âœ•"})]})}),P?e.jsx("div",{className:"py-8 text-center",children:"Loadingâ€¦"}):g?e.jsx("div",{className:"space-y-3 text-sm text-gray-700",children:g.notFound?e.jsxs("div",{children:[z==="accept"&&e.jsxs("div",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to continue with the word"," ",e.jsx("span",{className:"font-semibold text-green-600",children:g.word})]}),z==="dismiss"&&e.jsxs("div",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to ignore the word"," ",e.jsx("span",{className:"text-red-600 font-semibold",children:g.word})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 gap-3",children:[e.jsx("button",{type:"button",onClick:O,className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",children:"Close"}),z==="accept"&&e.jsx("button",{type:"button",onClick:K,className:"rounded-[10px] px-9 py-1 bg-green-600 text-white font-semibold hover:bg-green-700 transition",children:"Accept"}),z==="dismiss"&&e.jsx("button",{type:"button",onClick:K,className:"rounded-[10px] px-9 py-1 bg-red-600 text-white font-semibold hover:bg-red-700 transition",children:"Ignore"})]})]}):e.jsxs(e.Fragment,{children:[g.displayedWord&&e.jsx("div",{children:e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-lg",children:g.displayedWord}),g.isHomophone&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(homophone of"," ",e.jsx("strong",{children:g.word}),")"]})," â€” ",g.shortDescription||`This word is commonly used to describe or refer to ${g.word}.`]})}),e.jsxs("div",{className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-base font-medium text-slate-500",children:"Part of Speech"}),e.jsx("div",{className:"text-sm",children:g.pos||"â€”"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-base font-medium text-slate-500",children:"Pronunciation"}),e.jsx("div",{className:"text-sm",children:g.pro||g.phoneme||"â€”"})]})]}),e.jsxs("div",{className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-base font-medium text-slate-500",children:"Homophones"}),e.jsx("div",{className:"text-sm",children:Array.isArray(g.homophone)?g.homophone.join(", "):"â€”"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-base font-medium text-slate-500",children:"phoneme"}),e.jsx("div",{className:"text-sm",children:typeof g.phoneme=="string"&&g.phoneme.trim()?g.phoneme:Array.isArray(g.phoneme)&&g.phoneme.length?g.phoneme.join(", "):"â€”"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-medium text-slate-500",children:"Definition"}),e.jsx("div",{className:"text-sm",children:g.definition||"â€”"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-medium text-slate-500",children:"Example"}),e.jsx("div",{className:"text-sm",children:g.example||"â€”"})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 gap-3",children:[e.jsx("button",{type:"button",onClick:O,className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",children:"Close"}),z==="accept"&&e.jsx("button",{type:"button",onClick:K,className:"rounded-[10px] px-9 py-1 bg-green-600 text-white font-semibold hover:bg-green-700 transition disabled:opacity-60",children:"Accept"}),z==="dismiss"&&e.jsx("button",{type:"button",onClick:K,className:"rounded-[10px] px-9 py-1 bg-red-600 text-white font-semibold hover:bg-red-700 transition",children:"Ignore"})]})]})}):e.jsx("div",{className:"py-6 text-center text-sm text-gray-500",children:"No data available."})]})})]})}return e.jsxs("div",{className:"w-96 rounded-xl border border-gray-200 bg-white h-[75vh] flex flex-col overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"px-6 pt-4 pb-2 border-gray-200",children:[v?e.jsxs("div",{className:"flex justify-between items-center border border-gray-200 rounded-xl px-4 py-2 bg-white shadow-sm animate-pulse mb-3",children:[e.jsx("div",{className:"h-4 w-40 bg-slate-200 rounded"}),e.jsx("div",{className:"h-6 w-20 bg-slate-300 rounded-full"})]}):e.jsx("div",{className:"flex items-center justify-between font-semibold mb-3",children:x.split(" ").filter(n=>n.trim()).length<25?`Enter at least 25 words (${x.split(" ").filter(n=>n.trim()).length}/25)`:"Grammar Check Results"}),v?e.jsxs("div",{className:"flex items-center space-x-2 animate-pulse mb-1",children:[e.jsx("div",{className:"h-8 w-20 bg-slate-200 rounded-lg"}),e.jsx("div",{className:"h-8 w-28 bg-slate-200 rounded-lg"})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{className:"text-sm text-blue-900 px-3 py-1.5 font-medium flex items-center hover:bg-gray-100 rounded-lg transition",children:["All"," ",e.jsx("span",{className:"text-xs bg-gray-200 rounded-full px-2 py-0.5 ml-2",children:"0"})]}),e.jsxs("button",{className:"text-sm text-green-600 px-3 py-1.5 font-medium flex items-center hover:bg-gray-100 rounded-lg transition",children:["Grammar"," ",e.jsx("span",{className:"text-xs bg-gray-200 rounded-full px-2 py-0.5 ml-2",children:"0"})]})]}),e.jsx("div",{className:"border-b"})]}),e.jsx("div",{className:"space-y-2 px-4 py-0 mb-2 flex-1 overflow-y-auto hide-scrollbar",children:v?e.jsxs("div",{className:"space-y-4 animate-pulse",children:[e.jsxs("div",{className:"flex justify-between items-center border border-gray-200 rounded-xl px-4 py-2 bg-white shadow-sm",children:[e.jsx("div",{className:"h-4 w-40 bg-slate-200 rounded"}),e.jsx("div",{className:"h-6 w-20 bg-slate-300 rounded-full"})]}),[...Array(3)].map((n,i)=>e.jsxs("div",{className:"bg-white rounded-xl p-3 border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"h-3 w-24 bg-slate-200 rounded mb-3"}),e.jsxs("div",{className:"flex space-x-2 mb-4",children:[e.jsx("div",{className:"h-4 w-16 bg-slate-300 rounded"}),e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"h-6 w-20 bg-slate-300 rounded-full"}),e.jsx("div",{className:"h-6 w-20 bg-slate-200 rounded-full"}),e.jsx("div",{className:"h-6 w-20 bg-slate-200 rounded-full"})]})]},i))]}):e.jsxs("div",{className:"text-center flex flex-col items-center justify-center h-full",children:[e.jsx("img",{src:"/images/binoculars-see.svg",alt:"Icon",className:"w-16 h-16"}),e.jsx("h5",{className:"text-base font-semibold text-gray-700",children:"Nothing to check yet!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Get started by adding text to the editor"})]})})]})}const Ie=async x=>{if(!x||!x.trim())return 0;try{const c=await E.post("/api/khmer-segment",{text:x},{headers:{"Content-Type":"application/json"}});return c.data&&Array.isArray(c.data.tokens)?c.data.tokens.length:x.trim().split(/\s+/).length}catch(c){return console.error("Khmer segment API error:",c),x.trim().split(/\s+/).length}},ht=x=>Math.ceil(x/200*60),pt=x=>{const c=["replaced","missing","extra"],p={replaced_accept:"#34d399",replaced_dismiss:"#f87171",missing_accept:"#60a5fa",missing_dismiss:"#fbbf24",extra_accept:"#a78bfa",extra_dismiss:"#f472b6"},o=[];return c.forEach(d=>{const l=x.filter(y=>y.comparison_type===d&&y.action==="accept").length,v=x.filter(y=>y.comparison_type===d&&y.action==="dismiss").length;o.push({name:d==="replaced"?"Incorrect Accept":`${d.charAt(0).toUpperCase()+d.slice(1)} Accept`,value:l,color:p[`${d}_accept`]}),o.push({name:d==="replaced"?"Incorrect Dismiss":`${d.charAt(0).toUpperCase()+d.slice(1)} Dismiss`,value:v,color:p[`${d}_dismiss`]})}),o.filter(d=>d.value>0)},re=(x,c,p)=>x.filter(o=>o.comparison_type===c&&o.action===p).length,ze=(x,c)=>x.filter(p=>p.activity_type===c).length;function Ve({comparisonActivities:x=[],accuracyStats:c=null,activityStats:p=null,audioActivities:o=[],loadingAccuracyStats:d=!1,loadingActivityStats:l=!1,loadingAudioActivities:v=!1}){const y=pt(x);return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Distribution Actions"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Share of action by group"})]}),e.jsx(Je,{width:"100%",height:280,children:e.jsxs(st,{children:[e.jsx(at,{data:y,cx:"50%",cy:"50%",outerRadius:90,dataKey:"value",labelLine:!1,children:y.map((_,f)=>e.jsx(Qe,{fill:_.color},`cell-${f}`))}),e.jsx(et,{formatter:(_,f)=>[`${_}`,f]}),e.jsx(tt,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm text-slate-600 mt-4",children:[e.jsxs("div",{children:["Replaced:"," ",e.jsx("span",{className:"font-medium text-green-700",children:re(x,"replaced","accept")}),e.jsx("span",{className:"text-gray-400",children:" (a) / "}),e.jsx("span",{className:"font-medium text-red-700",children:re(x,"replaced","dismiss")}),e.jsx("span",{className:"text-gray-400",children:" (d)"})]}),e.jsxs("div",{children:["Missing:"," ",e.jsx("span",{className:"font-medium text-green-700",children:re(x,"missing","accept")}),e.jsx("span",{className:"text-gray-400",children:" (a) / "}),e.jsx("span",{className:"font-medium text-red-700",children:re(x,"missing","dismiss")}),e.jsx("span",{className:"text-gray-400",children:" (d)"})]}),e.jsxs("div",{children:["Extra:"," ",e.jsx("span",{className:"font-medium text-green-700",children:re(x,"extra","accept")}),e.jsx("span",{className:"text-gray-400",children:" (a) / "}),e.jsx("span",{className:"font-medium text-red-700",children:re(x,"extra","dismiss")}),e.jsx("span",{className:"text-gray-400",children:" (d)"})]}),e.jsxs("div",{children:["Accuracy:"," ",e.jsx("span",{className:"font-medium text-gray-800",children:d?"â€¦":c?.accuracy!=null?`${Number(c.accuracy).toFixed(2)}%`:"0%"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm text-slate-600 mt-4",children:[e.jsxs("div",{children:["Avg Pause (s):"," ",e.jsx("span",{className:"font-medium text-gray-800",children:l?"â€¦":p?.avg_pause_duration!=null?Number(p.avg_pause_duration).toFixed(2):"0"})]}),e.jsxs("div",{children:["Audio Plays:"," ",e.jsx("span",{className:"font-medium text-blue-700",children:v?"â€¦":ze(o,"audio_play")||"0"})]}),e.jsxs("div",{children:["Audio Pauses:"," ",e.jsx("span",{className:"font-medium text-orange-700",children:v?"â€¦":ze(o,"audio_pause")||"0"})]}),e.jsxs("div",{children:["Reading Time (s):"," ",e.jsx("span",{className:"font-medium text-gray-800",children:c?.reading_time_seconds??"0"})]})]})]})}function ft({show:x,onClose:c,docTitle:p,paragraph:o,lastSavedAt:d,statsData:l}){return e.jsx(xe,{show:x,onClose:c,maxWidth:"2xl",children:e.jsxs("div",{className:"p-6 flex flex-col",style:{maxHeight:"80vh"},children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:["Article Name: ",p||"Untitled document"]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Date:"," ",d?new Date(d).toLocaleDateString():"â€”"]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4 mb-4 text-sm text-gray-700",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-500",children:"Your Article"}),e.jsx("div",{className:"mt-1 bg-slate-50 p-3 rounded text-sm leading-relaxed whitespace-pre-wrap break-words max-h-60 overflow-auto",children:o||""})]})}),e.jsx(Ve,{...l})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:c,className:"rounded-[10px] border-2 border-gray-300 px-6 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",children:"Close"})})]})})}function gt({show:x,onClose:c,historyItems:p=[],loading:o=!1,onViewItem:d}){return e.jsx(xe,{show:x,onClose:c,maxWidth:"2xl",children:e.jsxs("div",{className:"py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 px-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Homophone History"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 text-lg mr-2",onClick:c,children:"âœ•"})]}),o?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"Loading history..."})}):p.length===0?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"No Homophone found."})}):e.jsx("div",{className:"overflow-x-auto max-h-[50vh] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"No"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Title"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold text-gray-700",children:"Words"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold text-gray-700",children:"Reading Time"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold text-gray-700",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:p.map((l,v)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-600",children:v+1}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-800",children:l.title||"Untitled document"}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:new Date(l.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-center text-gray-700",children:l.word_count??"0"}),e.jsxs("td",{className:"px-4 py-3 text-center text-gray-700",children:[l.reading_time??"0","s"]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{type:"button",className:"rounded-[10px] border-2 border-blue-500 px-3 py-1 text-blue-700 hover:bg-blue-500 hover:text-white transition font-medium",onClick:()=>d(l),children:"View"})})]},l.id))})]})}),e.jsx("div",{className:"mt-6 flex justify-end px-6",children:e.jsx("button",{onClick:c,className:"rounded-[10px] border-2 border-gray-500 px-4 py-1 text-gray-600 hover:bg-gray-500 hover:text-white transition font-medium",children:"Close"})})]})})}function yt({show:x,onClose:c,historyItem:p,statsData:o}){return p?e.jsx(xe,{show:x,onClose:c,maxWidth:"2xl",children:e.jsxs("div",{className:"p-6 flex flex-col",style:{maxHeight:"80vh"},children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:["Article Name: ",p.title||"Untitled document"]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Date:"," ",p.created_at?new Date(p.created_at).toLocaleDateString():"N/A"]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4 mb-4 text-sm text-gray-700",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-500",children:"Your Article"}),e.jsx("div",{className:"mt-1 bg-slate-50 p-3 rounded text-sm leading-relaxed whitespace-pre-wrap break-words max-h-60 overflow-auto",children:p.paragraph||""})]})}),e.jsx(Ve,{...o})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:c,className:"rounded-[10px] border-2 border-gray-300 px-6 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",children:"Close"})})]})}):null}function bt({show:x,completionData:c,onClose:p}){return!x||!c?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4",children:e.jsx("svg",{className:"h-10 w-10 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Article Completed!"}),e.jsxs("div",{className:"my-6",children:[e.jsxs("div",{className:"text-6xl font-bold text-blue-600 mb-2",children:[c.accuracy,"%"]}),e.jsx("div",{className:"text-gray-600 text-sm",children:"Accuracy Score"})]}),e.jsx("p",{className:"text-gray-700 mb-6 text-sm leading-relaxed",children:c.message}),c.unlocked_next&&c.next_article&&e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-4 mb-6",children:[e.jsx("div",{className:"text-sm text-blue-900 font-semibold mb-1",children:"ðŸŽ‰ New Article Unlocked!"}),e.jsx("div",{className:"text-blue-800 font-medium",children:c.next_article.title})]}),!c.unlocked_next&&e.jsx("div",{className:"bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"text-sm text-yellow-900",children:["You need ",e.jsxs("strong",{children:[c.min_required,"%"]})," to unlock the next article.",e.jsx("br",{}),"Keep practicing to improve your score!"]})}),e.jsx("button",{onClick:()=>{p(),c.redirect_url&&(window.location.href=c.redirect_url)},className:"w-full px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-semibold transition-colors",children:"Continue"})]})})})}function Re(){const[x,c]=r.useState(null),[p,o]=r.useState(!1),[d,l]=r.useState(null),[v,y]=r.useState(!1),[_,f]=r.useState([]),[L,N]=r.useState(!1),[Y,H]=r.useState([]),[P,$]=r.useState(!1),g=async(w,C,W,D={})=>{W(!0);try{for(const j of w)try{const T=await E.get(j,{params:D,headers:{Accept:"application/json"},validateStatus:M=>M<500});if(T.status===200){const M=T.data?.data??T.data??null;if(M){C(Array.isArray(M)&&M[0]||M);return}}}catch{continue}C(null)}catch(j){console.error("Error fetching data:",j),C(null)}finally{W(!1)}},k=async w=>{if(!w)return;await g(["/api/user-activities/stats","/api/user-activity-stats","/api/stats/user-activities"],c,o,{grammar_checker_id:w})},V=async w=>{if(!w)return;const C=[`/api/user-homophone-accuracies?grammar_checker_id=${w}`,`/api/homophone-accuracies?grammar_checker_id=${w}`,`/api/accuracies?grammar_checker_id=${w}`];await g(C,l,y)},S=async w=>{if(w){N(!0);try{const C=await E.get("/api/user-comparison-activities",{params:{grammar_checker_id:w,limit:50},headers:{Accept:"application/json"}}),W=Array.isArray(C.data)?C.data:C.data?.data??[];f(W)}catch(C){console.error("Error fetching comparison activities:",C),f([])}finally{N(!1)}}},I=async w=>{if(!w)return;const C=["/api/user-audio-activities","/api/audio-activities"];$(!0);try{for(const W of C)try{const D=await E.get(W,{params:{grammar_checker_id:w},headers:{Accept:"application/json"},validateStatus:j=>j<500});if(D.status===200){const j=Array.isArray(D.data)?D.data:D.data?.data??[];H(j);return}}catch{continue}H([])}catch(W){console.error("Error fetching audio activities:",W),H([])}finally{$(!1)}};return{activityStats:x,loadingActivityStats:p,accuracyStats:d,loadingAccuracyStats:v,comparisonActivities:_,loadingComparisonActivities:L,audioActivities:Y,loadingAudioActivities:P,fetchActivityStats:k,fetchAccuracyStats:V,fetchComparisonActivities:S,fetchAudioActivities:I,fetchAllStats:async w=>{await Promise.all([k(w),V(w),S(w),I(w)])},resetStats:()=>{c(null),l(null),f([]),H([])}}}function jt(x,c,p,o){const d=r.useRef(null),[l,v]=r.useState(null),[y,_]=r.useState(!1),[f,L]=r.useState(null),[N,Y]=r.useState(0),[H,P]=r.useState(0),[$,g]=r.useState(null),k=async(j,T={})=>{if(!(!x||!c?.audios_id))try{await E.post("/api/track/audio-activity",{audio_id:c.audios_id,article_id:c.id,grammar_checker_id:p??null,activity_type:j,playback_position:d.current?.currentTime||0,session_id:o,...T})}catch(M){console.error(`Track audio ${j} error:`,M)}};return{audioRef:d,audioUrl:l,isPlaying:y,audioError:f,currentTime:N,duration:H,togglePlay:async()=>{if(!l||!d.current){L("No audio available to play.");return}if(y){const j=Date.now();g(j),d.current.pause(),_(!1),await k("audio_pause",{pause_duration:0})}else{let j=0;$&&(j=(Date.now()-$)/1e3,g(null));try{await d.current.play(),_(!0),await k("audio_play",{pause_duration:j})}catch(T){console.error("Playback failed:",T),L("Failed to play audio. Please try again."),_(!1)}}},skipForward:async()=>{d.current&&(d.current.currentTime=Math.min(d.current.currentTime+10,d.current.duration),await k("audio_forward"))},skipBackward:async()=>{d.current&&(d.current.currentTime=Math.max(d.current.currentTime-10,0),await k("audio_rewind"))},handleSeek:j=>{if(d.current){const T=j.currentTarget.getBoundingClientRect(),M=(j.clientX-T.left)/T.width;d.current.currentTime=M*d.current.duration}},handleTimeUpdate:()=>{d.current&&Y(d.current.currentTime)},handleLoadedMetadata:()=>{d.current&&P(d.current.duration)},handleAudioEnded:()=>{_(!1),d.current&&(d.current.currentTime=0)},loadAudio:async j=>{if(!j){v(null);return}try{const M=(await E.get(`/api/audios/${j}`)).data?.data;M&&M.file_path?(v(M.file_path),L(null)):(v(null),L("Audio file not found"))}catch(T){console.error("Failed to fetch audio:",T),L("Unable to load audio for this article."),v(null)}},resetAudio:()=>{d.current&&(d.current.pause(),d.current.currentTime=0),_(!1)},setAudioError:L}}function $t({articles:x=[],userRole:c}){const{auth:p}=Ee().props,o=p?.user?.id,[d]=r.useState(x),[l,v]=r.useState(null),[y,_]=r.useState(""),[f,L]=r.useState(""),[N,Y]=r.useState(null),[H,P]=r.useState(!1),[$,g]=r.useState(!1),[k,V]=r.useState(null),[S,I]=r.useState(null),[Z,ne]=r.useState(!1),[w,C]=r.useState(null),[W,D]=r.useState({currentAccuracy:0,minRequired:70,bestAccuracy:0}),[j,T]=r.useState(null),[M,$e]=r.useState(0),De=()=>{if(!S?.stats||!S?.article_words)return 0;const t=S.stats.same||0,a=S.article_words.length||0;return a>0?t/a*100:0},[Ne,Le]=r.useState(!1),[He,ie]=r.useState(!1),[me,he]=r.useState(!1),[Q,ee]=r.useState(!1),[Se,le]=r.useState(!1),[Pe,te]=r.useState(!1),[_e,Ae]=r.useState(null),[z,pe]=r.useState([]),[fe,ce]=r.useState(!1),[ke,oe]=r.useState(null),[R,ge]=r.useState(()=>p?.can?.student===!0?!0:p?.can?.student===!1?!1:typeof window<"u"&&window.__canAccessLibrary!==void 0?window.__canAccessLibrary:null),[J,O]=r.useState(!1),K=r.useRef(null),se=r.useRef(!1),G=r.useRef(),Ce=r.useRef(""),B=Re(),q=Re(),b=jt(o,l,N,w);r.useEffect(()=>{const t=`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;C(t);try{sessionStorage.setItem("sessionId",t)}catch{}},[]),r.useEffect(()=>{if(R!==null||!p?.user)return;let t=!1;return(async()=>{try{const s=(await fetch(route("api.user.can-access-library"),{headers:{"X-Requested-With":"XMLHttpRequest"}})).ok;t||(ge(s),typeof window<"u"&&(window.__canAccessLibrary=s))}catch{t||ge(!1)}})(),()=>t=!0},[p?.user,R]),r.useEffect(()=>{Le(!p.user)},[p.user]),r.useEffect(()=>{if(!J)return;const t=a=>{K.current&&!K.current.contains(a.target)&&O(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[J]),r.useEffect(()=>{T(null),$e(0)},[l?.id]);const ye=t=>{if(isNaN(t))return"0:00";const a=Math.floor(t/60),s=Math.floor(t%60);return`${a}:${s.toString().padStart(2,"0")}`};r.useEffect(()=>{(!f.trim()||!l)&&(I(null),D({currentAccuracy:0,minRequired:70,bestAccuracy:0}))},[f,l]),r.useEffect(()=>{if(!l){D({currentAccuracy:0,minRequired:70,bestAccuracy:0});return}(async()=>{let a=0,s=0;S?.user_words&&S?.article_words?(a=S.user_words.length,s=S.article_words.length):a=await Ie(f);const m=s>0?Math.min(100,a/s*100):0,u=l.min_completion_percentage||70,h=l.best_accuracy||0;D({currentAccuracy:m,minRequired:u,bestAccuracy:h})})()},[f,l,S]);const be=async()=>{if(o)try{const t=await E.get("/grammar-checkers",{headers:{Accept:"application/json"}});return Array.isArray(t.data)?t.data:t.data.data||[]}catch(t){return t.response?.status!==401&&console.error("Error fetching history:",t),[]}},de=async()=>{ce(!0);const t=await be();pe(t),ce(!1)},je=async()=>{if(!(!l||!f.trim())){ne(!0);try{const t=await E.post("/api/compare",{article_id:l.id,user_input:f});t.data&&Array.isArray(t.data.comparison)?I(t.data):(console.error("Invalid comparison result format:",t.data),I(null))}catch(t){console.error("Error in comparison:",t),I(null)}finally{ne(!1)}}},ae=async(t,a)=>{if(!o)return;P(!0);const s=await Ie(a),m={user_id:o,title:t??"",paragraph:a??"",word_count:s,incorrect_word_count:0,reading_time:ht(s),article_id:l?l.id:null};if(N)try{const u=await E.patch(`/grammar-checkers/${N}`,m,{headers:{Accept:"application/json"}}),h=u.data?.id??u.data?.data?.id??N;Y(h),V(Date.now()),l&&a.trim()&&je()}catch(u){console.error("Save update error:",u.response?.data??u)}finally{P(!1)}else{if(se.current){P(!1);return}se.current=!0;try{const u=await E.post("/grammar-checkers",m,{headers:{Accept:"application/json"}}),h=u.data?.id??u.data?.data?.id??null;h&&Y(h),V(Date.now()),l&&a.trim()&&je()}catch(u){console.error("Save Document error:",u.response?.data??u)}finally{se.current=!1,P(!1)}}};r.useEffect(()=>{if(!(!o||!y.trim()&&!f.trim()))return G.current&&clearTimeout(G.current),G.current=setTimeout(()=>{ae(y,f)},700),()=>clearTimeout(G.current)},[y,f]);const X=t=>{const a=t.target.value;if(!j&&a.length>0&&T(Date.now()),!o||!N)return;const s=Ce.current,m=s.length,u=a.length;if(u>m){const h=a.slice(m);setTimeout(()=>{h.split("").forEach(A=>{E.post("/api/track/typing",{grammar_checker_id:Number(N),user_id:Number(o),character:A,status:1}).catch(()=>{})})},80)}else if(u<m){const h=m-u,A=s.slice(-h);setTimeout(()=>{A.split("").forEach(U=>{E.post("/api/track/typing",{grammar_checker_id:Number(N),user_id:Number(o),character:U,status:0}).catch(()=>{})})},80)}Ce.current=a},ve=async t=>{if(v(t),O(!1),_(t?t.title:""),!t){b.resetAudio(),b.setAudioError(null);return}const a=t.audios_id;a?await b.loadAudio(a):b.resetAudio(),N&&ae(y,f)},Te=async()=>{if(R===null){console.warn("Permission check still in progress, please try again");return}if(N){if(S?.stats&&l){const t=S.stats,a=S.article_words?.length||0,s=t.same||0,m=a>0?s/a*100:0;await ue(m)}R===!0?(he(!0),await B.fetchAllStats(N)):(ee(!0),await de())}else{P(!0);try{if(await ae(y,f),S?.stats&&l){const t=S.stats,a=S.article_words?.length||0,s=t.same||0,m=a>0?s/a*100:0;await ue(m)}R===!0?(he(!0),setTimeout(()=>{N&&B.fetchAllStats(N)},0)):(ee(!0),await de())}catch(t){console.error("Error during save:",t),P(!1)}}},ue=async t=>{if(!l?.id){console.warn("No article selected for completion");return}try{const a=document.querySelector('meta[name="csrf-token"]')?.content;if(!a){console.error("CSRF token not found");return}let s=null;if(j&&f.trim()){const A=(Date.now()-j)/(1e3*60),U=f.trim().split(/\s+/).length;s=A>0?Math.round(U/A):0}console.log("Saving completion:",{article_id:l.id,accuracy:t,typing_speed:s,checker_id:N});const m=await fetch(`/homophone-check/${l.id}/save-completion`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify({accuracy:t,typing_speed:s,time_spent:j?Math.round((Date.now()-j)/1e3):0,grammar_checker_id:N})});if(!m.ok){const h=await m.text();console.error("Server error:",h);return}const u=await m.json();console.log("Completion saved:",u),u.success?(Ae(u.completion),te(!0),D(h=>({...h,bestAccuracy:u.completion.best_accuracy||h.bestAccuracy})),console.log("Reloading page in 3 seconds to show unlocked articles..."),setTimeout(()=>{window.location.reload()},3e3)):console.error("Save completion failed:",u.message)}catch(a){console.error("Save completion error:",a)}},n=async t=>{oe(t),le(!0),await q.fetchAllStats(t.id)},i=t=>{t.preventDefault(),ie(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(Ge,{title:"Homophone Check"}),e.jsx(qe,{}),e.jsx(dt,{}),e.jsx("section",{className:"relative py-4",children:e.jsx("div",{className:"max-w-7xl mx-auto px-2 sm:px-6 lg:px-8",children:e.jsxs("div",{className:`flex flex-row gap-4 transition-all duration-300 ${Ne?"blur-sm":""}`,children:[e.jsxs("div",{className:"flex-1 bg-white rounded-xl border border-gray-200 shadow-sm p-6 h-[75vh]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l?.audios_id||b.audioUrl?e.jsxs("div",{className:"flex-1 mr-4",children:[e.jsx("audio",{ref:b.audioRef,src:b.audioUrl,onTimeUpdate:b.handleTimeUpdate,onLoadedMetadata:b.handleLoadedMetadata,onEnded:b.handleAudioEnded,className:"hidden"}),e.jsx("div",{className:"bg-white border border-gray-300 rounded-xl px-3 py-1 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:b.togglePlay,disabled:!b.audioUrl,className:`w-6 h-6 flex items-center justify-center text-white rounded-full transition ${b.audioUrl?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"}`,children:b.isPlaying?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M8 5v14l11-7z"})})}),e.jsxs("div",{className:"flex space-x-0",children:[e.jsx("button",{onClick:b.skipBackward,disabled:!b.audioUrl,className:`w-8 h-8 flex items-center justify-center rounded-full transition ${b.audioUrl?"hover:bg-gray-100":"opacity-50 cursor-not-allowed"}`,title:"Back 10s",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-700",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),e.jsx("path",{d:"M3 3v5h5"}),e.jsx("text",{x:"12",y:"16",fontSize:"8",fill:"currentColor",textAnchor:"middle",fontWeight:"bold",children:"10"})]})}),e.jsx("button",{onClick:b.skipForward,disabled:!b.audioUrl,className:`w-8 h-8 flex items-center justify-center rounded-full transition ${b.audioUrl?"hover:bg-gray-100":"opacity-50 cursor-not-allowed"}`,title:"Forward 10s",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-700",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"}),e.jsx("path",{d:"M21 3v5h-5"}),e.jsx("text",{x:"12",y:"16",fontSize:"8",fill:"currentColor",textAnchor:"middle",fontWeight:"bold",children:"10"})]})})]}),e.jsx("div",{className:"flex-1 flex items-center gap-2",children:b.audioUrl?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs text-gray-600 font-medium min-w-[35px]",children:ye(b.currentTime)}),e.jsx("div",{className:"flex-1 h-1.5 bg-gray-200 rounded-full cursor-pointer relative",onClick:b.handleSeek,children:e.jsx("div",{className:"h-full bg-blue-600 rounded-full transition-all",style:{width:`${b.currentTime/b.duration*100||0}%`}})}),e.jsx("span",{className:"text-xs text-gray-600 font-medium min-w-[35px]",children:ye(b.duration)})]}):e.jsx("span",{className:"text-xs text-gray-500 italic",children:"Loading audio..."})})]})})]}):e.jsx("div",{}),e.jsxs("div",{className:"relative w-64",ref:K,children:[e.jsxs("button",{type:"button",className:"w-full px-3 py-2.5 text-sm bg-white border border-gray-300 rounded-xl shadow-sm text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:()=>O(!J),children:[l?l.title:"Select an Article",e.jsx("svg",{className:`w-4 h-4 ml-2 transition-transform ${J?"rotate-180":"rotate-0"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),J&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-full bg-white border border-gray-200 rounded-xl shadow-lg z-50 max-h-60 overflow-y-auto hide-scrollbar",children:e.jsxs("div",{className:"px-2 py-2 space-y-1",children:[e.jsx("button",{type:"button",className:`w-full text-left px-4 py-2 text-sm rounded-xl transition ${l?"hover:bg-gray-100 text-gray-700":"bg-blue-100 text-blue-700 font-medium"}`,onClick:()=>ve(null),children:"Select an Article"}),d.map((t,a)=>e.jsx("button",{type:"button",disabled:!t.can_access,className:`w-full text-left px-4 py-2 text-sm rounded-lg transition ${l&&l.id===t.id?"bg-blue-100 text-blue-700 font-medium":t.can_access?"hover:bg-gray-100 text-gray-700":"opacity-40 cursor-not-allowed text-gray-400"}`,onClick:()=>t.can_access&&ve(t),title:t.can_access?"":t.lock_message,children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[!t.can_access&&e.jsx("span",{className:"text-sm",children:"ðŸ”’"}),e.jsx("span",{className:"font-mono text-gray-500",children:a+1}),". ",e.jsx("span",{children:t.title})]}),t.is_completed&&e.jsxs("div",{className:"ml-8 flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-0.5 text-xs font-semibold rounded-full bg-green-100 text-green-800 border border-green-300",children:"Completed"}),t.best_accuracy&&e.jsxs("span",{className:"text-xs text-gray-600",children:["Best: ",t.best_accuracy,"%",t.typing_speed&&` â€¢ ${t.typing_speed} WPM`]})]})]})},t.id))]})})]})]}),e.jsx("div",{className:"relative mt-4",children:e.jsx("textarea",{className:`w-full h-[54vh] text-md bg-white border border-gray-200 rounded-xl py-3 px-3 focus:outline-none focus:ring-1 focus:ring-blue-500 placeholder-gray-500 resize-none overflow-y-auto hide-scrollbar ${$?"min-h-[50vh]":""}`,placeholder:"Type your text here...",value:f,onChange:t=>{L(t.target.value),X(t)},onInput:X,onDoubleClick:()=>g(!$),disabled:!l,onCopy:i,onPaste:i,onCut:i})}),e.jsx("div",{className:"flex justify-end items-center mt-1",children:e.jsx("button",{type:"button",onClick:Te,disabled:H||Z||!f.trim()||R===null,className:`px-6 py-1 rounded-xl font-medium transition ${H||Z||!f.trim()||R===null?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:H||Z?"Checking...":"Save"})})]}),e.jsx(mt,{text:f,onReplace:L,checkerId:N,comparisonResult:S,setComparisonResult:I,articleId:l?.id,isChecking:Z,liveProgress:W,selectedArticle:l,currentAccuracy:De()})]})})}),e.jsx(ft,{show:me,onClose:()=>he(!1),docTitle:y,paragraph:f,lastSavedAt:k,statsData:{comparisonActivities:B.comparisonActivities,accuracyStats:B.accuracyStats,activityStats:B.activityStats,audioActivities:B.audioActivities,loadingAccuracyStats:B.loadingAccuracyStats,loadingActivityStats:B.loadingActivityStats,loadingAudioActivities:B.loadingAudioActivities}}),e.jsx(gt,{show:Q,onClose:()=>ee(!1),historyItems:z,loading:fe,onViewItem:n}),e.jsx(yt,{show:Se,onClose:()=>{le(!1),oe(null)},historyItem:ke,statsData:{comparisonActivities:q.comparisonActivities,accuracyStats:q.accuracyStats,activityStats:q.activityStats,audioActivities:q.audioActivities,loadingAccuracyStats:q.loadingAccuracyStats,loadingActivityStats:q.loadingActivityStats,loadingAudioActivities:q.loadingAudioActivities}}),e.jsx(bt,{show:Pe,completionData:_e,onClose:()=>te(!1)}),Ne&&e.jsx("div",{className:"absolute inset-0 bg-opacity-20 flex items-center justify-center z-10",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 p-8 w-full max-w-xl mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-[24px] font-semibold text-gray-900 mb-2",children:"Create an account to get started"}),e.jsx("p",{className:"text-gray-600 text-md leading-relaxed font-sans",children:"Create a free SorSer account to start Grammar Checker with AI"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("a",{href:route("auth.google"),className:"w-full flex items-center justify-center gap-3 px-3 py-3 border-[3px] border-gray-200 rounded-2xl hover:bg-gray-50 transition-colors",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285f4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34a853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#fbbc05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#ea4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),e.jsx("span",{className:"text-gray-700 font-medium",children:"Sign Up with Google"})]}),e.jsxs(Fe,{href:route("register"),className:"w-full flex items-center justify-center gap-3 px-3 py-3 border-[3px] border-gray-200 rounded-2xl hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:e.jsxs("svg",{className:"w-12 h-12 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"}),e.jsx("path",{d:"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"})]})}),e.jsx("span",{className:"font-medium text-gray-500",children:"Sign Up by Email"})]})]}),e.jsxs("div",{className:"mt-6 text-md",children:[e.jsx("span",{className:"text-gray-500",children:"Or "}),e.jsx(Fe,{href:route("login"),children:e.jsx("span",{className:"text-blue-500 font-medium",children:"Sign In"})})," ","to an existing account"]})]})})}),e.jsx(xe,{show:He,onClose:()=>ie(!1),maxWidth:"xl",children:e.jsxs("form",{onSubmit:t=>{t.preventDefault(),ie(!1)},className:"p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Action Not Allowed"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Copy, paste, and cut actions are disabled while typing in this field."}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"inline-block px-2 py-0.5 text-xs font-medium text-red-800 bg-red-100 rounded",children:"Please type manually."})}),e.jsx("div",{className:"flex justify-end gap-3 mt-3",children:e.jsx("button",{type:"button",onClick:()=>ie(!1),className:"rounded-[10px] border-2 border-gray-300 px-8 py-1 text-gray-700 hover:bg-gray-100 transition font-semibold",children:"Close"})})]})}),e.jsx(ut,{}),e.jsx(Xe,{})]})}export{$t as default};
